<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœŸæ ¼å¼åŒ–ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ—¥æœŸæ ¼å¼åŒ–ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>ä¿®å¤è¯´æ˜</h2>
        <p>ä¿®å¤äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
        <ul>
            <li>âœ… <code>IOSCompatibleDate.create()</code> æ— å‚æ•°æ—¶è¿”å› null çš„é—®é¢˜</li>
            <li>âœ… <code>getToday()</code> æ–¹æ³•æ·»åŠ äº† fallback æœºåˆ¶</li>
            <li>âœ… <code>getMaxDate()</code> æ–¹æ³•æ·»åŠ äº†é”™è¯¯å¤„ç†</li>
            <li>âœ… æ”¹è¿›äº† API è¯·æ±‚çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="testResults"></div>
        <button onclick="runTests()">è¿è¡Œæµ‹è¯•</button>
    </div>

    <script>
        // æ¨¡æ‹Ÿ IOSCompatibleDate ç±»
        class MockIOSCompatibleDate {
            static create(input) {
                if (input === undefined) {
                    console.warn('IOSCompatibleDate.create() æ— å‚æ•°è°ƒç”¨ï¼Œè¿”å› null')
                    return null
                }
                
                try {
                    const date = new Date(input)
                    return isNaN(date.getTime()) ? null : date
                } catch (error) {
                    console.error('åˆ›å»ºæ—¥æœŸå¤±è´¥:', error)
                    return null
                }
            }
            
            static format(date, format = 'YYYY-MM-DD') {
                if (!date || isNaN(date.getTime())) return ''
                
                const year = date.getFullYear()
                const month = (date.getMonth() + 1).toString().padStart(2, '0')
                const day = date.getDate().toString().padStart(2, '0')
                
                return format.replace('YYYY', year)
                           .replace('MM', month)
                           .replace('DD', day)
            }
            
            static addDays(date, days) {
                if (!date || isNaN(date.getTime())) return null
                
                const result = new Date(date)
                result.setDate(result.getDate() + days)
                return result
            }
            
            static today(format = 'YYYY-MM-DD') {
                return this.format(new Date(), format)
            }
        }

        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults')
            const resultDiv = document.createElement('div')
            resultDiv.className = `test-result ${type}`
            resultDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`
            resultsDiv.appendChild(resultDiv)
            resultsDiv.scrollTop = resultsDiv.scrollHeight
        }

        function runTests() {
            document.getElementById('testResults').innerHTML = ''
            addResult('ğŸ§ª å¼€å§‹æµ‹è¯•æ—¥æœŸæ ¼å¼åŒ–ä¿®å¤...', 'info')
            
            // æµ‹è¯•1: IOSCompatibleDate.create() æ— å‚æ•°
            try {
                const result1 = MockIOSCompatibleDate.create()
                if (result1 === null) {
                    addResult('âœ… æµ‹è¯•1é€šè¿‡: IOSCompatibleDate.create() æ— å‚æ•°è¿”å› null (é¢„æœŸè¡Œä¸º)', 'success')
                } else {
                    addResult('âŒ æµ‹è¯•1å¤±è´¥: IOSCompatibleDate.create() æ— å‚æ•°åº”è¯¥è¿”å› null', 'error')
                }
            } catch (error) {
                addResult(`âŒ æµ‹è¯•1å¼‚å¸¸: ${error.message}`, 'error')
            }
            
            // æµ‹è¯•2: IOSCompatibleDate.create(new Date())
            try {
                const result2 = MockIOSCompatibleDate.create(new Date())
                if (result2 && !isNaN(result2.getTime())) {
                    addResult('âœ… æµ‹è¯•2é€šè¿‡: IOSCompatibleDate.create(new Date()) æ­£å¸¸å·¥ä½œ', 'success')
                } else {
                    addResult('âŒ æµ‹è¯•2å¤±è´¥: IOSCompatibleDate.create(new Date()) åº”è¯¥è¿”å›æœ‰æ•ˆæ—¥æœŸ', 'error')
                }
            } catch (error) {
                addResult(`âŒ æµ‹è¯•2å¼‚å¸¸: ${error.message}`, 'error')
            }
            
            // æµ‹è¯•3: æ¨¡æ‹Ÿä¿®å¤åçš„ getToday æ–¹æ³•
            try {
                const getToday = () => {
                    try {
                        const today = MockIOSCompatibleDate.create(new Date())
                        if (today && !isNaN(today.getTime())) {
                            return MockIOSCompatibleDate.format(today, 'YYYY-MM-DD')
                        }
                        // fallback
                        const fallbackDate = new Date()
                        const year = fallbackDate.getFullYear()
                        const month = (fallbackDate.getMonth() + 1).toString().padStart(2, '0')
                        const day = fallbackDate.getDate().toString().padStart(2, '0')
                        return `${year}-${month}-${day}`
                    } catch (error) {
                        console.error('è·å–ä»Šå¤©æ—¥æœŸå¤±è´¥:', error)
                        const fallbackDate = new Date()
                        const year = fallbackDate.getFullYear()
                        const month = (fallbackDate.getMonth() + 1).toString().padStart(2, '0')
                        const day = fallbackDate.getDate().toString().padStart(2, '0')
                        return `${year}-${month}-${day}`
                    }
                }
                
                const today = getToday()
                if (today && today.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    addResult(`âœ… æµ‹è¯•3é€šè¿‡: getToday() è¿”å›æœ‰æ•ˆæ—¥æœŸ: ${today}`, 'success')
                } else {
                    addResult(`âŒ æµ‹è¯•3å¤±è´¥: getToday() è¿”å›æ— æ•ˆæ—¥æœŸ: ${today}`, 'error')
                }
            } catch (error) {
                addResult(`âŒ æµ‹è¯•3å¼‚å¸¸: ${error.message}`, 'error')
            }
            
            // æµ‹è¯•4: æ¨¡æ‹Ÿä¿®å¤åçš„ getMaxDate æ–¹æ³•
            try {
                const getMaxDate = () => {
                    try {
                        const today = MockIOSCompatibleDate.create(new Date())
                        if (today && !isNaN(today.getTime())) {
                            const maxDate = MockIOSCompatibleDate.addDays(today, 30)
                            return MockIOSCompatibleDate.format(maxDate, 'YYYY-MM-DD')
                        }
                        
                        // fallback
                        const fallbackDate = new Date()
                        fallbackDate.setDate(fallbackDate.getDate() + 30)
                        const year = fallbackDate.getFullYear()
                        const month = (fallbackDate.getMonth() + 1).toString().padStart(2, '0')
                        const day = fallbackDate.getDate().toString().padStart(2, '0')
                        return `${year}-${month}-${day}`
                    } catch (error) {
                        console.error('è·å–æœ€å¤§æ—¥æœŸå¤±è´¥:', error)
                        const fallbackDate = new Date()
                        fallbackDate.setDate(fallbackDate.getDate() + 30)
                        const year = fallbackDate.getFullYear()
                        const month = (fallbackDate.getMonth() + 1).toString().padStart(2, '0')
                        const day = fallbackDate.getDate().toString().padStart(2, '0')
                        return `${year}-${month}-${day}`
                    }
                }
                
                const maxDate = getMaxDate()
                if (maxDate && maxDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    addResult(`âœ… æµ‹è¯•4é€šè¿‡: getMaxDate() è¿”å›æœ‰æ•ˆæ—¥æœŸ: ${maxDate}`, 'success')
                } else {
                    addResult(`âŒ æµ‹è¯•4å¤±è´¥: getMaxDate() è¿”å›æ— æ•ˆæ—¥æœŸ: ${maxDate}`, 'error')
                }
            } catch (error) {
                addResult(`âŒ æµ‹è¯•4å¼‚å¸¸: ${error.message}`, 'error')
            }
            
            addResult('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'info')
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            addResult('ğŸ“± é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info')
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>