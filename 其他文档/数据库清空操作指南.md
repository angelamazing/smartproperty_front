# 数据库清空操作指南

## ⚠️ 重要警告

**这是一个极其危险的操作！** 清空数据库会永久删除所有数据，包括：
- 所有用户数据（除了系统管理员）
- 所有菜单记录
- 所有报餐记录
- 所有预约记录
- 所有统计数据

**请确保在操作前已备份数据库！**

## 📋 操作前准备

### 1. 确认数据库信息
- **数据库地址**: `https://uauotggfeiao.sealosbja.site`
- **数据库类型**: MySQL
- **保留数据**: 系统管理员用户和表结构

### 2. 安装依赖
```bash
cd h:\my-vue3-project
npm install axios
```

## 🚀 推荐方案：安全分步清空

### 使用安全清空脚本（推荐）

```bash
node scripts/safe-clear-database.js
```

**特点**：
- ✅ 分步骤执行，每步都需要确认
- ✅ 显示详细的数据统计信息
- ✅ 只删除非系统管理员用户
- ✅ 提供操作回滚机会
- ✅ 详细的错误处理和日志

### 操作流程

1. **步骤1：数据统计**
   - 显示当前用户和菜单数量
   - 确认是否继续操作

2. **步骤2：清空用户**
   - 删除所有非系统管理员用户
   - 保留系统管理员用户

3. **步骤3：清空菜单**
   - 删除所有菜单记录
   - 包括草稿、已发布、已撤回的菜单

4. **步骤4：最终确认**
   - 显示清理后的数据统计
   - 确认操作完成

## 🔧 备选方案

### 方案1：直接API清空

```bash
node scripts/clear-database-api.js
```

**特点**：
- ✅ 通过API接口操作，更安全
- ✅ 自动处理认证和权限
- ⚠️ 一次性清空，无分步确认

### 方案2：直接数据库操作

```bash
node scripts/database-clear-script.js
```

**特点**：
- ⚠️ 直接操作数据库，风险较高
- ⚠️ 需要修改数据库连接配置
- ⚠️ 需要手动确认数据库密码

## 📊 清空范围

### 将删除的数据
- ❌ 普通用户（role = 'user'）
- ❌ 部门管理员（role = 'dept_admin'）
- ❌ 所有菜单记录
- ❌ 所有报餐记录
- ❌ 所有预约记录
- ❌ 所有日志记录
- ❌ 所有统计数据

### 将保留的数据
- ✅ 系统管理员用户（role = 'sys_admin'）
- ✅ 所有表结构
- ✅ 角色定义
- ✅ 系统配置

## 🛡️ 安全措施

### 1. 操作前备份
```bash
# 建议先备份数据库
mysqldump -h uauotggfeiao.sealosbja.site -u username -p database_name > backup.sql
```

### 2. 分步确认
- 每个步骤都需要手动确认
- 可以随时取消操作
- 显示详细的操作日志

### 3. 错误处理
- 详细的错误信息
- 操作失败时的回滚建议
- 完整的操作日志

## 🚨 紧急恢复

如果误删了重要数据，可以：

1. **从备份恢复**
   ```bash
   mysql -h uauotggfeiao.sealosbja.site -u username -p database_name < backup.sql
   ```

2. **重新创建系统管理员**
   - 通过API接口创建新的系统管理员
   - 或直接操作数据库添加用户

## 📞 技术支持

如果在操作过程中遇到问题：

1. **检查网络连接**
   - 确保能访问 `https://uauotggfeiao.sealosbja.site`

2. **检查权限**
   - 确保有系统管理员权限

3. **查看日志**
   - 脚本会显示详细的操作日志
   - 根据错误信息进行排查

## ⚡ 快速开始

1. **打开命令行**
   ```bash
   cd h:\my-vue3-project
   ```

2. **运行安全清空脚本**
   ```bash
   node scripts/safe-clear-database.js
   ```

3. **按照提示操作**
   - 查看数据统计
   - 确认每个步骤
   - 等待操作完成

4. **验证结果**
   - 检查用户数量（应该只有系统管理员）
   - 检查菜单数量（应该为0）

---

**记住：操作前一定要备份数据库！**
