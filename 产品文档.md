# 智慧物业管理系统产品需求文档 (PRD)

## 一、概述

### 1.1 产品概述及目标

#### 1.1.1 背景介绍
随着移动互联网的普及和微信生态的完善，企事业单位对于智慧化管理的需求日益增长。传统的报餐和场地预约方式存在信息传递不及时、管理效率低下等问题。开发一个集成了报餐管理、场地预约、用户管理、系统管理等功能的智慧物业管理系统，能够有效解决这些问题，提升用户体验和管理效率。

#### 1.1.2 产品概述
本产品是一个基于Uni-app框架开发的智慧物业管理系统，主要包含以下核心模块：
- **报餐管理模块**：提供日常报餐、特殊预约报餐、菜单管理、报餐记录查询、部门报餐统计等功能
- **场地预约模块**：提供球馆场地预约、时间选择、预约记录管理、场地安排查看等功能
- **用户管理模块**：提供用户信息管理、角色权限管理、部门管理等功能
- **系统管理模块**：提供公告管理、系统设置、数据统计、权限控制等功能
- **个人中心模块**：提供个人信息管理、密码修改、通知设置等功能

产品采用Uni-app跨平台开发，支持H5、小程序、APP等多端部署，结合后端API服务，确保稳定性和可扩展性。

#### 1.1.3 产品目标

**业务目标**
- 近期目标（3个月内）：
  - 实现基础报餐和预约功能
  - 完成用户管理和权限控制
- 中期目标（6个月内）：
  - 完善用户体验和功能
  - 增加数据统计和分析功能
- 远期目标（12个月内）：
  - 扩展到更多服务场景
  - 实现智能化管理

**用户目标**
- 提供便捷的日常报餐体验，减少排队等待时间
- 提供便捷的特殊预约报餐体验，满足个性化用餐需求
- 简化球馆预约流程，提高场地利用率
- 提供完善的用户管理和权限控制
- 建立用户粘性，形成稳定的使用习惯

#### 1.1.4 目标用户
- **主要用户**：湖北省地质局第三地质大队的职工
- **管理员用户**：部门管理员、系统管理员
- **次要用户**：餐饮服务提供者、场地管理员等服务提供方

### 1.2 全局说明

#### 1.2.1 全局异常处理
- **网络异常**：显示网络错误提示，提供重试按钮
- **服务异常**：显示友好的错误信息，记录错误日志
- **权限异常**：引导用户进行身份验证或权限申请
- **数据异常**：显示数据加载失败提示，提供刷新功能

#### 1.2.2 普通列表规则
- **排序规则**：默认按时间倒序排列，支持自定义排序
- **分页规则**：每页显示20条记录，支持上拉加载更多
- **跳页规则**：支持页码跳转和快速跳转
- **缺省值**：列表为空时显示友好的空状态提示
- **统计规则**：显示总记录数和当前页信息

#### 1.2.3 全局交互
- **提示弹窗**：重要操作前显示确认弹窗
- **提示吐司**：操作成功/失败后显示状态提示
- **缺省数据显示**：数据为空时显示占位图和提示文字
- **操作弹窗**：复杂操作使用弹窗形式，提供更好的交互体验

### 1.3 名词说明
- **日常报餐**：用户通过小程序选择餐品并提交日常用餐需求
- **特殊预约报餐**：用户通过小程序提前预约特殊用餐需求，包含时间、人数、特殊要求等
- **预约**：用户通过小程序选择球馆场地和时间段
- **云开发**：微信提供的云端开发服务，包含云函数、云数据库等
- **小程序**：微信生态中的轻量级应用

### 1.4 角色及权限
- **普通用户**：可以日常报餐、特殊预约报餐、预约球馆、查看记录、管理个人信息
- **部门管理员**：可以管理本部门用户、查看部门报餐统计、审核特殊预约
- **系统管理员**：可以管理所有用户、菜单、场地、公告、系统配置、查看全局统计数据
- **超级管理员**：可以管理所有功能、用户权限、系统配置、验证方案配置等

### 1.5 文档阅读对象
本文档主要面向产品经理、UI设计师、前端开发工程师、后端开发工程师、测试工程师等研发团队成员。

## 二、产品描述

### 2.1 产品需求描述
开发一个功能完整、用户体验良好的智慧物业管理系统，集成报餐管理、场地预约、用户管理、系统管理等核心功能，为湖北省地质局第三地质大队提供便捷的一站式服务体验。

### 2.2 产品整体流程

#### 2.2.1 主流程
```
用户进入系统 → 身份验证 → 首页概览 → 选择功能模块 → 执行具体功能 → 完成操作 → 查看结果
```

#### 2.2.2 子流程
**日常报餐流程**：
```
选择报餐模块 → 查看今日菜单 → 选择餐品 → 确认订单 → 提交报餐 → 查看报餐记录
```

**特殊预约报餐流程**：
```
选择特殊预约报餐 → 填写预约信息 → 提交预约申请 → 等待审核 → 审核通过 → 确认用餐 → 完成用餐
```

**场地预约流程**：
```
选择预约模块 → 查看场地列表 → 选择日期时间 → 确认预约 → 提交预约 → 查看预约记录
```

**用户管理流程**（管理员）：
```
进入管理后台 → 选择用户管理 → 查看用户列表 → 添加/编辑/删除用户 → 设置权限 → 保存更改
```

**系统管理流程**（管理员）：
```
进入管理后台 → 选择管理功能 → 配置系统参数 → 发布公告 → 查看统计数据 → 系统维护
```

#### 2.2.3 数据流图（DFD）
- **外部实体**：用户、餐饮服务方、球馆管理方
- **数据存储**：用户信息、菜单数据、日常报餐记录、特殊预约记录、预约记录、报餐记录
- **数据处理**：身份验证、预约审核、订单处理、预约管理、数据统计

#### 2.2.4 状态转换图（STD）
- **用户状态**：未登录、已登录、已认证
- **日常报餐状态**：待确认、已确认、已完成、已取消
- **特殊预约状态**：待审核、审核通过、审核拒绝、已确认、已完成、已取消
- **预约状态**：待确认、已确认、已使用、已取消

#### 2.2.5 时序图
展示用户、小程序前端、云函数、数据库之间的交互时序关系。

### 2.3 产品版本规划（里程碑）
- **V1.0**（1个月）：基础功能开发，包含特殊预约报餐和预约的核心功能
- **V1.1**（2个月）：功能优化，提升用户体验
- **V2.0**（3个月）：增加高级功能，如数据分析、智能推荐等
- **V3.0**（6个月）：扩展到更多服务场景

### 2.4 产品框架
- **前端层**：Uni-app页面、Vue组件、工具函数、API接口
- **业务层**：后端API服务、业务逻辑处理、权限控制
- **数据层**：数据库、数据存储和查询、缓存管理
- **服务层**：第三方服务集成、消息推送、文件存储等

### 2.5 功能清单
- **报餐管理模块**：今日菜单查看、部门报餐、报餐记录查询、部门报餐统计、菜单历史管理
- **特殊预约报餐模块**：预约申请、信息填写、审核管理、状态跟踪
- **场地预约模块**：场地查看、时间选择、预约提交、预约记录管理、场地安排查看
- **用户管理模块**：用户信息管理、角色权限管理、部门管理、用户统计
- **系统管理模块**：公告管理、菜单管理、菜品管理、场地管理、系统设置、数据统计
- **个人中心模块**：个人信息管理、密码修改、通知设置、头像管理

## 三、功能需求

### 3.1 报餐管理模块

#### 3.1.1 描述
用户可以通过系统查看当日菜单，部门管理员为部门人员报名用餐，支持部门批量报餐和菜单查看功能。系统提供报餐记录查询、部门报餐统计、菜单历史管理等功能。

#### 3.1.2 用户故事
**普通用户故事**：作为用户，我希望能够方便地查看每日菜单，了解食堂提供的餐品，这样我就能知道今日的用餐安排。

**部门管理员故事**：作为部门管理员，我希望能够为部门成员批量报名用餐，查看部门报餐统计，这样我就能高效管理部门的用餐需求。

**系统管理员故事**：作为系统管理员，我希望能够查看食堂发布的今日菜单，这样我就能为所有用户提供准确的用餐信息。

#### 3.1.3 前置条件
- 用户需要完成微信授权登录
- 食堂需要发布当日的菜单信息
- 部门管理员需要具备部门管理权限
- 系统管理员需要具备菜单查看权限

#### 3.1.4 后置条件
- 报餐名单成功提交到系统
- 部门管理员可以在报餐记录中查看该名单
- 系统更新报餐统计数据
- 部门报餐数据同步更新

#### 3.1.5 界面及交互

**菜单查看界面**：
- **菜单页面**：显示当日菜单列表，支持分类查看
- **餐品详情**：显示餐品图片、描述、营养信息等（只读）
- **菜单信息**：显示菜单发布时间、用餐时间等

**部门报餐界面**：
- **部门选择**：显示用户所属部门信息
- **人员列表**：显示部门成员列表，支持勾选
- **批量报名**：支持为选中人员批量报名用餐
- **确认提交**：显示批量报名确认信息

**菜单查看界面**：
- **菜单展示**：只读显示食堂发布的菜单内容
- **分类查看**：支持按餐品类型分类查看
- **信息展示**：显示餐品名称、描述、营养信息等

#### 3.1.6 业务流程

**菜单查看流程**：
1. 用户进入菜单查看页面
2. 系统加载食堂发布的当日菜单数据
3. 用户浏览菜单内容（只读）
4. 查看餐品详情和营养信息
5. 返回菜单列表

**部门报餐流程**：
1. 部门管理员进入部门报餐页面
2. 系统加载部门成员列表
3. 管理员勾选需要用餐的部门成员
4. 确认批量报名信息
5. 系统验证权限和数据有效性
6. 批量提交报餐名单
7. 返回成功结果

**菜单发布流程**（食堂端）：
1. 食堂管理员发布今日菜单
2. 系统更新菜单状态
3. 向所有用户推送菜单更新通知
4. 用户可查看最新菜单

#### 3.1.7 异常/分支流程
- **权限不足**：提示用户申请权限
- **菜单未发布**：显示"今日菜单暂未发布"提示
- **网络异常**：显示重试按钮
- **重复报名**：提示用户已报名用餐
- **部门信息缺失**：提示联系管理员完善部门信息
- **批量报名失败**：显示失败原因，支持部分成功处理

#### 3.1.8 数据字典
- **用户信息**：用户ID、姓名、部门、权限、角色等
- **部门信息**：部门ID、部门名称、部门管理员、成员列表等
- **菜单信息**：餐品ID、名称、描述、营养信息、分类、状态、发布时间等（食堂发布，用户只读）
- **日常报餐记录**：记录ID、部门ID、报餐人ID、被报餐人ID、用餐日期、用餐类型、状态等
- **报餐统计信息**：日期、总报名人数、部门分布、用餐类型分布等

### 3.2 特殊预约报餐模块

#### 3.2.1 描述
用户可以通过小程序提前预约特殊用餐需求，包含预约时间、用餐人数、特殊要求等信息。系统支持多种验证方案：原有二维码验证、刷卡报餐验证、无需验证码/刷卡验证。管理员可以审核预约申请，确保用餐安排的合理性。

#### 3.2.2 用户故事
**普通用户故事**：作为用户，我希望能够提前预约特殊用餐需求，比如商务接待、会议用餐、特殊饮食要求等，这样我就能合理安排用餐时间，获得个性化的用餐服务。

**部门管理员故事**：作为部门管理员，我希望能够为部门成员批量预约特殊用餐，查看部门预约统计，这样我就能高效管理部门的特殊用餐需求。

**系统管理员故事**：作为系统管理员，我希望能够审核特殊预约申请，管理用餐验证方案，这样我就能确保用餐安排的合理性和系统的正常运行。

**用餐验证员故事**：作为用餐验证员，我希望能够通过多种方式验证用户的用餐资格，包括扫码、刷卡或直接确认，这样我就能根据餐厅实际情况灵活选择验证方式，提高工作效率。

#### 3.2.3 前置条件
- 用户需要完成微信授权登录
- 系统需要配置可用的用餐时间段
- 用户需要具备特殊预约报餐权限
- 部门管理员需要具备部门管理权限
- 系统管理员需要具备预约审核权限
- 用餐验证员需要具备相应验证权限

#### 3.2.4 后置条件
- 特殊预约申请成功提交到系统
- 用户可以在预约记录中查看该申请
- 系统更新预约统计数据
- 部门预约数据同步更新
- 预约审核状态更新
- 用餐验证结果记录到系统
- 验证员可以查看验证历史记录

#### 3.2.5 界面及交互

**特殊预约报餐界面**：
- **预约申请页面**：显示预约表单，包含时间选择、人数输入、特殊要求等
- **预约详情**：显示预约信息、审核状态、用餐安排等
- **预约确认**：显示预约确认信息，支持修改和取消
- **提交成功**：显示提交成功提示和预约编号

**部门预约界面**：
- **部门选择**：显示用户所属部门信息
- **人员列表**：显示部门成员列表，支持勾选
- **批量预约**：支持为选中人员批量填写预约信息
- **确认提交**：显示批量预约确认信息

**预约管理界面**：
- **预约审核**：支持查看、审核、拒绝预约申请
- **状态管理**：支持修改预约状态、用餐确认等
- **统计报表**：显示预约统计、用餐统计等数据

**用餐验证界面**：
- **验证方案选择**：根据系统配置显示可用的验证方式
- **方案①：原有二维码验证**：提供扫码按钮，调用微信扫码API
- **方案②：刷卡报餐验证**：提供刷卡验证功能，支持多种卡片类型
- **方案③：无需验证码/刷卡验证**：提供直接确认用餐功能
- **验证结果**：显示用户信息和用餐资格验证结果
- **操作按钮**：支持通过/拒绝用餐，记录验证状态
- **历史记录**：显示当日验证记录列表
- **统计信息**：显示当日用餐人数、验证通过率等数据

#### 3.2.6 业务流程

**特殊预约报餐流程**：
1. 用户进入特殊预约报餐页面
2. 系统加载可用的用餐时间段
3. 用户填写预约信息（时间、人数、特殊要求等）
4. 用户确认预约信息
5. 系统验证用户权限和预约有效性
6. 提交预约申请到数据库
7. 系统通知管理员审核
8. 返回提交成功结果

**预约审核流程**：
1. 管理员进入预约审核页面
2. 系统加载待审核的预约申请列表
3. 管理员查看预约详细信息
4. 管理员审核预约申请（通过/拒绝）
5. 系统更新预约状态
6. 通知用户审核结果
7. 返回审核完成结果

**用餐验证流程**：
根据系统配置的验证方案，执行相应的验证流程：

**方案①：原有二维码验证流程**：
1. 用餐人员进入用餐资格验证页面
2. 系统加载用户信息和今日预约状态
3. 用户点击扫码按钮，调用微信扫码API
4. 扫描餐厅提供的用餐验证码
5. 系统解析扫码结果，获取验证码信息
6. 验证验证码有效性，查询用户是否在今日预约名单中
7. 显示验证结果和用餐资格状态
8. 系统记录验证结果和操作时间
9. 更新当日用餐统计数据
10. 返回验证完成结果

**方案②：刷卡报餐验证流程**：
1. 用餐人员进入用餐资格验证页面
2. 系统加载用户信息和今日预约状态
3. 用户通过刷卡设备进行身份验证
4. 系统读取卡片信息，验证用户身份
5. 查询用户是否在今日预约名单中
6. 显示验证结果和用餐资格状态
7. 系统记录验证结果和操作时间
8. 更新当日用餐统计数据
9. 返回验证完成结果

**方案③：无需验证码/刷卡验证流程**：
1. 用餐人员进入用餐资格验证页面
2. 系统加载用户信息和今日预约状态
3. 用户点击"确认用餐"按钮
4. 系统验证用户是否在今日预约名单中
5. 显示验证结果和用餐资格状态
6. 系统记录验证结果和操作时间
7. 更新当日用餐统计数据
8. 返回验证完成结果

**验证员管理流程**（仅管理员和验证员可见）：
1. 验证员进入用餐资格验证页面
2. 系统加载当日用餐统计信息和验证历史
3. 验证员可以查看所有用户的验证记录
4. 验证员可以对验证通过的用户进行用餐确认或拒绝
5. 系统记录验证员的操作日志
6. 更新用户用餐状态和统计数据

#### 3.2.7 异常/分支流程
- **权限不足**：提示用户申请权限
- **时间段不可用**：显示"该时间段不可预约"提示
- **网络异常**：显示重试按钮
- **预约重复**：提示用户已预约该时间段
- **部门信息缺失**：提示联系管理员完善部门信息
- **批量预约失败**：显示失败原因，支持部分成功处理
- **审核失败**：显示拒绝原因，支持重新申请
- **验证失败**：根据验证方案显示相应错误提示
- **用户未预约**：显示"您今日无预约或预约未确认"提示
- **用户已用餐**：显示"您今日已用餐"提示，防止重复用餐
- **验证码无效**：提示"无效的验证码，请重新扫描"
- **刷卡失败**：提示"刷卡失败，请重新尝试"
- **网络连接异常**：显示网络错误提示，支持重试

#### 3.2.8 数据字典
- **用户信息**：用户ID、姓名、部门、权限、角色等
- **部门信息**：部门ID、部门名称、部门管理员、成员列表等
- **特殊预约信息**：预约ID、用户ID、预约时间、用餐人数、特殊要求、审核状态、预约类型等
- **预约审核记录**：审核ID、预约ID、审核员ID、审核结果、审核意见、审核时间等
- **用餐验证记录**：验证ID、用户ID、验证员ID、验证时间、验证结果、用餐状态、验证方式、验证码/卡片信息、备注等
- **用餐统计信息**：日期、总预约人数、已用餐人数、未用餐人数、验证通过率等
- **验证方案配置**：方案ID、方案名称、验证方式、适用场景、状态等

### 3.3 球馆预约模块

#### 3.3.1 描述
用户可以通过小程序查看球馆场地信息，选择合适的时间段进行预约，并管理预约记录。

#### 3.3.2 用户故事
作为用户，我希望能够方便地查看球馆的可用场地和时间，快速预约我需要的时段，这样我就能合理安排运动时间。

#### 3.3.3 前置条件
- 用户需要完成微信授权登录
- 系统需要配置球馆场地和时间段信息
- 用户需要具备预约权限

#### 3.3.4 后置条件
- 预约订单成功提交到系统
- 用户可以在预约记录中查看该订单
- 系统更新场地占用情况

#### 3.3.5 界面及交互
- **场地页面**：显示球馆场地列表，支持筛选查看
- **时间选择**：显示可用时间段，支持多选
- **预约确认**：显示选择的场地和时间，支持修改
- **提交成功**：显示预约成功提示和预约号

#### 3.3.6 业务流程
1. 用户进入预约页面
2. 系统加载场地和时间数据
3. 用户选择场地和时间段
4. 用户确认预约信息
5. 系统验证用户权限和时间冲突
6. 提交预约到数据库
7. 返回成功结果

#### 3.3.7 异常/分支流程
- **权限不足**：提示用户申请权限
- **时间冲突**：提示用户选择其他时间
- **场地已满**：提示用户选择其他场地
- **网络异常**：显示重试按钮

#### 3.3.8 数据字典
- **场地信息**：场地ID、名称、类型、容量、状态等
- **时间段信息**：时间段ID、开始时间、结束时间、状态等
- **预约信息**：预约ID、用户ID、场地ID、时间段ID、状态等

### 3.4 用户管理模块

#### 3.4.1 描述
系统管理员可以管理用户信息、角色权限、部门信息等。支持用户的增删改查、角色分配、权限控制等功能。

#### 3.4.2 用户故事
**系统管理员故事**：作为系统管理员，我希望能够管理所有用户信息，分配角色权限，这样我就能有效控制系统访问权限。

**部门管理员故事**：作为部门管理员，我希望能够管理本部门用户，查看部门统计信息，这样我就能更好地管理本部门。

#### 3.4.3 界面及交互
- **用户列表页面**：显示用户列表，支持搜索、筛选、分页
- **用户编辑页面**：支持添加、编辑、删除用户信息
- **角色管理页面**：管理用户角色和权限
- **部门管理页面**：管理部门信息和用户归属

#### 3.4.4 业务流程
1. 管理员进入用户管理页面
2. 系统加载用户列表数据
3. 管理员进行用户管理操作（增删改查）
4. 系统验证权限和数据有效性
5. 更新用户信息到数据库
6. 返回操作结果

### 3.5 系统管理模块

#### 3.5.1 描述
系统管理员可以管理公告、菜单、菜品、场地、系统设置等。提供数据统计、系统配置、权限控制等功能。

#### 3.5.2 用户故事
**系统管理员故事**：作为系统管理员，我希望能够管理系统的各个方面，查看统计数据，这样我就能全面掌控系统运行状态。

#### 3.5.3 界面及交互
- **管理首页**：显示系统概览和统计数据
- **公告管理页面**：发布、编辑、删除系统公告
- **菜单管理页面**：管理菜品和菜单信息
- **场地管理页面**：管理场地信息和时间安排
- **系统设置页面**：配置系统参数和权限

#### 3.5.4 业务流程
1. 管理员进入系统管理页面
2. 系统加载管理数据和统计信息
3. 管理员进行管理操作
4. 系统验证权限和数据有效性
5. 更新系统数据到数据库
6. 返回操作结果

### 3.6 个人中心模块

#### 3.6.1 描述
用户可以管理个人信息、修改密码、设置通知偏好、管理头像等。提供个人信息查看和编辑功能。

#### 3.6.2 用户故事
**普通用户故事**：作为用户，我希望能够管理我的个人信息，修改密码，这样我就能保持账户安全和信息准确。

#### 3.6.3 界面及交互
- **个人信息页面**：显示和编辑个人信息
- **密码修改页面**：修改登录密码
- **通知设置页面**：设置通知偏好
- **头像管理页面**：上传和管理头像

#### 3.6.4 业务流程
1. 用户进入个人中心页面
2. 系统加载用户个人信息
3. 用户进行信息修改操作
4. 系统验证数据有效性
5. 更新用户信息到数据库
6. 返回操作结果

## 四、非功能需求

### 4.1 安全需求
- 用户数据需要进行加密存储，确保敏感数据的安全
- 符合微信小程序的安全规范和隐私保护要求
- 实现用户身份验证和权限控制
- 支持多种验证方案的安全配置

### 4.2 统计需求
- 用户活跃度统计
- 日常报餐、特殊预约报餐和预约的使用频率统计
- 用户行为分析数据
- 验证方案使用效果统计

### 4.3 性能需求
- 支持并发用户访问，确保系统响应速度
- 页面加载时间控制在3秒以内
- 支持大规模数据存储和查询
- 支持多种验证方案的快速切换

### 4.4 数据库设计
- 采用云数据库，支持自动扩展
- 设计合理的数据结构，确保查询效率
- 实现数据备份和恢复机制
- 支持验证方案配置的动态管理

### 4.5 系统集成
- 与微信生态深度集成
- 支持消息推送和通知
- 预留第三方服务接口
- 支持刷卡设备等硬件集成

## 五、技术实现方案

### 5.1 系统架构

#### 5.1.1 技术架构
```
前端层 (Uni-app) → API层 (后端服务) → 数据层 (数据库) → 服务层 (第三方服务)
    ↓                ↓                ↓                ↓
Vue组件页面      业务逻辑处理      数据存储查询      消息推送等
```

#### 5.1.2 技术栈
- **前端框架**：Uni-app + Vue 3
- **UI组件**：自定义组件库
- **状态管理**：Vuex/Pinia
- **HTTP客户端**：uni.request
- **后端服务**：Node.js + Express
- **数据库**：MySQL/PostgreSQL
- **部署平台**：支持H5、小程序、APP多端部署

### 5.2 报餐管理功能实现

#### 5.2.1 功能概述
报餐管理功能是一个完整的用餐管理系统，支持菜单查看、部门报餐、报餐记录查询、部门统计等功能。

#### 5.2.2 核心功能模块

#### 5.1.3 核心功能模块

**1. 菜单展示模块**
- 支持菜单分类展示（只读）
- 餐品详情信息展示
- 菜单实时更新
- 餐品营养信息展示

**2. 报名管理模块**
- 部门批量报名处理
- 报名状态跟踪
- 报名历史查询
- 重复报名检测

**3. 菜单查看模块**
- 餐品信息展示（只读）
- 菜单分类管理
- 菜单状态显示
- 发布时间显示

**4. 数据统计模块**
- 报名数据统计
- 部门报名统计
- 用餐类型统计
- 生成数据报表

#### 5.1.4 数据库设计

**日常报餐记录表 (daily_dining_registration)**
```sql
{
  "_id": "报名记录ID",
  "deptId": "部门ID",
  "deptName": "部门名称",
  "registrantId": "报名人ID",
  "registrantName": "报名人姓名",
  "memberId": "被报名人ID",
  "memberName": "被报名人姓名",
  "diningDate": "用餐日期",
  "mealType": "用餐类型(breakfast/lunch/dinner)",
  "status": "报名状态(registered/cancelled)",
  "registrationType": "报名类型(individual/dept)",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

**菜单信息表 (menu_info)**
```sql
{
  "_id": "菜单ID",
  "publishDate": "发布日期",
  "mealType": "用餐类型",
  "dishList": "餐品列表",
  "nutritionInfo": "营养信息",
  "publishStatus": "发布状态(draft/published/archived)",
  "publisherId": "发布者ID（食堂管理员）",
  "publishTime": "发布时间",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

**餐品信息表 (dish_info)**
```sql
{
  "_id": "餐品ID",
  "dishName": "餐品名称",
  "dishDescription": "餐品描述",
  "nutritionInfo": "营养信息",
  "dishCategory": "餐品分类",
  "dishImage": "餐品图片",
  "isAvailable": "是否可用",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

#### 5.1.5 云函数设计

**1. submitDeptRegistration (提交部门报名)**
- 输入参数：部门ID、成员列表、用餐类型、用餐日期等
- 主要功能：
  - 验证部门权限
  - 检查重复报名
  - 批量创建报名记录
  - 更新统计数据
- 返回结果：报名结果、成功数量

**2. getMenuInfo (获取菜单信息)**
- 输入参数：用餐类型、日期等
- 主要功能：
  - 查询当日菜单
  - 过滤可用餐品
  - 返回菜单数据（只读）
- 返回结果：菜单信息、餐品列表

**3. getRegistrationList (获取报名列表)**
- 输入参数：部门ID、日期、状态等
- 主要功能：
  - 查询部门报名记录
  - 支持多条件筛选
  - 分页查询结果
- 返回结果：报名记录列表、分页信息

**4. getRegistrationStatistics (获取报名统计)**
- 输入参数：日期范围、部门ID等
- 主要功能：
  - 查询报名统计数据
  - 计算部门分布
  - 生成数据报表
- 返回结果：统计数据、图表数据

### 5.2 特殊预约报餐功能实现

#### 5.2.1 功能概述
特殊预约报餐功能是一个智能预约管理系统，让用户能够提前预约特殊用餐需求，包含预约时间、用餐人数、特殊要求等信息。系统支持多种验证方案，满足不同餐厅的实际需求，同时为管理员提供完整的预约审核和用餐管理功能。

#### 5.2.2 技术架构
```
前端页面 → 云函数 → 云数据库 → 预约结果
    ↓         ↓         ↓         ↓
预约表单   业务逻辑   数据存储   结果展示
```

#### 5.2.3 核心功能模块

**1. 预约申请模块**
- 支持用户填写预约信息（时间、人数、特殊要求等）
- 支持部门批量预约申请
- 预约时间冲突检测和提示
- 预约信息验证和完整性检查

**2. 预约审核模块**
- 管理员查看待审核预约列表
- 支持预约审核（通过/拒绝）
- 审核意见记录和通知
- 预约状态管理和跟踪

**3. 用餐验证模块**
- 支持三种验证方案：
  - 方案①：原有二维码验证
  - 方案②：刷卡报餐验证
  - 方案③：无需验证码/刷卡验证
- 验证方案配置管理
- 验证结果记录和统计

**4. 状态管理模块**
- 预约状态跟踪（待审核、审核通过、审核拒绝、已确认、已完成、已取消）
- 用餐状态管理（待验证、已验证、已用餐、拒绝用餐）
- 状态变更通知和日志记录

**5. 数据统计模块**
- 预约数据统计和分析
- 用餐验证数据统计
- 验证方案效果分析
- 生成数据报表和图表

#### 5.2.4 数据库设计

**特殊预约表 (special_dining_reservation)**
```sql
{
  "_id": "预约记录ID",
  "userId": "用户ID",
  "userName": "用户姓名",
  "deptId": "部门ID",
  "deptName": "部门名称",
  "reservationTime": "预约用餐时间",
  "diningDate": "用餐日期",
  "diningCount": "用餐人数",
  "specialRequirements": "特殊要求",
  "reservationType": "预约类型(individual/dept)",
  "status": "预约状态(pending/approved/rejected/confirmed/completed/cancelled)",
  "auditorId": "审核员ID",
  "auditorName": "审核员姓名",
  "auditTime": "审核时间",
  "auditResult": "审核结果",
  "auditComment": "审核意见",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

**预约审核记录表 (reservation_audit_log)**
```sql
{
  "_id": "审核记录ID",
  "reservationId": "预约ID",
  "auditorId": "审核员ID",
  "auditorName": "审核员姓名",
  "auditTime": "审核时间",
  "auditResult": "审核结果(approved/rejected)",
  "auditComment": "审核意见",
  "createTime": "创建时间"
}
```

**用餐验证记录表 (dining_verification)**
```sql
{
  "_id": "验证记录ID",
  "userId": "用户ID",
  "userName": "用户姓名",
  "deptId": "部门ID",
  "deptName": "部门名称",
  "verifierId": "验证员ID（可为空，用户自助验证时为空）",
  "verifierName": "验证员姓名（可为空，用户自助验证时为空）",
  "verificationTime": "验证时间",
  "verificationMethod": "验证方式(qr_code/card_swipe/direct_confirm)",
  "verificationCode": "验证码（二维码验证时使用）",
  "cardInfo": "卡片信息（刷卡验证时使用）",
  "verificationResult": "验证结果(qualified/unqualified)",
  "diningStatus": "用餐状态(pending/verified/dining/rejected)",
  "reservationId": "预约ID",
  "remark": "备注信息",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

**验证方案配置表 (verification_scheme_config)**
```sql
{
  "_id": "配置ID",
  "schemeName": "方案名称",
  "schemeType": "方案类型(qr_code/card_swipe/direct_confirm)",
  "description": "方案描述",
  "isEnabled": "是否启用",
  "priority": "优先级",
  "applicableScenarios": "适用场景",
  "configParams": "配置参数",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

**用餐统计表 (dining_statistics)**
```sql
{
  "_id": "统计记录ID",
  "date": "统计日期",
  "totalDailyOrders": "日常报餐总人数",
  "totalReservations": "特殊预约总人数",
  "verifiedCount": "已验证人数",
  "diningCount": "已用餐人数",
  "rejectedCount": "拒绝用餐人数",
  "verificationRate": "验证通过率",
  "diningRate": "用餐完成率",
  "qrCodeCount": "二维码验证次数",
  "cardSwipeCount": "刷卡验证次数",
  "directConfirmCount": "直接确认次数",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

#### 5.2.5 云函数设计

**1. submitSpecialReservation (提交特殊预约)**
- 输入参数：用户ID、预约时间、用餐人数、特殊要求等
- 主要功能：
  - 验证预约信息完整性
  - 检查时间冲突
  - 创建预约记录
  - 通知管理员审核
- 返回结果：预约状态、预约编号

**2. getReservationList (获取预约列表)**
- 输入参数：用户ID、状态、日期范围等
- 主要功能：
  - 查询用户预约记录
  - 支持多条件筛选
  - 分页查询结果
- 返回结果：预约记录列表、分页信息

**3. auditReservation (审核预约)**
- 输入参数：预约ID、审核员ID、审核结果、审核意见
- 主要功能：
  - 更新预约状态
  - 记录审核日志
  - 通知用户审核结果
- 返回结果：审核状态、审核时间

**4. verifyDiningQualification (验证用餐资格)**
- 输入参数：用户ID、验证方式、验证信息
- 主要功能：
  - 根据验证方式执行相应验证逻辑
  - 查询用户预约信息
  - 记录验证结果
  - 更新统计数据
- 返回结果：验证结果、用餐状态

**5. getDiningStatistics (获取用餐统计)**
- 输入参数：日期范围、统计类型
- 主要功能：
  - 查询用餐统计数据
  - 计算验证通过率
  - 生成数据报表
- 返回结果：统计数据、图表数据

**6. getVerificationHistory (获取验证历史)**
- 输入参数：日期、验证员ID、用户ID
- 主要功能：
  - 查询验证历史记录
  - 支持多条件筛选
  - 分页查询结果
- 返回结果：验证记录列表、分页信息

**7. configureVerificationScheme (配置验证方案)**
- 输入参数：方案配置信息
- 主要功能：
  - 创建或更新验证方案配置
  - 启用/禁用验证方案
  - 设置方案优先级
- 返回结果：配置状态、配置ID

#### 5.2.6 前端页面设计

**特殊预约报餐主页面 (pages/dining/special-reservation)**
- 页面功能：
  - 预约信息填写表单
  - 时间选择器
  - 人数输入控件
  - 特殊要求输入框
  - 提交按钮
  - 预约记录列表
  - 状态跟踪显示

**页面布局结构：**
```
┌─────────────────────────────────┐
│        特殊预约报餐             │
├─────────────────────────────────┤
│        预约信息表单             │
│  ┌─────────────────────────────┐ │
│  │ 用餐日期: [日期选择器]      │ │
│  │ 用餐时间: [时间选择器]      │ │
│  │ 用餐人数: [数字输入框]      │ │
│  │ 特殊要求: [文本输入框]      │ │
│  │ 联系人:   [文本输入框]      │ │
│  │ 联系电话: [文本输入框]      │ │
│  └─────────────────────────────┘ │
├─────────────────────────────────┤
│        操作按钮                 │
│  [提交预约]  [重置表单]        │
├─────────────────────────────────┤
│        预约记录列表             │
│  [查看详情]  [取消预约]        │
├─────────────────────────────────┤
│        状态跟踪                 │
│  预约状态  审核状态  用餐状态   │
└─────────────────────────────────┘
```

**用餐验证主页面 (pages/dining/verification)**
- 页面功能：
  - 用户信息展示卡片
  - 验证方案选择区域
  - 验证结果展示区域
  - 今日预约信息展示
  - 操作按钮（通过/拒绝，仅管理员和验证员可见）
  - 当日统计信息展示（仅管理员和验证员可见）
  - 验证历史记录列表（仅管理员和验证员可见）
  - 管理功能区域（仅管理员和验证员可见）

**页面布局结构：**
```
┌─────────────────────────────────┐
│        用餐资格验证             │
├─────────────────────────────────┤
│        用户信息卡片             │
│  ┌─────────────────────────────┐ │
│  │ 头像  姓名  部门  角色      │ │
│  └─────────────────────────────┘ │
├─────────────────────────────────┤
│        验证方案选择             │
│  [二维码验证] [刷卡验证] [直接确认] │
├─────────────────────────────────┤
│        验证结果展示区           │
│  ┌─────────────────────────────┐ │
│  │ 验证状态  用餐状态          │ │
│  │ 预约信息  用餐类型          │ │
│  └─────────────────────────────┘ │
├─────────────────────────────────┤
│        今日预约信息             │
│  预约状态  用餐类型  预约时间   │
├─────────────────────────────────┤
│    操作按钮（管理员可见）       │
│  [通过用餐]  [拒绝用餐]        │
├─────────────────────────────────┤
│    统计信息（管理员可见）       │
│  总预约: XX  已验证: XX        │
│  已用餐: XX  通过率: XX%       │
├─────────────────────────────────┤
│    验证历史（管理员可见）       │
│  [查看更多]                    │
├─────────────────────────────────┤
│    管理功能（管理员可见）       │
│  [验证方案配置] [生成验证码]    │
└─────────────────────────────────┘
```

#### 5.2.7 验证方案设计规范

**方案①：原有二维码验证**
- 餐厅生成验证码
- 用户扫码验证用餐资格
- 系统记录验证结果
- 支持验证码有效期管理

**方案②：刷卡报餐验证**
- 支持多种卡片类型（员工卡、访客卡等）
- 刷卡设备接口集成
- 实时数据同步和状态更新
- 卡片信息加密存储

**方案③：无需验证码/刷卡验证**
- 用户主动确认用餐
- 基于地理位置的自动验证
- 管理员手动确认用户用餐
- 基于时间的自动用餐确认

**验证码生成规则：**
- 使用JSON格式存储验证信息
- 包含唯一验证码标识符
- 添加日期限制防止过期使用
- 使用数字签名确保数据完整性
- 支持自定义二维码样式和大小
- 每个验证码只能使用一次

#### 5.2.8 安全机制

**1. 身份验证**
- 用户需要登录并具备相应权限
- 支持角色权限管理（普通用户、验证员、管理员）
- 记录所有操作日志
- 普通用户只能验证自己的用餐资格

**2. 数据安全**
- 用户信息加密存储
- 验证码数据传输加密
- 防止验证码重复使用
- 防止恶意验证攻击

**3. 操作审计**
- 记录所有验证操作（包括用户自助验证和验证员管理）
- 支持操作回滚
- 异常操作告警机制
- 区分不同验证类型的操作日志

#### 5.2.9 性能优化

**1. 缓存策略**
- 用户信息本地缓存
- 预约数据实时同步
- 统计结果定期更新

**2. 并发处理**
- 支持多用户同时验证
- 防止验证码重复使用
- 数据一致性保证
- 支持验证员和管理员同时管理

**3. 离线支持**
- 本地数据缓存
- 离线预约记录
- 网络恢复后数据同步
- 支持本地用户信息展示

#### 5.2.10 部署和运维

**1. 环境配置**
- 开发环境：支持测试数据
- 测试环境：模拟真实场景
- 生产环境：正式数据验证

**2. 监控告警**
- 系统性能监控
- 异常操作告警
- 数据统计监控

**3. 备份恢复**
- 数据定期备份
- 故障快速恢复
- 历史数据归档

## 六、页面结构和导航

### 6.1 整体页面结构

#### 6.1.1 页面层级
```
登录页面 (pages/login/login)
    ↓
首页 (pages/index/index)
    ↓
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│   报餐模块      │   预约模块      │   个人中心      │   管理后台      │
│ (pages/dining)  │(pages/reservation)│(pages/profile) │(pages/admin)   │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

#### 6.1.2 底部导航
- **首页**：系统概览、用户信息、快捷功能
- **报餐**：日常报餐、特殊预约报餐、报餐记录
- **预约**：场地预约、预约记录、场地安排
- **我的**：个人信息、设置、帮助

### 6.2 主要页面结构

#### 6.2.1 首页 (pages/index/index)
- **系统头部**：Logo、系统名称、用户信息
- **用户卡片**：头像、姓名、角色、操作按钮
- **系统概览**：统计数据、快捷功能
- **系统公告**：重要通知、公告列表
- **功能入口**：各模块快捷入口

#### 6.2.2 报餐模块 (pages/dining/dining)
- **标签页导航**：今日菜单、部门报餐、报餐记录
- **今日菜单**：菜单查看、餐品详情、日期选择
- **部门报餐**：人员选择、批量报餐、统计信息
- **报餐记录**：历史记录、查询筛选、详情查看

#### 6.2.3 预约模块 (pages/reservation/reservation)
- **标签页导航**：场地预约、预约记录、场地安排
- **场地预约**：场地列表、时间选择、预约确认
- **预约记录**：历史预约、状态管理、详情查看
- **场地安排**：场地状态、时间安排、占用情况

#### 6.2.4 个人中心 (pages/profile/profile)
- **用户信息**：头像、基本信息、角色权限
- **功能菜单**：个人信息、密码修改、通知设置
- **系统功能**：帮助中心、关于我们、退出登录

#### 6.2.5 管理后台 (pages/admin/index)
- **管理首页**：系统概览、统计数据、快捷操作
- **用户管理**：用户列表、权限管理、部门管理
- **系统管理**：公告管理、菜单管理、场地管理
- **数据统计**：使用统计、报表分析、数据导出

### 6.3 导航设计

#### 6.3.1 底部导航栏
- **首页**：🏠 首页
- **报餐**：🍽️ 报餐
- **预约**：🏟️ 预约
- **我的**：👤 我的

#### 6.3.2 页面导航
- **面包屑导航**：显示当前页面位置
- **返回按钮**：支持页面返回
- **标题栏**：显示页面标题和操作按钮

#### 6.3.3 权限导航
- **普通用户**：首页、报餐、预约、个人中心
- **部门管理员**：增加部门管理功能
- **系统管理员**：增加管理后台入口

### 6.4 响应式设计

#### 6.4.1 屏幕适配
- **手机端**：主要适配屏幕，单列布局
- **平板端**：双列布局，优化空间利用
- **桌面端**：多列布局，完整功能展示

#### 6.4.2 交互适配
- **触摸操作**：按钮大小适配手指点击
- **手势操作**：支持滑动、长按等手势
- **键盘操作**：支持Tab键导航

## 七、界面设计规范

### 7.1 设计原则

#### 7.1.1 一致性原则
- **视觉一致性**：统一的色彩、字体、图标风格
- **交互一致性**：统一的操作流程和反馈方式
- **功能一致性**：相似功能使用相同的交互模式

#### 7.1.2 易用性原则
- **简洁明了**：界面简洁，信息层次清晰
- **操作便捷**：减少操作步骤，提高效率
- **反馈及时**：操作后及时给予反馈

#### 7.1.3 美观性原则
- **现代设计**：采用现代化的设计风格
- **色彩搭配**：合理的色彩搭配和对比度
- **空间布局**：合理的留白和间距

### 7.2 视觉规范

#### 7.2.1 色彩规范
- **主色调**：#667eea (蓝色)
- **辅助色**：#10b981 (绿色)、#f59e0b (橙色)、#ef4444 (红色)
- **中性色**：#6c757d (灰色)、#f8f9fa (浅灰)
- **文字色**：#333333 (深灰)、#666666 (中灰)、#999999 (浅灰)

#### 7.2.2 字体规范
- **标题字体**：28rpx-32rpx，加粗
- **正文字体**：22rpx-24rpx，常规
- **提示字体**：20rpx-22rpx，常规
- **按钮字体**：20rpx-22rpx，加粗

#### 7.2.3 间距规范
- **页面内边距**：16rpx-24rpx
- **组件间距**：12rpx-16rpx
- **元素间距**：6rpx-12rpx
- **边框圆角**：8rpx-12rpx

### 7.3 组件规范

#### 7.3.1 按钮规范
- **主要按钮**：48rpx高度，主色调背景
- **次要按钮**：40rpx高度，边框样式
- **图标按钮**：40rpx尺寸，圆形设计
- **悬停效果**：颜色变化、阴影效果

#### 7.3.2 表单规范
- **输入框**：48rpx高度，边框样式
- **选择器**：48rpx高度，下拉样式
- **标签页**：40rpx高度，切换样式
- **卡片**：圆角设计，阴影效果

#### 7.3.3 导航规范
- **底部导航**：60rpx高度，图标+文字
- **顶部导航**：88rpx高度，标题+操作
- **侧边导航**：全屏高度，列表样式

### 7.4 交互规范

#### 7.4.1 动画效果
- **页面切换**：滑动动画，300ms
- **按钮点击**：缩放动画，200ms
- **加载状态**：旋转动画，持续
- **悬停效果**：颜色渐变，200ms

#### 7.4.2 反馈机制
- **操作成功**：绿色提示，2秒
- **操作失败**：红色提示，3秒
- **加载状态**：加载图标，持续
- **确认操作**：弹窗确认，用户选择

#### 7.4.3 状态管理
- **正常状态**：默认样式
- **悬停状态**：颜色变化
- **激活状态**：高亮显示
- **禁用状态**：灰色显示
