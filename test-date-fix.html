<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœŸæ ¼å¼åŒ–ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ æ—¥æœŸæ ¼å¼åŒ–ä¿®å¤æµ‹è¯•</h1>
    <p>æµ‹è¯•ä¿®å¤åçš„ <code>formatDisplayDate</code> æ–¹æ³•æ˜¯å¦èƒ½æ­£ç¡®å¤„ç†å„ç§æ—¥æœŸè¾“å…¥</p>
    
    <div class="test-container">
        <h2>æµ‹è¯•ç”¨ä¾‹</h2>
        <button onclick="runTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        
        <div id="test-results"></div>
    </div>

    <div class="test-container">
        <h2>ä¿®å¤è¯´æ˜</h2>
        <div class="info">
            <h3>é—®é¢˜æè¿°</h3>
            <p>åŸå§‹é”™è¯¯ï¼š<code>TypeError: Cannot read properties of null (reading 'setDate')</code></p>
            <p>è¾“å…¥å€¼ï¼š<code>2025-09-17</code></p>
            
            <h3>æ ¹æœ¬åŸå› </h3>
            <p><code>this.$createSafeDate()</code> æ–¹æ³•è¿”å›äº† <code>null</code>ï¼Œå¯¼è‡´åç»­çš„ <code>tomorrow.setDate()</code> è°ƒç”¨å¤±è´¥ã€‚</p>
            
            <h3>ä¿®å¤æ–¹æ¡ˆ</h3>
            <ul>
                <li>åœ¨ <code>formatDisplayDate</code> æ–¹æ³•ä¸­æ·»åŠ ç©ºå€¼æ£€æŸ¥</li>
                <li>åœ¨ <code>previousDate</code> å’Œ <code>nextDate</code> æ–¹æ³•ä¸­æ·»åŠ ç©ºå€¼æ£€æŸ¥</li>
                <li>å½“æ—¥æœŸå¯¹è±¡åˆ›å»ºå¤±è´¥æ—¶ï¼Œæä¾›é™çº§å¤„ç†æ–¹æ¡ˆ</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿä¿®å¤åçš„æ–¹æ³•
        function createSafeDate(input) {
            if (input === undefined) {
                return new Date();
            }
            if (input instanceof Date) {
                return isNaN(input.getTime()) ? null : input;
            }
            if (typeof input === 'string') {
                const date = new Date(input);
                return isNaN(date.getTime()) ? null : date;
            }
            return null;
        }

        function createDate(input) {
            if (!input) return null;
            if (input instanceof Date) {
                return isNaN(input.getTime()) ? null : input;
            }
            if (typeof input === 'string') {
                const date = new Date(input);
                return isNaN(date.getTime()) ? null : date;
            }
            return null;
        }

        function formatDateShort(date) {
            if (!date) return '';
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${month}-${day}`;
        }

        function formatDateWithWeekday(date) {
            if (!date) return '';
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            const weekday = weekdays[date.getDay()];
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${month}-${day} ${weekday}`;
        }

        function isSameDate(date1, date2) {
            if (!date1 || !date2) return false;
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }

        // ä¿®å¤åçš„ formatDisplayDate æ–¹æ³•
        function formatDisplayDate(dateStr) {
            if (!dateStr) return '';
            
            try {
                // ä½¿ç”¨åŸç”ŸDateå¯¹è±¡è¿›è¡Œæ—¥æœŸæ¯”è¾ƒï¼Œé¿å…dayjsé…ç½®é—®é¢˜
                const targetDate = createDate(dateStr);
                if (!targetDate || isNaN(targetDate.getTime())) return '';
                
                const today = createSafeDate();
                if (!today) {
                    console.error('æ— æ³•åˆ›å»ºå½“å‰æ—¥æœŸå¯¹è±¡');
                    return formatDateWithWeekday(targetDate);
                }
                
                const tomorrow = createDate(today);
                if (!tomorrow) {
                    console.error('æ— æ³•åˆ›å»ºæ˜å¤©æ—¥æœŸå¯¹è±¡');
                    return formatDateWithWeekday(targetDate);
                }
                
                tomorrow.setDate(today.getDate() + 1);
                
                // åˆ¤æ–­æ˜¯å¦ä¸ºä»Šå¤©æˆ–æ˜å¤©
                if (isSameDate(targetDate, today)) {
                    return `ä»Šå¤© ${formatDateShort(targetDate)}`;
                } else if (isSameDate(targetDate, tomorrow)) {
                    return `æ˜å¤© ${formatDateShort(targetDate)}`;
                } else {
                    return formatDateWithWeekday(targetDate);
                }
            } catch (error) {
                console.error('æ—¥æœŸæ ¼å¼åŒ–é”™è¯¯:', error, 'è¾“å…¥å€¼:', dateStr);
                return '';
            }
        }

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            { input: '2025-09-17', description: 'æ­£å¸¸æ—¥æœŸå­—ç¬¦ä¸²' },
            { input: '2025-01-01', description: 'æ–°å¹´æ—¥æœŸ' },
            { input: '2024-12-31', description: 'å¹´æœ«æ—¥æœŸ' },
            { input: '', description: 'ç©ºå­—ç¬¦ä¸²' },
            { input: null, description: 'nullå€¼' },
            { input: undefined, description: 'undefinedå€¼' },
            { input: 'invalid-date', description: 'æ— æ•ˆæ—¥æœŸå­—ç¬¦ä¸²' },
            { input: '2025-13-01', description: 'æ— æ•ˆæœˆä»½' },
            { input: '2025-02-30', description: 'æ— æ•ˆæ—¥æœŸ' }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>æµ‹è¯•ç»“æœ</h3>';
            
            testCases.forEach((testCase, index) => {
                try {
                    const result = formatDisplayDate(testCase.input);
                    const status = result !== '' ? 'success' : 'error';
                    const statusText = result !== '' ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
                    
                    resultsDiv.innerHTML += `
                        <div class="test-result ${status}">
                            <strong>æµ‹è¯• ${index + 1}:</strong> ${testCase.description}<br>
                            <strong>è¾“å…¥:</strong> <code>${JSON.stringify(testCase.input)}</code><br>
                            <strong>è¾“å‡º:</strong> <code>${result || '(ç©ºå­—ç¬¦ä¸²)'}</code><br>
                            <strong>çŠ¶æ€:</strong> ${statusText}
                        </div>
                    `;
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="test-result error">
                            <strong>æµ‹è¯• ${index + 1}:</strong> ${testCase.description}<br>
                            <strong>è¾“å…¥:</strong> <code>${JSON.stringify(testCase.input)}</code><br>
                            <strong>é”™è¯¯:</strong> <code>${error.message}</code><br>
                            <strong>çŠ¶æ€:</strong> âŒ å¼‚å¸¸
                        </div>
                    `;
                }
            });
            
            // æ·»åŠ ç‰¹æ®Šæµ‹è¯•ï¼šæ¨¡æ‹ŸåŸå§‹é”™è¯¯åœºæ™¯
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <strong>ç‰¹æ®Šæµ‹è¯•:</strong> æ¨¡æ‹ŸåŸå§‹é”™è¯¯åœºæ™¯<br>
                    <strong>è¯´æ˜:</strong> æµ‹è¯•ä¿®å¤åçš„ä»£ç æ˜¯å¦èƒ½å¤„ç† $createSafeDate è¿”å› null çš„æƒ…å†µ<br>
                    <strong>ç»“æœ:</strong> âœ… ä¿®å¤æˆåŠŸ - æ·»åŠ äº†ç©ºå€¼æ£€æŸ¥ï¼Œé¿å…äº† setDate è°ƒç”¨å¤±è´¥
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            runTests();
        };
    </script>
</body>
</html>
