# 公告时间段功能对接文档

## 📋 概述

本文档专门为前端开发人员提供公告时间段功能的对接说明。该功能支持设置公告的生效时间段，**只需要填写日期，不需要精确到时分秒**。

**文档版本**: v1.0  
**最后更新**: 2025-01-27  
**适用范围**: 前端开发人员

---

## 🎯 功能说明

### 时间段公告特性
- ✅ **简化时间输入**：只需填写日期，系统自动处理时间
- ✅ **灵活配置**：支持永久公告和临时公告
- ✅ **自动生效**：系统根据时间段自动控制公告显示状态
- ✅ **用户友好**：前端只需提供日期选择器，无需复杂的时间选择

### 时间处理规则
- **开始时间**：如果只填写日期，系统自动设置为 `00:00:00`
- **结束时间**：如果只填写日期，系统自动设置为 `23:59:59`
- **永久公告**：不填写时间字段，公告永久有效

---

## 🔌 API接口对接

### 1. 创建时间段公告

**接口地址**: `POST /api/admin/notices`

**请求头**:
```http
Authorization: Bearer <your-jwt-token>
Content-Type: application/json
```

**请求体参数**:

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| title | string | 是 | 公告标题（最大200字符） | "系统维护通知" |
| content | string | 是 | 公告内容 | "系统将于指定时间进行维护..." |
| type | string | 否 | 公告类型 | "info", "warning", "error", "success" |
| priority | number | 否 | 优先级（0-10） | 5 |
| status | string | 否 | 状态 | "draft", "published", "archived" |
| **startDate** | string | 否 | **开始日期（YYYY-MM-DD格式）** | "2025-01-27" |
| **endDate** | string | 否 | **结束日期（YYYY-MM-DD格式）** | "2025-01-31" |
| isSticky | boolean | 否 | 是否置顶 | true |
| targetUsers | array | 否 | 目标用户ID数组 | ["user1", "user2"] |

**重要说明**：
- `startDate` 和 `endDate` 为**可选字段**
- 如果只填写 `startDate`，结束时间默认为当天 23:59:59
- 如果只填写 `endDate`，开始时间默认为当天 00:00:00
- 如果都不填写，创建永久公告

**请求示例**:

#### 示例1：创建临时公告（推荐）
```json
{
  "title": "春节放假通知",
  "content": "根据国家法定节假日安排，系统将于春节期间暂停服务...",
  "type": "info",
  "priority": 3,
  "status": "draft",
  "startDate": "2025-02-10",
  "endDate": "2025-02-17",
  "isSticky": true
}
```

#### 示例2：创建永久公告
```json
{
  "title": "系统使用说明",
  "content": "欢迎使用智慧物业管理系统，请仔细阅读以下使用说明...",
  "type": "info",
  "priority": 1,
  "status": "published",
  "isSticky": false
}
```

#### 示例3：创建单日公告
```json
{
  "title": "系统升级通知",
  "content": "系统将于明天进行升级维护...",
  "type": "warning",
  "priority": 5,
  "startDate": "2025-01-28",
  "endDate": "2025-01-28"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "公告创建成功",
  "data": {
    "_id": "notice-002",
    "title": "春节放假通知",
    "content": "根据国家法定节假日安排，系统将于春节期间暂停服务...",
    "type": "info",
    "priority": 3,
    "status": "draft",
    "startTime": "2025-02-10T00:00:00.000Z",
    "endTime": "2025-02-17T23:59:59.000Z",
    "isSticky": true,
    "publisherId": "admin-001",
    "publisherName": "系统管理员",
    "publishTime": null,
    "createTime": "2025-01-27T03:00:00.000Z",
    "updateTime": "2025-01-27T03:00:00.000Z"
  }
}
```

---

### 2. 更新公告时间段

**接口地址**: `PUT /api/admin/notices/:noticeId`

**请求体参数**（所有字段都是可选的）:

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 否 | 公告标题 |
| content | string | 否 | 公告内容 |
| **startDate** | string | 否 | **开始日期（YYYY-MM-DD格式）** |
| **endDate** | string | 否 | **结束日期（YYYY-MM-DD格式）** |
| type | string | 否 | 公告类型 |
| priority | number | 否 | 优先级 |
| status | string | 否 | 状态 |
| isSticky | boolean | 否 | 是否置顶 |

**请求示例**:
```json
{
  "title": "春节放假通知（更新）",
  "startDate": "2025-02-11",
  "endDate": "2025-02-18",
  "priority": 5
}
```

---

### 3. 获取公告列表

**接口地址**: `GET /api/admin/notices`

**查询参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | number | 否 | 页码（默认1） |
| pageSize | number | 否 | 每页数量（默认20） |
| status | string | 否 | 状态筛选 |
| type | string | 否 | 类型筛选 |
| keyword | string | 否 | 关键词搜索 |

**响应示例**:
```json
{
  "success": true,
  "message": "获取公告列表成功",
  "data": {
    "records": [
      {
        "_id": "notice-001",
        "title": "春节放假通知",
        "content": "根据国家法定节假日安排...",
        "type": "info",
        "priority": 3,
        "status": "published",
        "startTime": "2025-02-10T00:00:00.000Z",
        "endTime": "2025-02-17T23:59:59.000Z",
        "isSticky": true,
        "viewCount": 0,
        "publisherId": "admin-001",
        "publisherName": "系统管理员",
        "publishTime": "2025-01-27T02:51:39.000Z",
        "createTime": "2025-01-27T02:51:39.000Z",
        "updateTime": "2025-01-27T02:51:39.000Z"
      }
    ],
    "total": 15,
    "page": 1,
    "pageSize": 20,
    "hasMore": true,
    "totalPages": 1
  }
}
```

---

## 🎨 前端实现建议

### 1. 表单设计

#### 公告创建/编辑表单
```html
<form id="noticeForm">
  <!-- 基本信息 -->
  <div class="form-group">
    <label for="title">公告标题 *</label>
    <input type="text" id="title" name="title" required maxlength="200">
  </div>
  
  <div class="form-group">
    <label for="content">公告内容 *</label>
    <textarea id="content" name="content" required></textarea>
  </div>
  
  <!-- 时间段设置 -->
  <div class="form-group">
    <label>生效时间段</label>
    <div class="time-range">
      <div class="form-group">
        <label for="startDate">开始日期</label>
        <input type="date" id="startDate" name="startDate">
      </div>
      <div class="form-group">
        <label for="endDate">结束日期</label>
        <input type="date" id="endDate" name="endDate">
      </div>
    </div>
    <div class="form-hint">
      <small>不填写时间则创建永久公告</small>
    </div>
  </div>
  
  <!-- 其他字段 -->
  <div class="form-group">
    <label for="type">公告类型</label>
    <select id="type" name="type">
      <option value="info">信息</option>
      <option value="warning">警告</option>
      <option value="error">错误</option>
      <option value="success">成功</option>
    </select>
  </div>
  
  <div class="form-group">
    <label for="priority">优先级</label>
    <input type="number" id="priority" name="priority" min="0" max="10" value="0">
  </div>
  
  <div class="form-group">
    <label>
      <input type="checkbox" id="isSticky" name="isSticky">
      置顶显示
    </label>
  </div>
</form>
```

### 2. JavaScript处理

#### 数据提交处理
```javascript
// 提交公告表单
function submitNoticeForm() {
  const formData = new FormData(document.getElementById('noticeForm'));
  
  // 构建请求数据
  const noticeData = {
    title: formData.get('title'),
    content: formData.get('content'),
    type: formData.get('type') || 'info',
    priority: parseInt(formData.get('priority')) || 0,
    isSticky: formData.get('isSticky') === 'on'
  };
  
  // 处理时间段
  const startDate = formData.get('startDate');
  const endDate = formData.get('endDate');
  
  if (startDate) {
    noticeData.startDate = startDate;
  }
  if (endDate) {
    noticeData.endDate = endDate;
  }
  
  // 发送请求
  fetch('/api/admin/notices', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${getToken()}`
    },
    body: JSON.stringify(noticeData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('公告创建成功');
      // 刷新列表或跳转
    } else {
      alert('创建失败：' + data.message);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('网络错误，请重试');
  });
}
```

#### 日期验证
```javascript
// 日期验证函数
function validateDateRange() {
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  
  if (startDate && endDate) {
    if (new Date(startDate) > new Date(endDate)) {
      alert('开始日期不能晚于结束日期');
      return false;
    }
  }
  
  return true;
}

// 绑定验证事件
document.getElementById('startDate').addEventListener('change', validateDateRange);
document.getElementById('endDate').addEventListener('change', validateDateRange);
```

### 3. 列表显示

#### 公告列表项
```html
<div class="notice-item">
  <div class="notice-header">
    <h3 class="notice-title">春节放假通知</h3>
    <span class="notice-type info">信息</span>
    <span class="notice-priority">优先级: 3</span>
  </div>
  
  <div class="notice-content">
    根据国家法定节假日安排，系统将于春节期间暂停服务...
  </div>
  
  <div class="notice-meta">
    <div class="notice-time">
      <span class="time-label">生效时间：</span>
      <span class="time-range">2025-02-10 至 2025-02-17</span>
    </div>
    <div class="notice-status">
      <span class="status published">已发布</span>
      <span class="sticky">置顶</span>
    </div>
  </div>
  
  <div class="notice-actions">
    <button onclick="editNotice('notice-001')">编辑</button>
    <button onclick="deleteNotice('notice-001')">删除</button>
  </div>
</div>
```

#### 时间显示处理
```javascript
// 格式化时间显示
function formatNoticeTime(startTime, endTime) {
  if (!startTime && !endTime) {
    return '永久有效';
  }
  
  const start = new Date(startTime);
  const end = new Date(endTime);
  
  const startStr = start.toLocaleDateString('zh-CN');
  const endStr = end.toLocaleDateString('zh-CN');
  
  if (startStr === endStr) {
    return startStr; // 同一天
  } else {
    return `${startStr} 至 ${endStr}`;
  }
}
```

---

## 📝 数据格式说明

### 日期格式要求
- **输入格式**：`YYYY-MM-DD`（如：2025-01-27）
- **系统处理**：
  - 开始日期 → `YYYY-MM-DD 00:00:00`
  - 结束日期 → `YYYY-MM-DD 23:59:59`
- **返回格式**：ISO8601格式（如：2025-01-27T00:00:00.000Z）

### 字段映射关系
| 前端字段 | 后端字段 | 说明 |
|----------|----------|------|
| startDate | startTime | 开始时间（自动添加 00:00:00） |
| endDate | endTime | 结束时间（自动添加 23:59:59） |

---

## ⚠️ 注意事项

### 1. 时间处理
- 系统会自动将日期转换为完整的日期时间
- 开始时间默认为当天的 00:00:00
- 结束时间默认为当天的 23:59:59

### 2. 验证规则
- 开始日期不能晚于结束日期
- 日期格式必须为 YYYY-MM-DD
- 如果只填写一个日期，另一个默认为同一天

### 3. 用户体验
- 建议使用日期选择器而不是文本输入
- 提供"永久公告"选项（不填写时间）
- 在界面上清楚显示公告的有效期

---

## 🔍 常见问题

### Q1: 如何创建永久公告？
A: 不填写 startDate 和 endDate 字段即可。

### Q2: 如何创建单日公告？
A: 将 startDate 和 endDate 设置为同一天。

### Q3: 时间格式有什么要求？
A: 必须使用 YYYY-MM-DD 格式，如：2025-01-27。

### Q4: 系统如何处理时区？
A: 系统使用 UTC 时间，前端显示时会自动转换为本地时间。

---

## 📞 技术支持

如有问题请联系后端开发团队或查看系统日志获取详细错误信息。

---

**注意**: 本文档专门为前端开发人员设计，简化了时间输入要求，只需要填写日期即可实现时间段公告功能。
