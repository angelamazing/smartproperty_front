# 扫码确认就餐功能使用说明

## 📋 功能概述

扫码确认就餐功能允许用户通过扫描二维码自动确认就餐，系统会根据当前时间自动判断餐次（早中晚），并自动执行确认就餐操作。

## 🎯 功能特点

- **自动识别餐次**：根据当前时间自动判断是早餐、午餐还是晚餐
- **自动确认就餐**：无需手动操作，扫码后自动确认
- **智能错误处理**：处理各种异常情况并给出友好提示
- **登录状态检查**：未登录用户自动跳转登录页面
- **结果反馈**：清晰显示确认结果和相关信息

## 🔧 配置步骤

### 1. 微信小程序管理后台配置

1. 登录微信小程序管理后台
2. 进入「开发」→「开发管理」→「开发设置」
3. 在「业务域名」中添加你的服务器域名
4. 进入「开发」→「开发管理」→「开发设置」→「扫普通链接二维码打开小程序」
5. 添加规则：
   - **规则名称**：扫码确认就餐
   - **匹配规则**：`https://yourdomain.com/qr-confirm-dining`
   - **小程序页面路径**：`pages/dining/qr-confirm-dining`
   - **测试范围**：开发版/体验版/正式版

### 2. 生成二维码

在微信小程序管理后台生成二维码，二维码内容为：
```
https://yourdomain.com/qr-confirm-dining
```

## 📱 页面路径

```
/pages/dining/qr-confirm-dining
```

## ⏰ 时间判断规则

| 餐次 | 时间范围 | 说明 |
|------|----------|------|
| 早餐 | 06:00-10:00 | 早上6点到10点 |
| 午餐 | 11:00-14:00 | 上午11点到下午2点 |
| 晚餐 | 17:00-20:00 | 下午5点到晚上8点 |

## 🔄 工作流程

1. **用户扫码** → 跳转到确认页面
2. **检查登录** → 未登录则提示登录并保存当前页面路径
3. **跳转登录** → 用户点击"重新确认"跳转到登录页面
4. **登录成功** → 自动跳转回扫码确认页面
5. **判断餐次** → 根据当前时间判断餐次
6. **获取状态** → 查询用户报餐状态
7. **自动确认** → 调用确认就餐接口
8. **显示结果** → 展示确认结果

## 📊 结果展示

### 成功情况
- ✅ 确认就餐成功
- 显示餐次、确认时间、订单号等信息

### 失败情况
- ❌ 确认就餐失败
- 显示具体错误原因和建议操作

### 时间不在范围内
- ⏰ 不在就餐时间内
- 显示当前时间和下次就餐时间

## 🛠️ 技术实现

### 核心文件
- `src/pages/dining/qr-confirm-dining.vue` - 主页面
- `src/utils/timeUtils.js` - 时间处理工具
- `src/utils/auth.js` - 认证工具
- `src/utils/api.js` - API调用工具

### 关键方法
- `getCurrentMealType()` - 获取当前餐次
- `checkLoginStatus()` - 检查登录状态
- `autoConfirmDining()` - 自动确认就餐
- `handleConfirmSuccess()` - 处理确认成功

## 🎨 页面样式

- **主题色**：绿色 (#07c160)
- **成功色**：绿色 (#28a745)
- **错误色**：红色 (#dc3545)
- **警告色**：黄色 (#ffc107)

## 🔍 调试功能

开发环境下会显示调试信息：
- 当前时间
- 判断的餐次
- 登录状态
- 用户信息

## 📝 使用注意事项

1. **时间准确性**：确保设备时间准确，系统基于设备时间判断餐次
2. **网络连接**：需要稳定的网络连接来调用API
3. **登录状态**：用户必须先登录才能使用此功能
4. **报餐状态**：用户必须先报餐才能确认就餐
5. **登录跳转**：未登录用户登录成功后会自动跳转回扫码确认页面

## 🚀 部署说明

1. 确保所有文件已正确上传
2. 在pages.json中已注册页面
3. 配置微信小程序管理后台
4. 测试二维码扫描功能

## 📞 技术支持

如遇到问题，请检查：
1. 网络连接是否正常
2. 用户是否已登录
3. 用户是否已报餐
4. 当前时间是否在就餐时间内
5. 服务器API是否正常

---

**开发完成时间**：2025年1月
**版本**：v1.0.0
**开发者**：AI Assistant
