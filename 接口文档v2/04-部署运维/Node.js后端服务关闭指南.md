# Node.jsåç«¯æœåŠ¡å…³é—­æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†å¤šç§å…³é—­Node.jsåç«¯æœåŠ¡çš„æ–¹æ³•ï¼Œé€‚ç”¨äºä¸åŒçš„è¿è¡Œåœºæ™¯å’Œéœ€æ±‚ã€‚

## ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€

### 1. æŸ¥çœ‹å½“å‰è¿è¡Œçš„Node.jsè¿›ç¨‹
```bash
# æŸ¥çœ‹æ‰€æœ‰Node.jsè¿›ç¨‹
ps aux | grep node

# æŸ¥çœ‹ç‰¹å®šç«¯å£çš„æœåŠ¡
netstat -tlnp | grep :3000

# æŸ¥çœ‹é¡¹ç›®ç›¸å…³çš„Node.jsè¿›ç¨‹
ps aux | grep -E "(server\.js|node.*server|nodemon)" | grep -v grep
```

### 2. æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
```bash
# æ£€æŸ¥3000ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep :3000

# æˆ–è€…ä½¿ç”¨sså‘½ä»¤
ss -tlnp | grep :3000
```

## ğŸ›‘ å…³é—­æœåŠ¡çš„æ–¹æ³•

### æ–¹æ³•1: ä¼˜é›…å…³é—­ï¼ˆæ¨èï¼‰

#### 1.1 ä½¿ç”¨Ctrl+C
å¦‚æœæœåŠ¡åœ¨ç»ˆç«¯å‰å°è¿è¡Œï¼š
```bash
# åœ¨è¿è¡ŒæœåŠ¡çš„ç»ˆç«¯ä¸­æŒ‰ Ctrl+C
Ctrl + C
```

#### 1.2 ä½¿ç”¨SIGTERMä¿¡å·
```bash
# æŸ¥æ‰¾è¿›ç¨‹ID
ps aux | grep server.js | grep -v grep

# å‘é€SIGTERMä¿¡å·ï¼ˆä¼˜é›…å…³é—­ï¼‰
kill -TERM <è¿›ç¨‹ID>

# æˆ–è€…ä½¿ç”¨killå‘½ä»¤ï¼ˆé»˜è®¤å‘é€SIGTERMï¼‰
kill <è¿›ç¨‹ID>
```

#### 1.3 ä½¿ç”¨pkillå‘½ä»¤
```bash
# æ ¹æ®è¿›ç¨‹åå…³é—­
pkill -f "server.js"

# æ ¹æ®ç«¯å£å…³é—­
pkill -f ":3000"
```

### æ–¹æ³•2: å¼ºåˆ¶å…³é—­

#### 2.1 ä½¿ç”¨SIGKILLä¿¡å·
```bash
# å¼ºåˆ¶å…³é—­ï¼ˆä¸æ¨èï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰
kill -9 <è¿›ç¨‹ID>

# æˆ–è€…ä½¿ç”¨killall
killall -9 node
```

#### 2.2 ä½¿ç”¨pkillå¼ºåˆ¶å…³é—­
```bash
# å¼ºåˆ¶å…³é—­æ‰€æœ‰Node.jsè¿›ç¨‹
pkill -9 -f node

# å¼ºåˆ¶å…³é—­ç‰¹å®šæœåŠ¡
pkill -9 -f "server.js"
```

### æ–¹æ³•3: ä½¿ç”¨PM2ç®¡ç†ï¼ˆå¦‚æœä½¿ç”¨PM2ï¼‰

#### 3.1 æŸ¥çœ‹PM2è¿›ç¨‹
```bash
pm2 list
```

#### 3.2 å…³é—­PM2æœåŠ¡
```bash
# å…³é—­ç‰¹å®šæœåŠ¡
pm2 stop <app_name>

# å…³é—­æ‰€æœ‰æœåŠ¡
pm2 stop all

# åˆ é™¤æœåŠ¡
pm2 delete <app_name>

# åˆ é™¤æ‰€æœ‰æœåŠ¡
pm2 delete all
```

### æ–¹æ³•4: ä½¿ç”¨Dockerï¼ˆå¦‚æœä½¿ç”¨Dockerï¼‰

#### 4.1 æŸ¥çœ‹Dockerå®¹å™¨
```bash
docker ps
```

#### 4.2 å…³é—­Dockerå®¹å™¨
```bash
# åœæ­¢å®¹å™¨
docker stop <container_id>

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop <container_id> && docker rm <container_id>
```

## ğŸ”§ è‡ªåŠ¨åŒ–å…³é—­è„šæœ¬

### åˆ›å»ºå…³é—­è„šæœ¬
```bash
#!/bin/bash
# stop-server.sh

echo "æ­£åœ¨æŸ¥æ‰¾Node.jsåç«¯æœåŠ¡..."

# æŸ¥æ‰¾æœåŠ¡è¿›ç¨‹
PID=$(ps aux | grep -E "(server\.js|node.*server)" | grep -v grep | awk '{print $2}')

if [ -z "$PID" ]; then
    echo "æœªæ‰¾åˆ°è¿è¡Œä¸­çš„Node.jsåç«¯æœåŠ¡"
    exit 0
fi

echo "æ‰¾åˆ°æœåŠ¡è¿›ç¨‹: $PID"

# å°è¯•ä¼˜é›…å…³é—­
echo "æ­£åœ¨ä¼˜é›…å…³é—­æœåŠ¡..."
kill -TERM $PID

# ç­‰å¾…5ç§’
sleep 5

# æ£€æŸ¥æ˜¯å¦è¿˜åœ¨è¿è¡Œ
if ps -p $PID > /dev/null; then
    echo "æœåŠ¡ä»åœ¨è¿è¡Œï¼Œå¼ºåˆ¶å…³é—­..."
    kill -9 $PID
fi

echo "æœåŠ¡å·²å…³é—­"
```

### ä½¿ç”¨è„šæœ¬
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x stop-server.sh

# è¿è¡Œè„šæœ¬
./stop-server.sh
```

## ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†

### 1. æœåŠ¡æ— å“åº”
```bash
# å¼ºåˆ¶å…³é—­æ‰€æœ‰Node.jsè¿›ç¨‹
sudo pkill -9 -f node

# æˆ–è€…ä½¿ç”¨killall
sudo killall -9 node
```

### 2. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo netstat -tlnp | grep :3000

# å¼ºåˆ¶å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <è¿›ç¨‹ID>
```

### 3. ç³»ç»Ÿèµ„æºä¸è¶³
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
top
htop

# å…³é—­å ç”¨èµ„æºæœ€å¤šçš„Node.jsè¿›ç¨‹
kill -9 <é«˜CPUä½¿ç”¨ç‡çš„è¿›ç¨‹ID>
```

## ğŸ“Š æœåŠ¡çŠ¶æ€æ£€æŸ¥

### æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²å…³é—­
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep server.js | grep -v grep

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep :3000

# æ£€æŸ¥æœåŠ¡å“åº”
curl -I http://localhost:3000/health
```

### éªŒè¯å…³é—­ç»“æœ
```bash
# å¦‚æœå‘½ä»¤æ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜æœåŠ¡å·²å…³é—­
ps aux | grep server.js | grep -v grep

# ç«¯å£æ£€æŸ¥
netstat -tlnp | grep :3000
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜ç«¯å£å·²é‡Šæ”¾
```

## ğŸ”„ é‡å¯æœåŠ¡

### é‡å¯å‘½ä»¤
```bash
# åœæ­¢æœåŠ¡
./stop-server.sh

# ç­‰å¾…å‡ ç§’
sleep 3

# é‡æ–°å¯åŠ¨æœåŠ¡
npm start
# æˆ–è€…
node server.js
# æˆ–è€…
nodemon server.js
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä¼˜é›…å…³é—­
- ä¼˜å…ˆä½¿ç”¨SIGTERMä¿¡å·
- ç»™æœåŠ¡æ—¶é—´å®Œæˆå½“å‰è¯·æ±‚
- ä¿å­˜é‡è¦æ•°æ®

### 2. æ—¥å¿—è®°å½•
```bash
# è®°å½•å…³é—­æ“ä½œ
echo "$(date): æœåŠ¡å·²å…³é—­" >> server.log
```

### 3. å¥åº·æ£€æŸ¥
```bash
# å…³é—­å‰æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -f http://localhost:3000/health || echo "æœåŠ¡æ— å“åº”"
```

### 4. å¤‡ä»½é‡è¦æ•°æ®
```bash
# å…³é—­å‰å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p smart_property > backup_$(date +%Y%m%d_%H%M%S).sql
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿›ç¨‹æ— æ³•å…³é—­
```bash
# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux | grep <è¿›ç¨‹ID>

# ä½¿ç”¨æ›´å¼ºåŠ›çš„ä¿¡å·
kill -9 <è¿›ç¨‹ID>
```

#### 2. ç«¯å£ä»è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :3000

# å¼ºåˆ¶å…³é—­
sudo kill -9 <è¿›ç¨‹ID>
```

#### 3. æƒé™é—®é¢˜
```bash
# ä½¿ç”¨sudoæƒé™
sudo kill <è¿›ç¨‹ID>
sudo pkill -f "server.js"
```

## ğŸ“‹ å…³é—­æ£€æŸ¥æ¸…å•

- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€
- [ ] å°è¯•ä¼˜é›…å…³é—­
- [ ] éªŒè¯å…³é—­ç»“æœ
- [ ] æ£€æŸ¥ç«¯å£é‡Šæ”¾
- [ ] è®°å½•å…³é—­æ—¥å¿—
- [ ] å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰

## ğŸš€ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
ps aux | grep server.js | grep -v grep

# ä¼˜é›…å…³é—­
kill -TERM <PID>

# å¼ºåˆ¶å…³é—­
kill -9 <PID>

# å…³é—­æ‰€æœ‰Node.jsè¿›ç¨‹
pkill -f node

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep :3000

# é‡å¯æœåŠ¡
npm start
```

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨PM2æˆ–Dockerç­‰è¿›ç¨‹ç®¡ç†å·¥å…·æ¥ç®¡ç†Node.jsæœåŠ¡ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œå¯åŠ¨ã€åœæ­¢ã€é‡å¯ç­‰æ“ä½œã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ  
**ç»´æŠ¤å›¢é˜Ÿ**: æ¹–åŒ—çœåœ°è´¨å±€ç¬¬ä¸‰åœ°è´¨å¤§é˜Ÿ

