# 前端对接文档 - 二维码扫码确认就餐

## 📋 概述

本文档为前端开发者提供完整的二维码扫码确认就餐功能对接指南，包括Web前端和微信小程序前端的实现方案。

## 🎯 功能模块

### 1. Web前端对接
- 二维码图片生成和显示
- 用户扫码确认就餐
- 结果展示和状态管理

### 2. 微信小程序前端对接
- 固定二维码扫码进入小程序
- 微信登录验证
- 自动确认就餐
- 结果展示

## 🌐 Web前端对接

### 1. 二维码生成和显示

#### 1.1 生成普通二维码图片

**接口**: `GET /api/qr-scan/qr-codes/:qrCode/image`

**请求示例**:
```javascript
// 生成二维码图片
async function generateQRCodeImage(qrCode, options = {}) {
  try {
    const token = localStorage.getItem('token');
    const params = new URLSearchParams({
      width: options.width || 200,
      margin: options.margin || 2
    });
    
    const response = await fetch(`/api/qr-scan/qr-codes/${qrCode}/image?${params}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data.imageDataURL;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('生成二维码图片失败:', error);
    throw error;
    }
}

// 使用示例
const qrCodeImage = await generateQRCodeImage('DINING_QR_MAIN_001', {
  width: 300,
  margin: 3
});

// 显示二维码
const img = document.createElement('img');
img.src = qrCodeImage;
img.style.width = '300px';
img.style.height = '300px';
document.body.appendChild(img);
```

#### 1.2 生成包含URL的二维码图片

**接口**: `GET /api/qr-scan/qr-codes/:qrCode/image-with-url`

**请求示例**:
```javascript
// 生成包含URL的二维码图片
async function generateQRCodeWithURL(qrCode, baseURL = 'http://localhost:3000', options = {}) {
  try {
    const token = localStorage.getItem('token');
    const params = new URLSearchParams({
      width: options.width || 200,
      margin: options.margin || 2,
      baseURL: baseURL
    });
    
    const response = await fetch(`/api/qr-scan/qr-codes/${qrCode}/image-with-url?${params}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return {
        imageDataURL: result.data.imageDataURL,
        qrCodeURL: result.data.qrCodeURL
      };
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('生成包含URL的二维码图片失败:', error);
    throw error;
  }
}

// 使用示例
const qrResult = await generateQRCodeWithURL('DINING_QR_MAIN_001', 'https://your-domain.com', {
  width: 300,
  margin: 3
});

// 显示二维码
const img = document.createElement('img');
img.src = qrResult.imageDataURL;
img.style.width = '300px';
img.style.height = '300px';
document.body.appendChild(img);

// 二维码URL（用户扫码后会跳转到这个URL）
console.log('二维码URL:', qrResult.qrCodeURL);
```

#### 1.3 生成安全二维码图片

**接口**: `GET /api/qr-scan/qr-codes/:qrCode/image-secure`

**请求示例**:
```javascript
// 生成安全二维码图片
async function generateSecureQRCode(qrCode, baseURL = 'http://localhost:3000', options = {}) {
  try {
    const token = localStorage.getItem('token');
    const params = new URLSearchParams({
      width: options.width || 200,
      margin: options.margin || 2,
      baseURL: baseURL
    });
    
    const response = await fetch(`/api/qr-scan/qr-codes/${qrCode}/image-secure?${params}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return {
        imageDataURL: result.data.imageDataURL,
        qrCodeURL: result.data.qrCodeURL,
        secureToken: result.data.secureToken,
        expiresAt: result.data.expiresAt
      };
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('生成安全二维码图片失败:', error);
    throw error;
  }
}

// 使用示例
const secureQRResult = await generateSecureQRCode('DINING_QR_MAIN_001', 'https://your-domain.com', {
  width: 300,
  margin: 3
});

// 显示二维码
const img = document.createElement('img');
img.src = secureQRResult.imageDataURL;
img.style.width = '300px';
img.style.height = '300px';
document.body.appendChild(img);

// 安全信息
console.log('安全令牌:', secureQRResult.secureToken);
console.log('过期时间:', secureQRResult.expiresAt);
```

#### 1.4 生成微信小程序码

**接口**: `GET /api/qr-scan/qr-codes/:qrCode/image-wechat`

**请求示例**:
```javascript
// 生成微信小程序码
async function generateWechatMiniProgramCode(qrCode, options = {}) {
  try {
    const token = localStorage.getItem('token');
    const params = new URLSearchParams({
      width: options.width || 200,
      margin: options.margin || 2
    });
    
    const response = await fetch(`/api/qr-scan/qr-codes/${qrCode}/image-wechat?${params}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return {
        imageDataURL: result.data.imageDataURL,
        miniProgramPath: result.data.miniProgramPath,
        scene: result.data.scene
      };
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('生成微信小程序码失败:', error);
    throw error;
  }
}

// 使用示例
const wechatQRResult = await generateWechatMiniProgramCode('DINING_QR_MAIN_001', {
  width: 300,
  margin: 3
});

// 显示二维码
const img = document.createElement('img');
img.src = wechatQRResult.imageDataURL;
img.style.width = '300px';
img.style.height = '300px';
document.body.appendChild(img);

// 小程序信息
console.log('小程序路径:', wechatQRResult.miniProgramPath);
console.log('场景值:', wechatQRResult.scene);
```

### 2. 扫码确认就餐

#### 2.1 普通扫码确认

**接口**: `POST /api/qr-scan/scan`

**请求示例**:
```javascript
// 扫码确认就餐
async function confirmDining(qrCode, scanTime) {
  try {
    const token = localStorage.getItem('token');
    
    const response = await fetch('/api/qr-scan/scan', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        qrCode: qrCode,
        scanTime: scanTime || new Date().toISOString()
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('扫码确认就餐失败:', error);
    throw error;
  }
}

// 使用示例
try {
  const result = await confirmDining('DINING_QR_MAIN_001');
  console.log('确认成功:', result);
  
  // 显示成功信息
  alert(`确认成功！\n餐次: ${result.mealTypeName}\n日期: ${result.diningDate}\n时间: ${result.scanTime}`);
} catch (error) {
  console.error('确认失败:', error.message);
  alert(`确认失败: ${error.message}`);
}
```

#### 2.2 微信小程序扫码确认

**接口**: `POST /api/qr-scan/wechat-scan`

**请求示例**:
```javascript
// 微信小程序扫码确认就餐
async function confirmWechatDining(qrCode, scanTime) {
  try {
    const token = localStorage.getItem('token');
    
    const response = await fetch('/api/qr-scan/wechat-scan', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        qrCode: qrCode,
        scanTime: scanTime || new Date().toISOString()
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('微信小程序扫码确认就餐失败:', error);
    throw error;
  }
}

// 使用示例
try {
  const result = await confirmWechatDining('DINING_QR_MAIN_001');
  console.log('确认成功:', result);
  
  // 显示成功信息
  alert(`确认成功！\n用户: ${result.userName}\n餐次: ${result.mealTypeName}\n日期: ${result.diningDate}\n时间: ${result.scanTime}`);
} catch (error) {
  console.error('确认失败:', error.message);
  alert(`确认失败: ${error.message}`);
}
```

### 3. 完整的Web前端组件示例

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二维码扫码确认就餐</title>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .qr-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .qr-image {
            max-width: 300px;
            height: auto;
            margin: 20px 0;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
        
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .loading {
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>二维码扫码确认就餐</h1>
        
        <!-- 二维码生成区域 -->
        <div class="qr-section">
            <h2>生成二维码</h2>
            <div>
                <button class="btn" onclick="generateQRCode('normal')">生成普通二维码</button>
                <button class="btn" onclick="generateQRCode('with-url')">生成带URL二维码</button>
                <button class="btn" onclick="generateQRCode('secure')">生成安全二维码</button>
                <button class="btn" onclick="generateQRCode('wechat')">生成微信小程序码</button>
            </div>
            
            <div id="qr-container">
                <!-- 二维码图片将显示在这里 -->
            </div>
        </div>
        
        <!-- 扫码确认区域 -->
        <div class="qr-section">
            <h2>扫码确认就餐</h2>
            <div>
                <input type="text" id="qrCodeInput" placeholder="请输入二维码标识" value="DINING_QR_MAIN_001">
                <button class="btn" onclick="confirmDining()">确认就餐</button>
            </div>
            
            <div id="result-container">
                <!-- 结果将显示在这里 -->
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentQRType = 'normal';
        let currentQRData = null;
        
        // 生成二维码
        async function generateQRCode(type) {
            try {
                const qrCode = 'DINING_QR_MAIN_001';
                const container = document.getElementById('qr-container');
                const resultContainer = document.getElementById('result-container');
                
                // 显示加载状态
                container.innerHTML = '<div class="loading">生成中...</div>';
                resultContainer.innerHTML = '';
                
                let result;
                
                switch (type) {
                    case 'normal':
                        result = await generateQRCodeImage(qrCode, { width: 300, margin: 3 });
                        break;
                    case 'with-url':
                        result = await generateQRCodeWithURL(qrCode, window.location.origin, { width: 300, margin: 3 });
                        break;
                    case 'secure':
                        result = await generateSecureQRCode(qrCode, window.location.origin, { width: 300, margin: 3 });
                        break;
                    case 'wechat':
                        result = await generateWechatMiniProgramCode(qrCode, { width: 300, margin: 3 });
                        break;
                }
                
                // 显示二维码图片
                const img = document.createElement('img');
                img.src = result.imageDataURL;
                img.className = 'qr-image';
                img.alt = '二维码';
                
                container.innerHTML = '';
                container.appendChild(img);
                
                // 保存当前二维码数据
                currentQRType = type;
                currentQRData = result;
                
                // 显示二维码信息
                let info = `<p><strong>二维码类型:</strong> ${type}</p>`;
                if (result.qrCodeURL) {
                    info += `<p><strong>二维码URL:</strong> ${result.qrCodeURL}</p>`;
                }
                if (result.secureToken) {
                    info += `<p><strong>安全令牌:</strong> ${result.secureToken}</p>`;
                }
                if (result.expiresAt) {
                    info += `<p><strong>过期时间:</strong> ${result.expiresAt}</p>`;
                }
                if (result.miniProgramPath) {
                    info += `<p><strong>小程序路径:</strong> ${result.miniProgramPath}</p>`;
                }
                
                container.innerHTML += info;
                
            } catch (error) {
                console.error('生成二维码失败:', error);
                document.getElementById('qr-container').innerHTML = `<div class="result error">生成失败: ${error.message}</div>`;
            }
        }
        
        // 确认就餐
        async function confirmDining() {
            try {
                const qrCode = document.getElementById('qrCodeInput').value;
                const resultContainer = document.getElementById('result-container');
                
                if (!qrCode) {
                    resultContainer.innerHTML = '<div class="result error">请输入二维码标识</div>';
                    return;
                }
                
                // 显示加载状态
                resultContainer.innerHTML = '<div class="loading">确认中...</div>';
                
                let result;
                
                if (currentQRType === 'wechat') {
                    result = await confirmWechatDining(qrCode);
                } else {
                    result = await confirmDining(qrCode);
                }
                
                // 显示成功结果
                const successHtml = `
                    <div class="result success">
                        <h3>✅ 确认成功！</h3>
                        <p><strong>用户:</strong> ${result.userName}</p>
                        <p><strong>餐次:</strong> ${result.mealTypeName}</p>
                        <p><strong>日期:</strong> ${result.diningDate}</p>
                        <p><strong>时间:</strong> ${result.scanTime}</p>
                        <p><strong>状态:</strong> ${result.diningStatus}</p>
                    </div>
                `;
                
                resultContainer.innerHTML = successHtml;
                
            } catch (error) {
                console.error('确认就餐失败:', error);
                document.getElementById('result-container').innerHTML = `<div class="result error">确认失败: ${error.message}</div>`;
            }
        }
        
        // 页面加载时生成默认二维码
        window.onload = function() {
            generateQRCode('normal');
        };
    </script>
</body>
</html>
```

## 📱 微信小程序前端对接

### 1. 小程序页面配置

#### 1.1 页面配置文件

**文件**: `pages/dining-confirm/dining-confirm.json`
```json
{
  "navigationBarTitleText": "用餐确认",
  "navigationBarBackgroundColor": "#07c160",
  "navigationBarTextStyle": "white",
  "backgroundColor": "#f5f5f5"
}
```

#### 1.2 小程序主配置文件

**文件**: `app.json`
```json
{
  "pages": [
    "pages/index/index",
    "pages/dining-confirm/dining-confirm"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#07c160",
    "navigationBarTitleText": "智能用餐系统",
    "navigationBarTextStyle": "white",
    "backgroundColor": "#f5f5f5"
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true
}
```

### 2. 小程序页面逻辑

#### 2.1 页面JavaScript文件

**文件**: `pages/dining-confirm/dining-confirm.js`

```javascript
// 微信小程序 - 用餐确认页面
Page({
  data: {
    qrCode: '',
    userInfo: null,
    isLoggedIn: false,
    scanResult: null,
    loading: false,
    baseURL: 'https://your-domain.com' // 替换为实际的后端域名
  },

  onLoad(options) {
    // 获取二维码参数
    const { qrCode } = options;
    this.setData({ qrCode });
    
    // 检查登录状态
    this.checkLoginStatus();
  },

  onShow() {
    // 页面显示时检查登录状态
    this.checkLoginStatus();
  },

  /**
   * 检查登录状态
   */
  checkLoginStatus() {
    const token = wx.getStorageSync('token');
    const userInfo = wx.getStorageSync('userInfo');
    
    if (token && userInfo) {
      this.setData({
        isLoggedIn: true,
        userInfo: userInfo
      });
      
      // 如果已登录，自动确认就餐
      this.confirmDining();
    } else {
      this.setData({
        isLoggedIn: false,
        userInfo: null
      });
    }
  },

  /**
   * 微信登录
   */
  async wechatLogin() {
    try {
      this.setData({ loading: true });
      
      // 获取微信授权码
      const { code } = await wx.login();
      
      // 获取用户信息
      const { encryptedData, iv } = await wx.getUserProfile({
        desc: '用于确认用餐身份'
      });
      
      // 调用后端登录接口
      const response = await wx.request({
        url: `${this.data.baseURL}/api/auth/wechat-login`,
        method: 'POST',
        data: { 
          code, 
          encryptedData, 
          iv 
        }
      });
      
      const result = response.data;
      
      if (result.success) {
        // 保存用户信息
        wx.setStorageSync('token', result.data.token);
        wx.setStorageSync('userInfo', result.data.userInfo);
        
        this.setData({
          isLoggedIn: true,
          userInfo: result.data.userInfo
        });
        
        // 登录成功后自动确认就餐
        this.confirmDining();
      } else {
        wx.showToast({
          title: result.message || '登录失败',
          icon: 'error'
        });
      }
    } catch (error) {
      console.error('微信登录失败:', error);
      wx.showToast({
        title: '登录失败，请重试',
        icon: 'error'
      });
    } finally {
      this.setData({ loading: false });
    }
  },

  /**
   * 确认就餐
   */
  async confirmDining() {
    try {
      this.setData({ loading: true });
      
      const token = wx.getStorageSync('token');
      const scanTime = new Date().toISOString();
      
      // 调用后端确认就餐接口
      const response = await wx.request({
        url: `${this.data.baseURL}/api/qr-scan/wechat-scan`,
        method: 'POST',
        header: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        data: {
          qrCode: this.data.qrCode,
          scanTime: scanTime
        }
      });
      
      const result = response.data;
      
      if (result.success) {
        this.setData({
          scanResult: {
            success: true,
            message: result.message,
            data: result.data
          }
        });
        
        wx.showToast({
          title: '确认成功！',
          icon: 'success'
        });
      } else {
        this.setData({
          scanResult: {
            success: false,
            message: result.message
          }
        });
        
        wx.showToast({
          title: result.message || '确认失败',
          icon: 'error'
        });
      }
    } catch (error) {
      console.error('确认就餐失败:', error);
      wx.showToast({
        title: '确认失败，请重试',
        icon: 'error'
      });
    } finally {
      this.setData({ loading: false });
    }
  },

  /**
   * 重新确认
   */
  retryConfirm() {
    this.setData({ scanResult: null });
    this.confirmDining();
  },

  /**
   * 返回首页
   */
  goHome() {
    wx.switchTab({
      url: '/pages/index/index'
    });
  }
});
```

#### 2.2 页面模板文件

**文件**: `pages/dining-confirm/dining-confirm.wxml`

```xml
<!-- 微信小程序 - 用餐确认页面模板 -->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">用餐确认</text>
  </view>

  <!-- 登录状态 -->
  <view class="login-section" wx:if="{{!isLoggedIn}}">
    <view class="login-prompt">
      <text class="prompt-text">请先登录以确认用餐</text>
    </view>
    <button 
      class="login-btn" 
      bindtap="wechatLogin"
      loading="{{loading}}"
      disabled="{{loading}}"
    >
      {{loading ? '登录中...' : '微信登录'}}
    </button>
  </view>

  <!-- 已登录状态 -->
  <view class="logged-in-section" wx:if="{{isLoggedIn}}">
    <!-- 用户信息 -->
    <view class="user-info">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" />
      <text class="user-name">{{userInfo.nickName}}</text>
    </view>

    <!-- 二维码信息 -->
    <view class="qr-info">
      <text class="qr-label">二维码标识：</text>
      <text class="qr-code">{{qrCode}}</text>
    </view>

    <!-- 确认按钮 -->
    <button 
      class="confirm-btn" 
      bindtap="confirmDining"
      loading="{{loading}}"
      disabled="{{loading}}"
    >
      {{loading ? '确认中...' : '确认用餐'}}
    </button>
  </view>

  <!-- 确认结果 -->
  <view class="result-section" wx:if="{{scanResult}}">
    <view class="result-card {{scanResult.success ? 'success' : 'error'}}">
      <view class="result-icon">
        <text class="icon">{{scanResult.success ? '✅' : '❌'}}</text>
      </view>
      <view class="result-content">
        <text class="result-title">{{scanResult.success ? '确认成功' : '确认失败'}}</text>
        <text class="result-message">{{scanResult.message}}</text>
        
        <!-- 成功时显示详细信息 -->
        <view class="result-details" wx:if="{{scanResult.success && scanResult.data}}">
          <view class="detail-item">
            <text class="detail-label">餐次：</text>
            <text class="detail-value">{{scanResult.data.mealTypeName}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">日期：</text>
            <text class="detail-value">{{scanResult.data.diningDate}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">时间：</text>
            <text class="detail-value">{{scanResult.data.scanTime}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button class="retry-btn" bindtap="retryConfirm" wx:if="{{!scanResult.success}}">
        重新确认
      </button>
      <button class="home-btn" bindtap="goHome">
        返回首页
      </button>
    </view>
  </view>
</view>
```

#### 2.3 页面样式文件

**文件**: `pages/dining-confirm/dining-confirm.wxss`

```css
/* 微信小程序 - 用餐确认页面样式 */
.container {
  padding: 40rpx;
  min-height: 100vh;
  background-color: #f5f5f5;
}

/* 页面标题 */
.header {
  text-align: center;
  margin-bottom: 60rpx;
}

.title {
  font-size: 48rpx;
  font-weight: bold;
  color: #333;
}

/* 登录部分 */
.login-section {
  text-align: center;
  padding: 80rpx 40rpx;
}

.login-prompt {
  margin-bottom: 60rpx;
}

.prompt-text {
  font-size: 32rpx;
  color: #666;
}

.login-btn {
  width: 400rpx;
  height: 88rpx;
  background-color: #07c160;
  color: white;
  border-radius: 44rpx;
  font-size: 32rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-btn:disabled {
  background-color: #ccc;
}

/* 已登录部分 */
.logged-in-section {
  background-color: white;
  border-radius: 20rpx;
  padding: 40rpx;
  margin-bottom: 40rpx;
}

.user-info {
  display: flex;
  align-items: center;
  margin-bottom: 40rpx;
  padding-bottom: 40rpx;
  border-bottom: 1rpx solid #eee;
}

.avatar {
  width: 80rpx;
  height: 80rpx;
  border-radius: 40rpx;
  margin-right: 20rpx;
}

.user-name {
  font-size: 32rpx;
  color: #333;
  font-weight: bold;
}

.qr-info {
  margin-bottom: 40rpx;
}

.qr-label {
  font-size: 28rpx;
  color: #666;
}

.qr-code {
  font-size: 28rpx;
  color: #333;
  font-weight: bold;
  margin-left: 10rpx;
}

.confirm-btn {
  width: 100%;
  height: 88rpx;
  background-color: #07c160;
  color: white;
  border-radius: 44rpx;
  font-size: 32rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

.confirm-btn:disabled {
  background-color: #ccc;
}

/* 结果部分 */
.result-section {
  background-color: white;
  border-radius: 20rpx;
  padding: 40rpx;
}

.result-card {
  text-align: center;
  padding: 40rpx;
  border-radius: 20rpx;
}

.result-card.success {
  background-color: #f0f9ff;
  border: 2rpx solid #07c160;
}

.result-card.error {
  background-color: #fff5f5;
  border: 2rpx solid #ff4757;
}

.result-icon {
  margin-bottom: 20rpx;
}

.icon {
  font-size: 80rpx;
}

.result-content {
  margin-bottom: 40rpx;
}

.result-title {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
  display: block;
  margin-bottom: 20rpx;
}

.result-message {
  font-size: 28rpx;
  color: #666;
  display: block;
}

.result-details {
  margin-top: 40rpx;
  text-align: left;
}

.detail-item {
  display: flex;
  margin-bottom: 20rpx;
}

.detail-label {
  font-size: 28rpx;
  color: #666;
  width: 120rpx;
}

.detail-value {
  font-size: 28rpx;
  color: #333;
  font-weight: bold;
}

/* 操作按钮 */
.action-buttons {
  display: flex;
  gap: 20rpx;
}

.retry-btn {
  flex: 1;
  height: 88rpx;
  background-color: #ff4757;
  color: white;
  border-radius: 44rpx;
  font-size: 28rpx;
}

.home-btn {
  flex: 1;
  height: 88rpx;
  background-color: #007bff;
  color: white;
  border-radius: 44rpx;
  font-size: 28rpx;
}
```

### 3. 小程序主入口文件

**文件**: `app.js`

```javascript
// 微信小程序主入口
App({
  onLaunch() {
    console.log('小程序启动');
    
    // 检查更新
    this.checkForUpdate();
  },

  onShow() {
    console.log('小程序显示');
  },

  onHide() {
    console.log('小程序隐藏');
  },

  onError(error) {
    console.error('小程序错误:', error);
  },

  /**
   * 检查小程序更新
   */
  checkForUpdate() {
    if (wx.canIUse('getUpdateManager')) {
      const updateManager = wx.getUpdateManager();
      
      updateManager.onCheckForUpdate((res) => {
        if (res.hasUpdate) {
          console.log('发现新版本');
        }
      });
      
      updateManager.onUpdateReady(() => {
        wx.showModal({
          title: '更新提示',
          content: '新版本已经准备好，是否重启应用？',
          success: (res) => {
            if (res.confirm) {
              updateManager.applyUpdate();
            }
          }
        });
      });
      
      updateManager.onUpdateFailed(() => {
        console.error('新版本下载失败');
      });
    }
  },

  /**
   * 全局数据
   */
  globalData: {
    userInfo: null,
    token: null,
    baseURL: 'https://your-domain.com' // 替换为实际的后端域名
  }
});
```

## 🔧 配置说明

### 1. 环境配置

#### 1.1 开发环境
```javascript
// 开发环境配置
const config = {
  baseURL: 'http://localhost:3000',
  debug: true,
  timeout: 10000
};
```

#### 1.2 生产环境
```javascript
// 生产环境配置
const config = {
  baseURL: 'https://your-domain.com',
  debug: false,
  timeout: 10000
};
```

### 2. 微信小程序配置

#### 2.1 服务器域名配置

需要在微信公众平台配置以下域名：

**request合法域名**:
- `https://your-domain.com` (后端API域名)

**downloadFile合法域名**:
- `https://your-domain.com` (后端API域名)

#### 2.2 页面路径配置

确保在 `app.json` 中正确配置页面路径：

```json
{
  "pages": [
    "pages/index/index",
    "pages/dining-confirm/dining-confirm"
  ]
}
```

## ⚠️ 注意事项

### 1. 安全注意事项

- 所有API调用都需要JWT token验证
- 敏感信息不要在前端硬编码
- 使用HTTPS协议保护数据传输
- 定期更新token，避免过期

### 2. 错误处理

- 网络请求失败时显示友好提示
- 登录失败时引导用户重新登录
- 确认失败时显示具体错误原因
- 提供重试机制

### 3. 用户体验

- 加载状态要有明确的提示
- 操作结果要有清晰的反馈
- 错误信息要用户友好
- 界面要响应式设计

### 4. 性能优化

- 合理使用缓存机制
- 避免重复请求
- 优化图片加载
- 减少不必要的渲染

## 📞 技术支持

如有问题，请联系技术支持团队：
- 邮箱: support@example.com
- 电话: 400-123-4567
- 微信: tech_support
