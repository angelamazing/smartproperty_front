# æ—¶é—´å¤„ç†æ’ä»¶ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨é¡µé¢åˆå§‹åŒ–æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
TypeError: dayjs(...).utcOffset(...).format is not a function
    at TimeUtils.getCurrentDate (timeUtils.js:103:33)
    at Proxy.$getCurrentDate (timeMixin.js:185:24)
    at Proxy.initPage (dining.vue:723:34)
```

## ğŸ” é—®é¢˜åŸå› 

1. **ç¼ºå°‘å¿…è¦çš„dayjsæ’ä»¶**ï¼š`utcOffset` æ–¹æ³•æ˜¯ `timezone` æ’ä»¶çš„åŠŸèƒ½ï¼Œä½†æ²¡æœ‰æ­£ç¡®å¯¼å…¥
2. **æ’ä»¶å¯¼å…¥ä¸å®Œæ•´**ï¼šåªå¯¼å…¥äº† `relativeTime` æ’ä»¶ï¼Œç¼ºå°‘ `utc` å’Œ `timezone` æ’ä»¶

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ å¿…è¦çš„dayjsæ’ä»¶å¯¼å…¥

```javascript
// ä¿®å¤å‰
import dayjs from 'dayjs';
import relativeTime from 'dayjs/plugin/relativeTime';
import 'dayjs/locale/zh-cn';

// é…ç½®æ’ä»¶
dayjs.extend(relativeTime);
dayjs.locale('zh-cn');

// ä¿®å¤å
import dayjs from 'dayjs';
import relativeTime from 'dayjs/plugin/relativeTime';
import utc from 'dayjs/plugin/utc';
import timezone from 'dayjs/plugin/timezone';
import 'dayjs/locale/zh-cn';

// é…ç½®æ’ä»¶
dayjs.extend(relativeTime);
dayjs.extend(utc);
dayjs.extend(timezone);
dayjs.locale('zh-cn');
```

### 2. æ›´æ–°æ—¶åŒºå¤„ç†æ–¹æ³•

å°†æ‰€æœ‰ `utcOffset(8)` æ–¹æ³•æ›¿æ¢ä¸º `tz('Asia/Shanghai')`ï¼š

```javascript
// ä¿®å¤å‰
dayjs().utcOffset(8).format('YYYY-MM-DD')

// ä¿®å¤å
dayjs().tz('Asia/Shanghai').format('YYYY-MM-DD')
```

### 3. å…·ä½“ä¿®å¤çš„æ–¹æ³•

ä»¥ä¸‹æ–¹æ³•å·²å…¨éƒ¨ä¿®å¤ï¼š

- `TimeUtils.formatTime()` - æ—¶é—´æ ¼å¼åŒ–
- `TimeUtils.getCurrentDate()` - è·å–å½“å‰æ—¥æœŸ
- `TimeUtils.getCurrentTime()` - è·å–å½“å‰æ—¶é—´
- `TimeUtils.isToday()` - æ£€æŸ¥æ˜¯å¦ä¸ºä»Šå¤©
- `TimeUtils.isPastDate()` - æ£€æŸ¥æ˜¯å¦ä¸ºè¿‡å»
- `TimeUtils.isFutureDate()` - æ£€æŸ¥æ˜¯å¦ä¸ºæœªæ¥
- `TimeUtils.getBeijingTime()` - è·å–åŒ—äº¬æ—¶é—´
- `TimeUtils.isYesterday()` - æ£€æŸ¥æ˜¯å¦ä¸ºæ˜¨å¤©
- `TimeUtils.isTomorrow()` - æ£€æŸ¥æ˜¯å¦ä¸ºæ˜å¤©
- `TimeUtils.checkMealTime()` - æ£€æŸ¥å°±é¤æ—¶é—´
- `TimeUtils.getCurrentMealType()` - è·å–å½“å‰é¤æ¬¡
- `TimeUtils.getNextMeal()` - è·å–ä¸‹ä¸€ä¸ªé¤æ¬¡
- `TimeUtils.isTimeInMealRange()` - æ£€æŸ¥æ—¶é—´æ˜¯å¦åœ¨é¤æ¬¡èŒƒå›´å†…

## ğŸ§ª éªŒè¯ä¿®å¤

### 1. è¯­æ³•æ£€æŸ¥
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
npm run lint
```

### 2. åŠŸèƒ½æµ‹è¯•
å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯•ä¿®å¤æ•ˆæœï¼š

1. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   npm run dev:h5
   ```

2. **è®¿é—®æµ‹è¯•é¡µé¢**
   - è®¿é—® `/pages/test-time-optimization` é¡µé¢
   - æŸ¥çœ‹æ‰€æœ‰æ—¶é—´åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

3. **æµ‹è¯•å…³é”®åŠŸèƒ½**
   - é¦–é¡µæ—¥æœŸæ˜¾ç¤º
   - ç”¨é¤é¡µé¢æ—¥æœŸé€‰æ‹©
   - æ—¶é—´æ ¼å¼åŒ–æ˜¾ç¤º

## ğŸ“‹ ä¿®å¤æ¸…å•

- [x] å¯¼å…¥ `utc` æ’ä»¶
- [x] å¯¼å…¥ `timezone` æ’ä»¶
- [x] é…ç½®æ‰€æœ‰å¿…è¦çš„æ’ä»¶
- [x] æ›¿æ¢æ‰€æœ‰ `utcOffset(8)` ä¸º `tz('Asia/Shanghai')`
- [x] éªŒè¯è¯­æ³•æ­£ç¡®æ€§
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œä»¥ä¸‹åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼š

1. **åŸºç¡€æ—¶é—´åŠŸèƒ½**
   - è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
   - æ—¶é—´æ ¼å¼åŒ–æ˜¾ç¤º
   - ç›¸å¯¹æ—¶é—´è®¡ç®—

2. **ä¸šåŠ¡åŠŸèƒ½**
   - é¤æ¬¡æ—¶é—´åˆ¤æ–­
   - å°±é¤æ—¶é—´æ£€æŸ¥
   - æ—¥æœŸè®¡ç®—ï¼ˆæ˜¨å¤©ã€æ˜å¤©ç­‰ï¼‰

3. **æ—¶åŒºè½¬æ¢**
   - UTCæ—¶é—´è½¬åŒ—äº¬æ—¶é—´æ˜¾ç¤º
   - åŒ—äº¬æ—¶é—´è½¬UTCæ—¶é—´æäº¤

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ’ä»¶ä¾èµ–**ï¼šç¡®ä¿ `dayjs` åŒ…å·²æ­£ç¡®å®‰è£…
2. **æ—¶åŒºè®¾ç½®**ï¼šç»Ÿä¸€ä½¿ç”¨ `Asia/Shanghai` æ—¶åŒº
3. **å‘åå…¼å®¹**ï¼šä¿æŒæ‰€æœ‰å…¬å…±APIçš„å…¼å®¹æ€§

## ğŸ”„ åç»­ä¼˜åŒ–

1. **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§æ—¶é—´å¤„ç†çš„æ€§èƒ½è¡¨ç°
2. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ æ›´å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
3. **å•å…ƒæµ‹è¯•**ï¼šä¸ºæ—¶é—´å¤„ç†å·¥å…·ç±»æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

---

**ä¿®å¤æ—¶é—´**: 2024å¹´1æœˆ15æ—¥  
**ä¿®å¤äººå‘˜**: AIåŠ©æ‰‹  
**çŠ¶æ€**: âœ… å·²ä¿®å¤
