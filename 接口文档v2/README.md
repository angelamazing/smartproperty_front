# 接口文档v2 - 智慧物业管理系统

## 📋 文档概述

本目录包含了智慧物业管理系统后端接口的完整文档集合，主要围绕**就餐管理功能**展开，涵盖了从报餐到确认用餐的完整业务流程。

**文档总数**: 21个  
**最后更新**: 2025年1月  
**维护团队**: 湖北省地质局第三地质大队

## 🎯 核心功能

### 1. 扫码就餐登记功能
- **极简体验**: 用户只需扫描二维码即可完成就餐登记
- **自动判断**: 系统根据扫码时间自动识别餐次
- **业务验证**: 完整的业务规则验证和错误处理
- **数据统计**: 为后勤部门提供详细的就餐数据统计

### 2. 确认就餐功能
- **多种确认方式**: 支持手动确认、扫码确认、管理员代确认
- **智能业务验证**: 时间限制、状态检查、权限控制
- **完善的管理功能**: 批量确认、数据统计、历史查询
- **数据完整性**: 事务处理、日志记录、状态同步

### 3. 报餐管理功能
- **部门报餐**: 部门管理员为部门成员报餐
- **状态管理**: ordered → dined 的状态流转
- **权限控制**: 基于角色的访问控制
- ⚠️ **重要**: 只有部门管理员和系统管理员可以为部门成员报餐，普通用户无法自行报餐

## 📁 文档分类导航

### 🔧 01-核心功能
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [二维码文档.md](./01-核心功能/二维码文档.md) | 扫码就餐登记功能完整接口文档 | 开发人员、测试人员 |
| [确认就餐接口统一文档.md](./01-核心功能/确认就餐接口统一文档.md) | 整合的确认就餐接口文档 | 开发人员、产品经理 |
| [前端API接口清单.md](./01-核心功能/前端API接口清单.md) | 前端开发快速参考清单 | 前端开发人员 |

### 🔄 02-业务流程
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [报餐到确认用餐完整流程文档.md](./02-业务流程/报餐到确认用餐完整流程文档.md) | 完整业务流程说明 | 开发人员、业务人员 |
| [报餐到确认用餐流程测试报告.md](./02-业务流程/报餐到确认用餐流程测试报告.md) | 流程测试验证报告 | 测试人员、开发人员 |
| [报餐确认流程可视化文档.md](./02-业务流程/报餐确认流程可视化文档.md) | 流程可视化说明 | 产品经理、业务人员 |
| [扫码就餐登记功能实施总结.md](./02-业务流程/扫码就餐登记功能实施总结.md) | 扫码功能实施总结 | 项目经理、开发人员 |
| [就餐接口优化总结.md](./02-业务流程/就餐接口优化总结.md) | 接口优化工作总结 | 开发人员、架构师 |

### 🛠️ 03-技术实现
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [前端对接-确认就餐接口文档.md](./03-技术实现/前端对接-确认就餐接口文档.md) | 前端开发人员专用接口说明 | 前端开发人员 |
| [确认就餐接口文档.md](./03-技术实现/确认就餐接口文档.md) | 确认就餐功能详细接口文档 | 开发人员、产品经理 |
| [后端对接指南-报餐确认流程.md](./03-技术实现/后端对接指南-报餐确认流程.md) | 后端开发对接指南 | 后端开发人员 |
| [数据库确认就餐字段分析报告.md](./03-技术实现/数据库确认就餐字段分析报告.md) | 数据库字段分析 | 数据库管理员、开发人员 |
| [报餐权限说明.md](./03-技术实现/报餐权限说明.md) | 报餐权限控制详细说明 | 开发人员、管理员 |

### 🚀 04-部署运维
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [部署运维指南.md](./04-部署运维/部署运维指南.md) | 完整的部署和运维方案 | 运维人员、开发人员 |
| [安全配置指南.md](./04-部署运维/安全配置指南.md) | 系统安全配置指南 | 安全人员、运维人员 |
| [Node.js后端服务关闭指南.md](./04-部署运维/Node.js后端服务关闭指南.md) | 服务管理指南 | 运维人员、开发人员 |

### 🧪 05-测试验证
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [接口测试总结报告.md](./05-测试验证/接口测试总结报告.md) | 接口测试总结报告 | 测试人员、开发人员 |
| [业务逻辑验证总结.md](./05-测试验证/业务逻辑验证总结.md) | 业务逻辑验证总结 | 开发人员、测试人员 |
| [确认就餐接口-Postman集合.json](./05-测试验证/确认就餐接口-Postman集合.json) | Postman测试集合 | 测试人员、开发人员 |

### 👥 06-用户指南
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [用户使用手册.md](./06-用户指南/用户使用手册.md) | 最终用户使用指南 | 最终用户、管理员 |

### 🔍 07-代码质量
| 文档名称 | 描述 | 适用人群 |
|---------|------|---------|
| [具体代码问题清单.md](./07-代码质量/具体代码问题清单.md) | 代码问题详细清单 | 开发人员、代码审查员 |
| [代码检查总结.md](./07-代码质量/代码检查总结.md) | 代码检查总结 | 开发人员、技术负责人 |
| [代码检查报告.md](./07-代码质量/代码检查报告.md) | 代码检查报告 | 开发人员、技术负责人 |
| [代码梳理和优化建议文档.md](./07-代码质量/代码梳理和优化建议文档.md) | 代码优化建议 | 开发人员、架构师 |
| [代码优化实施计划.md](./07-代码质量/代码优化实施计划.md) | 代码优化计划 | 项目经理、技术负责人 |
| [代码优化进展总结.md](./07-代码质量/代码优化进展总结.md) | 代码优化进展 | 项目经理、技术负责人 |

## 🚀 快速开始

### 开发人员
1. **后端开发**: 从 [后端对接指南-报餐确认流程.md](./03-技术实现/后端对接指南-报餐确认流程.md) 开始
2. **前端开发**: 从 [前端对接-确认就餐接口文档.md](./03-技术实现/前端对接-确认就餐接口文档.md) 开始
3. **接口测试**: 使用 [确认就餐接口-Postman集合.json](./05-测试验证/确认就餐接口-Postman集合.json)

### 产品经理
1. **业务流程**: 查看 [报餐到确认用餐完整流程文档.md](./02-业务流程/报餐到确认用餐完整流程文档.md)
2. **功能特性**: 查看 [二维码文档.md](./01-核心功能/二维码文档.md) 和 [确认就餐接口统一文档.md](./01-核心功能/确认就餐接口统一文档.md)
3. **测试验证**: 查看 [接口测试总结报告.md](./05-测试验证/接口测试总结报告.md)

### 测试人员
1. **测试用例**: 查看 [接口测试总结报告.md](./05-测试验证/接口测试总结报告.md)
2. **测试工具**: 使用 [确认就餐接口-Postman集合.json](./05-测试验证/确认就餐接口-Postman集合.json)
3. **业务验证**: 查看 [业务逻辑验证总结.md](./05-测试验证/业务逻辑验证总结.md)

### 运维人员
1. **部署指南**: 查看 [部署运维指南.md](./04-部署运维/部署运维指南.md)
2. **安全配置**: 查看 [安全配置指南.md](./04-部署运维/安全配置指南.md)
3. **服务管理**: 查看 [Node.js后端服务关闭指南.md](./04-部署运维/Node.js后端服务关闭指南.md)

### 最终用户
1. **使用手册**: 查看 [用户使用手册.md](./06-用户指南/用户使用手册.md)

## 📊 核心接口概览

### 扫码就餐登记接口
- `POST /api/qr-scan/scan` - 扫码就餐登记
- `GET /api/qr-scan/history` - 获取登记历史
- `GET /api/qr-scan/statistics` - 获取就餐统计
- `POST /api/qr-scan/qr-codes` - 创建二维码
- `GET /api/qr-scan/qr-codes` - 获取二维码列表

### 确认就餐接口
- `POST /api/dining-confirmation/manual/:orderId` - 用户手动确认就餐
- `POST /api/dining-confirmation/admin/:orderId` - 管理员代确认就餐
- `POST /api/dining-confirmation/batch` - 批量确认就餐
- `GET /api/dining-confirmation/status` - 获取就餐确认状态
- `GET /api/dining-confirmation/history` - 获取确认历史
- `GET /api/dining-confirmation/pending` - 获取待确认列表
- `GET /api/dining-confirmation/stats` - 获取统计信息

## 🔧 技术栈

- **后端**: Node.js + Express
- **数据库**: MySQL 8.0+
- **认证**: JWT Token
- **测试**: Postman + Node.js
- **部署**: PM2 / Docker

## 📋 业务流程

```
部门管理员为部门成员报餐 (diningStatus: 'ordered')
   ↓
管理员确认报餐 (可选步骤)
   ↓  
用户确认就餐 (多种方式)
   - 方式A: 扫码确认 (diningStatus: 'dined')
   - 方式B: 手动确认 (diningStatus: 'dined')
   - 方式C: 管理员代确认 (diningStatus: 'dined')
   ↓
完成就餐流程
```

⚠️ **重要说明**: 只有部门管理员（dept_admin）和系统管理员（sys_admin）可以为部门成员报餐，普通用户无法自行报餐。

## 🎯 核心特性

### 扫码就餐登记
- ✅ **自动餐次判断**: 根据扫码时间自动识别餐次
- ✅ **业务规则验证**: 检查用户是否已报餐、是否重复登记等
- ✅ **二维码管理**: 支持二维码的创建、管理和状态控制
- ✅ **数据统计**: 提供各餐别就餐数据统计功能

### 确认就餐功能
- ✅ **多种确认方式**: 手动确认、扫码确认、管理员代确认
- ✅ **智能业务验证**: 时间限制、状态检查、权限控制
- ✅ **完善的管理功能**: 批量确认、数据统计、历史查询
- ✅ **数据完整性**: 事务处理、日志记录、状态同步

## 📈 业务价值

### 1. 提升管理效率
- **自动化统计**: 自动统计各餐别就餐数据
- **状态跟踪**: 实时了解用户就餐状态
- **减少人工**: 减少人工验证和统计工作
- **批量操作**: 支持批量确认，提高操作效率

### 2. 增强用户体验
- **多种方式**: 提供多种确认就餐的方式
- **即时反馈**: 实时显示确认结果和状态
- **历史查询**: 用户可以查看自己的就餐确认历史
- **状态清晰**: 清晰显示每个餐次的确认状态

### 3. 数据价值
- **就餐分析**: 提供详细的就餐数据分析
- **趋势预测**: 支持就餐趋势分析和预测
- **决策支持**: 为餐厅管理提供数据支持
- **报表生成**: 支持生成详细的就餐确认报表

## 🔮 扩展功能

### 1. 功能增强
- **智能提醒**: 在就餐时间前提醒用户确认就餐
- **消息通知**: 集成消息通知功能
- **报表生成**: 生成详细的就餐确认报表
- **数据分析**: 更深入的数据分析和预测功能

### 2. 技术优化
- **缓存机制**: 添加Redis缓存提升性能
- **消息队列**: 使用消息队列处理高并发确认
- **API优化**: 进一步优化API响应速度
- **监控告警**: 添加系统监控和告警功能

## 📝 使用说明

### 环境要求
- Node.js 16+
- MySQL 8.0+
- Redis（可选，用于缓存）

### 快速部署
```bash
# 安装依赖
npm install

# 启动服务
npm start

# 或使用开发模式
npm run dev
```

### 测试验证
```bash
# 运行测试脚本
node scripts/test_dining_flow_detailed.js

# 快速功能测试
node scripts/quick_test.js
```

## 🚨 注意事项

1. **权限控制**: 所有接口都需要相应的权限验证
2. **数据验证**: 严格的参数验证和业务规则检查
3. **日志记录**: 完整的操作日志和错误记录
4. **防重复**: 防止重复登记和恶意扫码

## 📞 联系方式

- **维护团队**: 湖北省地质局第三地质大队
- **文档版本**: v2.0.0
- **最后更新**: 2025年1月

---

**提示**: 建议按照文档分类导航快速找到您需要的文档，每个文档都有详细的说明和适用人群标识。
