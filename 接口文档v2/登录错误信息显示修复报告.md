# ç™»å½•é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆç™»å½•é¡µé¢è¾“å…¥å¯†ç é”™è¯¯æ—¶æ˜¾ç¤ºä¿¡æ¯ä¸å…¨ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼š
- è¾“å…¥é”™è¯¯å¯†ç æ—¶æ˜¾ç¤ºã€ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ã€‘
- è¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¸å‡†ç¡®ï¼Œè¯¯å¯¼ç”¨æˆ·ä»¥ä¸ºæ˜¯tokenè¿‡æœŸé—®é¢˜
- ç”¨æˆ·æ— æ³•çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´ç™»å½•å¤±è´¥

## ğŸ› ï¸ é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
åœ¨ `src/utils/api.js` æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰è¿”å›401çŠ¶æ€ç çš„è¯·æ±‚éƒ½è¢«ç»Ÿä¸€å¤„ç†ä¸º"ç™»å½•å·²è¿‡æœŸ"ï¼š

```javascript
} else if (res.statusCode === 401) {
  // Tokenè¿‡æœŸæˆ–æ— æ•ˆï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
  handleAuthError()
  reject(new Error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'))
}
```

### æŠ€æœ¯åŸç†
1. **ç»Ÿä¸€å¤„ç†é—®é¢˜**ï¼šç™»å½•è¯·æ±‚å’Œå…¶ä»–APIè¯·æ±‚çš„401é”™è¯¯è¢«ç»Ÿä¸€å¤„ç†
2. **é”™è¯¯ä¿¡æ¯ä¸å‡†ç¡®**ï¼šå¯†ç é”™è¯¯å’Œtokenè¿‡æœŸæ˜¯ä¸¤ç§ä¸åŒçš„æƒ…å†µ
3. **ç”¨æˆ·ä½“éªŒå·®**ï¼šç”¨æˆ·æ— æ³•çŸ¥é“å…·ä½“å¤±è´¥åŸå› 

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. APIå±‚é¢ä¿®å¤

**æ–‡ä»¶ï¼š** `src/utils/api.js`

**ä¿®å¤å†…å®¹ï¼š** åŒºåˆ†ç™»å½•è¯·æ±‚å’Œå…¶ä»–è¯·æ±‚çš„401é”™è¯¯å¤„ç†

```javascript
} else if (res.statusCode === 401) {
  // æ£€æŸ¥æ˜¯å¦æ˜¯ç™»å½•è¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›å…·ä½“é”™è¯¯ä¿¡æ¯
  if (options.url.includes('/api/auth/')) {
    // ç™»å½•ç›¸å…³è¯·æ±‚ï¼Œè¿”å›åç«¯çš„å…·ä½“é”™è¯¯ä¿¡æ¯
    const errorData = res.data || {}
    const error = new Error(errorData.message || 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
    error.response = { data: errorData, status: res.statusCode }
    reject(error)
  } else {
    // å…¶ä»–è¯·æ±‚çš„401é”™è¯¯ï¼Œè®¤ä¸ºæ˜¯Tokenè¿‡æœŸ
    handleAuthError()
    reject(new Error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'))
  }
}
```

### 2. ç™»å½•é¡µé¢ä¿®å¤

**æ–‡ä»¶ï¼š** `src/pages/login/login.vue`

**ä¿®å¤å†…å®¹ï¼š** æ ¹æ®é”™è¯¯ä¿¡æ¯ç±»å‹æ˜¾ç¤ºå¯¹åº”çš„ç”¨æˆ·å‹å¥½æç¤º

```javascript
// æ‰‹æœºå·å¯†ç ç™»å½•é”™è¯¯å¤„ç†
} catch (error) {
  console.error('æ‰‹æœºå·ç™»å½•å¤±è´¥:', error)
  
  // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
  let errorMessage = 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•'
  
  if (error.message) {
    if (error.message.includes('å¯†ç ') || error.message.includes('password')) {
      errorMessage = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥'
    } else if (error.message.includes('æ‰‹æœºå·') || error.message.includes('phone')) {
      errorMessage = 'æ‰‹æœºå·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥åé‡è¯•'
    } else if (error.message.includes('ç”¨æˆ·') || error.message.includes('user')) {
      errorMessage = 'ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå·'
    } else if (error.message.includes('ç½‘ç»œ') || error.message.includes('timeout')) {
      errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•'
    } else {
      errorMessage = error.message
    }
  }
  
  uni.showToast({
    title: errorMessage,
    icon: 'none',
    duration: 3000
  })
}
```

### 3. å¾®ä¿¡ç™»å½•é”™è¯¯å¤„ç†

**ä¿®å¤å†…å®¹ï¼š** åŒæ ·ä¼˜åŒ–å¾®ä¿¡ç™»å½•çš„é”™è¯¯å¤„ç†

```javascript
// å¾®ä¿¡ç™»å½•é”™è¯¯å¤„ç†
} catch (error) {
  console.error('å¾®ä¿¡ç™»å½•å¤±è´¥:', error)
  
  // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
  let errorMessage = 'å¾®ä¿¡ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•'
  
  if (error.message) {
    if (error.message.includes('æˆæƒ') || error.message.includes('authorize')) {
      errorMessage = 'å¾®ä¿¡æˆæƒå¤±è´¥ï¼Œè¯·é‡æ–°æˆæƒ'
    } else if (error.message.includes('ç½‘ç»œ') || error.message.includes('timeout')) {
      errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•'
    } else if (error.message.includes('ç”¨æˆ·') || error.message.includes('user')) {
      errorMessage = 'ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥ï¼Œè¯·é‡è¯•'
    } else {
      errorMessage = error.message
    }
  }
  
  uni.showToast({
    title: errorMessage,
    icon: 'none',
    duration: 3000
  })
}
```

## âœ… ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ å¯†ç é”™è¯¯æ˜¾ç¤º"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"
- âŒ ç”¨æˆ·æ— æ³•çŸ¥é“å…·ä½“å¤±è´¥åŸå› 
- âŒ é”™è¯¯ä¿¡æ¯è¯¯å¯¼ç”¨æˆ·

### ä¿®å¤å
- âœ… å¯†ç é”™è¯¯æ˜¾ç¤º"å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥"
- âœ… æ‰‹æœºå·é”™è¯¯æ˜¾ç¤º"æ‰‹æœºå·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥åé‡è¯•"
- âœ… ç”¨æˆ·ä¸å­˜åœ¨æ˜¾ç¤º"ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå·"
- âœ… ç½‘ç»œé”™è¯¯æ˜¾ç¤º"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•"
- âœ… å¾®ä¿¡æˆæƒé”™è¯¯æ˜¾ç¤º"å¾®ä¿¡æˆæƒå¤±è´¥ï¼Œè¯·é‡æ–°æˆæƒ"

## ğŸ“‹ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `src/utils/api.js` - APIè¯·æ±‚é”™è¯¯å¤„ç†é€»è¾‘
- `src/pages/login/login.vue` - ç™»å½•é¡µé¢é”™è¯¯å¤„ç†

### æµ‹è¯•æ–‡ä»¶
- `tests/test-login-error-handling.html` - ç™»å½•é”™è¯¯å¤„ç†æµ‹è¯•é¡µé¢

## ğŸ¯ é”™è¯¯ä¿¡æ¯æ˜ å°„è¡¨

| é”™è¯¯ç±»å‹ | å…³é”®è¯ | æ˜¾ç¤ºä¿¡æ¯ |
|---------|--------|----------|
| å¯†ç é”™è¯¯ | å¯†ç ã€password | å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ |
| æ‰‹æœºå·é”™è¯¯ | æ‰‹æœºå·ã€phone | æ‰‹æœºå·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥åé‡è¯• |
| ç”¨æˆ·ä¸å­˜åœ¨ | ç”¨æˆ·ã€user | ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå· |
| ç½‘ç»œé”™è¯¯ | ç½‘ç»œã€timeout | ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯• |
| å¾®ä¿¡æˆæƒ | æˆæƒã€authorize | å¾®ä¿¡æˆæƒå¤±è´¥ï¼Œè¯·é‡æ–°æˆæƒ |
| å…¶ä»–é”™è¯¯ | - | æ˜¾ç¤ºåŸå§‹é”™è¯¯ä¿¡æ¯ |

## ğŸ”„ åç»­å»ºè®®

1. **é”™è¯¯ç›‘æ§**ï¼šæ·»åŠ é”™è¯¯æ—¥å¿—æ”¶é›†ï¼Œä¾¿äºåç»­ä¼˜åŒ–
2. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·å¯¹é”™è¯¯ä¿¡æ¯çš„åé¦ˆ
3. **å›½é™…åŒ–**ï¼šè€ƒè™‘å¤šè¯­è¨€é”™è¯¯ä¿¡æ¯æ”¯æŒ
4. **æµ‹è¯•è¦†ç›–**ï¼šå¢åŠ é”™è¯¯å¤„ç†çš„è‡ªåŠ¨åŒ–æµ‹è¯•

## ğŸ“Š ä¿®å¤æ€»ç»“

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| é”™è¯¯ä¿¡æ¯å‡†ç¡®æ€§ | ä¸å‡†ç¡® | å‡†ç¡® |
| ç”¨æˆ·ä½“éªŒ | å·® | è‰¯å¥½ |
| é”™è¯¯åˆ†ç±» | æ—  | æœ‰ |
| å¯æ“ä½œæ€§ | ä½ | é«˜ |

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2024å¹´12æœˆ19æ—¥  
**ä¿®å¤äººå‘˜**ï¼šAI Assistant  
**æµ‹è¯•çŠ¶æ€**ï¼šå¾…éªŒè¯  
**éƒ¨ç½²çŠ¶æ€**ï¼šå¾…éƒ¨ç½²
