# å‰ç«¯æ—¶é—´å¤„ç†ä¿®å¤æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤ç»Ÿä¸€äº†åç«¯æ‰€æœ‰æ—¶é—´å­˜å‚¨å’Œè¿”å›æ ¼å¼ï¼Œå‰ç«¯éœ€è¦ç›¸åº”è°ƒæ•´æ—¶é—´å¤„ç†é€»è¾‘ã€‚æ‰€æœ‰æ—¶é—´å­—æ®µç°åœ¨ç»Ÿä¸€è¿”å›UTCæ ¼å¼ã€‚

## ğŸ”§ åç«¯ä¿®å¤å†…å®¹

### 1. æ—¶é—´å­˜å‚¨æ ¼å¼
- **å­˜å‚¨æ–¹å¼**: æ‰€æœ‰æ—¶é—´ç»Ÿä¸€ä»¥UTCæ ¼å¼å­˜å‚¨åˆ°æ•°æ®åº“
- **è·å–æ–¹å¼**: ä½¿ç”¨æœåŠ¡å™¨å½“å‰æ—¶é—´ï¼Œç¡®ä¿æ—¶é—´å‡†ç¡®æ€§
- **å­˜å‚¨ç¤ºä¾‹**: `2025-09-12T00:21:00.000Z`

### 2. APIè¿”å›æ ¼å¼
- **ç»Ÿä¸€æ ¼å¼**: æ‰€æœ‰æ—¶é—´å­—æ®µè¿”å›UTCæ ¼å¼ (ISO 8601)
- **æ ¼å¼ç¤ºä¾‹**: `2025-09-12T08:21:00.000Z`
- **æ—¶åŒºæ ‡è¯†**: ä½¿ç”¨ `Z` åç¼€è¡¨ç¤ºUTCæ—¶é—´

## ğŸ“¡ å—å½±å“çš„APIæ¥å£

### æŠ¥é¤ç›¸å…³æ¥å£
| æ¥å£ | æ–¹æ³• | æ—¶é—´å­—æ®µ | è¿”å›æ ¼å¼ |
|------|------|----------|----------|
| `/api/dining/dept-order` | POST | - | - |
| `/api/dining/records` | GET | `registerTime`, `actualDiningTime` | UTCæ ¼å¼ |
| `/api/dining/records/:id/detail` | GET | `registerTime`, `actualDiningTime` | UTCæ ¼å¼ |

### ç¡®è®¤å°±é¤ç›¸å…³æ¥å£
| æ¥å£ | æ–¹æ³• | æ—¶é—´å­—æ®µ | è¿”å›æ ¼å¼ |
|------|------|----------|----------|
| `/api/dining-confirmation/manual/:orderId` | POST | `actualDiningTime` | UTCæ ¼å¼ |
| `/api/dining-confirmation/admin/:orderId` | POST | `actualDiningTime` | UTCæ ¼å¼ |
| `/api/dining-confirmation/status` | GET | `actualDiningTime`, `registerTime` | UTCæ ¼å¼ |
| `/api/dining-confirmation/history` | GET | `actualDiningTime`, `registerTime` | UTCæ ¼å¼ |

### QRæ‰«ç ç›¸å…³æ¥å£
| æ¥å£ | æ–¹æ³• | æ—¶é—´å­—æ®µ | è¿”å›æ ¼å¼ |
|------|------|----------|----------|
| `/api/qr-scan/scan` | POST | `scanTime`, `actualDiningTime` | UTCæ ¼å¼ |
| `/api/qr-scan/history` | GET | `scanTime` | UTCæ ¼å¼ |

## ğŸ› ï¸ å‰ç«¯ä¿®å¤æŒ‡å—

### 1. æ—¶é—´è§£æå¤„ç†

#### ä¿®å¤å‰ï¼ˆé”™è¯¯æ–¹å¼ï¼‰
```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨UTCæ—¶é—´ä½œä¸ºæœ¬åœ°æ—¶é—´æ˜¾ç¤º
const registerTime = new Date(apiData.registerTime);
console.log(registerTime.toLocaleString()); // æ˜¾ç¤ºé”™è¯¯æ—¶é—´
```

#### ä¿®å¤åï¼ˆæ­£ç¡®æ–¹å¼ï¼‰
```javascript
// âœ… æ­£ç¡®ï¼šå°†UTCæ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´æ˜¾ç¤º
const registerTime = new Date(apiData.registerTime);
console.log(registerTime.toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'}));
```

### 2. æ—¶é—´æ˜¾ç¤ºæ ¼å¼åŒ–

#### æ¨èçš„æ—¶é—´æ˜¾ç¤ºå‡½æ•°
```javascript
/**
 * å°†UTCæ—¶é—´è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´æ˜¾ç¤º
 * @param {string} utcTimeString - UTCæ—¶é—´å­—ç¬¦ä¸² (æ ¼å¼: 2025-09-12T08:21:00.000Z)
 * @param {string} format - æ˜¾ç¤ºæ ¼å¼ ('datetime' | 'date' | 'time')
 * @returns {string} æ ¼å¼åŒ–çš„åŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
 */
function formatUTCTime(utcTimeString, format = 'datetime') {
  if (!utcTimeString) return '-';
  
  const utcTime = new Date(utcTimeString);
  const beijingTime = new Intl.DateTimeFormat('zh-CN', {
    timeZone: 'Asia/Shanghai',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  }).format(utcTime);
  
  switch (format) {
    case 'date':
      return beijingTime.split(' ')[0];
    case 'time':
      return beijingTime.split(' ')[1];
    default:
      return beijingTime;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const registerTimeDisplay = formatUTCTime(apiData.registerTime);
const diningTimeDisplay = formatUTCTime(apiData.actualDiningTime);
```

### 3. æ—¶é—´å·®è®¡ç®—

#### ä¿®å¤å‰ï¼ˆå¯èƒ½é”™è¯¯ï¼‰
```javascript
// âŒ å¯èƒ½é”™è¯¯ï¼šå¦‚æœå‰ç«¯æ²¡æœ‰æ­£ç¡®å¤„ç†UTCæ—¶é—´
const timeDiff = new Date(apiData.actualDiningTime) - new Date(apiData.registerTime);
```

#### ä¿®å¤åï¼ˆæ­£ç¡®æ–¹å¼ï¼‰
```javascript
// âœ… æ­£ç¡®ï¼šUTCæ—¶é—´å¯ä»¥ç›´æ¥è¿›è¡Œæ•°å­¦è¿ç®—
const registerTime = new Date(apiData.registerTime);
const diningTime = new Date(apiData.actualDiningTime);
const timeDiff = diningTime - registerTime;
const hoursDiff = timeDiff / (1000 * 60 * 60);

console.log(`æ—¶é—´å·®: ${hoursDiff}å°æ—¶`);
```

### 4. ç»„ä»¶ä¸­çš„æ—¶é—´å¤„ç†

#### Reactç»„ä»¶ç¤ºä¾‹
```jsx
import React from 'react';

const DiningRecord = ({ record }) => {
  // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
  const formatTime = (utcTime) => {
    if (!utcTime) return '-';
    return new Date(utcTime).toLocaleString('zh-CN', {
      timeZone: 'Asia/Shanghai',
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  // è®¡ç®—æ—¶é—´å·®
  const getTimeDiff = (startTime, endTime) => {
    if (!startTime || !endTime) return '-';
    const diff = new Date(endTime) - new Date(startTime);
    const hours = Math.round(diff / (1000 * 60 * 60));
    return `${hours}å°æ—¶`;
  };

  return (
    <div className="dining-record">
      <div>æŠ¥é¤æ—¶é—´: {formatTime(record.registerTime)}</div>
      <div>å°±é¤æ—¶é—´: {formatTime(record.actualDiningTime)}</div>
      <div>æ—¶é—´é—´éš”: {getTimeDiff(record.registerTime, record.actualDiningTime)}</div>
    </div>
  );
};
```

#### Vueç»„ä»¶ç¤ºä¾‹
```vue
<template>
  <div class="dining-record">
    <div>æŠ¥é¤æ—¶é—´: {{ formatTime(record.registerTime) }}</div>
    <div>å°±é¤æ—¶é—´: {{ formatTime(record.actualDiningTime) }}</div>
    <div>æ—¶é—´é—´éš”: {{ getTimeDiff(record.registerTime, record.actualDiningTime) }}</div>
  </div>
</template>

<script>
export default {
  methods: {
    formatTime(utcTime) {
      if (!utcTime) return '-';
      return new Date(utcTime).toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    },
    
    getTimeDiff(startTime, endTime) {
      if (!startTime || !endTime) return '-';
      const diff = new Date(endTime) - new Date(startTime);
      const hours = Math.round(diff / (1000 * 60 * 60));
      return `${hours}å°æ—¶`;
    }
  }
}
</script>
```

## ğŸ“ æ—¶é—´å­—æ®µè¯´æ˜

### ä¸»è¦æ—¶é—´å­—æ®µ
| å­—æ®µå | å«ä¹‰ | æ ¼å¼ | ç¤ºä¾‹ |
|--------|------|------|------|
| `registerTime` | æŠ¥é¤æ—¶é—´ | UTC | `2025-09-12T00:21:00.000Z` |
| `actualDiningTime` | å®é™…å°±é¤æ—¶é—´ | UTC | `2025-09-12T08:21:00.000Z` |
| `scanTime` | æ‰«ç æ—¶é—´ | UTC | `2025-09-12T08:21:00.000Z` |
| `createTime` | åˆ›å»ºæ—¶é—´ | UTC | `2025-09-12T00:21:00.000Z` |
| `updateTime` | æ›´æ–°æ—¶é—´ | UTC | `2025-09-12T08:21:00.000Z` |

### æ—¶é—´æ ¼å¼ç‰¹å¾
- âœ… æ‰€æœ‰æ—¶é—´éƒ½ä»¥ `Z` ç»“å°¾ï¼Œè¡¨ç¤ºUTCæ—¶é—´
- âœ… æ ¼å¼ä¸º ISO 8601 æ ‡å‡†ï¼š`YYYY-MM-DDTHH:mm:ss.sssZ`
- âœ… å¯ä»¥ç›´æ¥ç”¨ `new Date()` è§£æ
- âœ… æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨çš„Date API

## âš ï¸ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1ï¼šç›´æ¥æ˜¾ç¤ºUTCæ—¶é—´
```javascript
// âŒ é”™è¯¯
const time = new Date(apiData.registerTime).toLocaleString();
// ç»“æœï¼šæ˜¾ç¤ºUTCæ—¶é—´ï¼Œç”¨æˆ·çœ‹åˆ°é”™è¯¯æ—¶é—´

// âœ… æ­£ç¡®
const time = new Date(apiData.registerTime).toLocaleString('zh-CN', {
  timeZone: 'Asia/Shanghai'
});
// ç»“æœï¼šæ˜¾ç¤ºåŒ—äº¬æ—¶é—´
```

### é”™è¯¯2ï¼šæ—¶åŒºè½¬æ¢é”™è¯¯
```javascript
// âŒ é”™è¯¯ï¼šæ‰‹åŠ¨åŠ å‡8å°æ—¶
const beijingTime = new Date(apiData.registerTime.getTime() + 8 * 60 * 60 * 1000);

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®æ—¶åŒºè½¬æ¢
const beijingTime = new Date(apiData.registerTime).toLocaleString('zh-CN', {
  timeZone: 'Asia/Shanghai'
});
```

### é”™è¯¯3ï¼šæ—¶é—´æ¯”è¾ƒé”™è¯¯
```javascript
// âŒ å¯èƒ½é”™è¯¯ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒ
if (apiData.registerTime > apiData.actualDiningTime) {
  // å¯èƒ½ä¸æ­£ç¡®
}

// âœ… æ­£ç¡®ï¼šDateå¯¹è±¡æ¯”è¾ƒ
const registerTime = new Date(apiData.registerTime);
const diningTime = new Date(apiData.actualDiningTime);
if (registerTime > diningTime) {
  // æ­£ç¡®
}
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹
```javascript
// æµ‹è¯•æ—¶é—´è§£æå’Œæ˜¾ç¤º
const testData = {
  registerTime: '2025-09-12T00:21:00.000Z',
  actualDiningTime: '2025-09-12T08:21:00.000Z'
};

// éªŒè¯è§£æ
const registerTime = new Date(testData.registerTime);
const diningTime = new Date(testData.actualDiningTime);

// éªŒè¯æ˜¾ç¤º
const registerDisplay = registerTime.toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'});
const diningDisplay = diningTime.toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'});

console.log('æŠ¥é¤æ—¶é—´æ˜¾ç¤º:', registerDisplay); // åº”è¯¥æ˜¯: 2025/9/12 08:21:00
console.log('å°±é¤æ—¶é—´æ˜¾ç¤º:', diningDisplay);   // åº”è¯¥æ˜¯: 2025/9/12 16:21:00

// éªŒè¯æ—¶é—´å·®
const timeDiff = diningTime - registerTime;
const hoursDiff = timeDiff / (1000 * 60 * 60);
console.log('æ—¶é—´å·®:', hoursDiff); // åº”è¯¥æ˜¯: 8
```

## ğŸ“‹ ä¿®å¤æ£€æŸ¥æ¸…å•

è¯·å‰ç«¯å¼€å‘äººå‘˜æŒ‰ä»¥ä¸‹æ¸…å•æ£€æŸ¥ä¿®å¤ï¼š

- [ ] æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºéƒ½ä½¿ç”¨äº†æ­£ç¡®çš„æ—¶åŒºè½¬æ¢
- [ ] æ—¶é—´æ ¼å¼åŒ–å‡½æ•°æ­£ç¡®å¤„ç†UTCæ—¶é—´
- [ ] æ—¶é—´å·®è®¡ç®—ä½¿ç”¨Dateå¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²
- [ ] ç»„ä»¶ä¸­çš„æ—¶é—´æ˜¾ç¤ºé€»è¾‘å·²æ›´æ–°
- [ ] æµ‹è¯•äº†æ—¶é—´æ˜¾ç¤ºçš„æ­£ç¡®æ€§
- [ ] éªŒè¯äº†æ—¶é—´å·®è®¡ç®—çš„å‡†ç¡®æ€§
- [ ] æ£€æŸ¥äº†æ‰€æœ‰ç›¸å…³é¡µé¢çš„æ—¶é—´æ˜¾ç¤º

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœåœ¨ä¿®å¤è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿã€‚

---
**æ›´æ–°æ—¶é—´**: 2025-09-12  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: éœ€è¦å‰ç«¯é…åˆä¿®å¤
