# å‰ç«¯æ—¶é—´å¤„ç†å¯¹æ¥å®Œæ•´æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸ºå‰ç«¯å¼€å‘äººå‘˜æä¾›å®Œæ•´çš„æ—¶é—´å¤„ç†å¯¹æ¥æŒ‡å—ï¼ŒåŒ…å«ç»Ÿä¸€æ—¶é—´å¤„ç†æ–¹æ¡ˆã€å·¥å…·ç±»ä½¿ç”¨ã€ç»„ä»¶ç¤ºä¾‹å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### æ—¶é—´å¤„ç†è§„èŒƒ
1. **åç«¯è¿”å›**ï¼šæ‰€æœ‰æ—¶é—´å­—æ®µéƒ½æ˜¯UTCæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰
2. **å‰ç«¯æ˜¾ç¤º**ï¼šç»Ÿä¸€è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´æ˜¾ç¤º
3. **å‰ç«¯æäº¤**ï¼šå°†åŒ—äº¬æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´æäº¤ç»™åç«¯
4. **å·¥å…·ç±»**ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´å¤„ç†å·¥å…·ç±»ï¼Œç¦æ­¢ç›´æ¥ä½¿ç”¨åŸç”ŸDateå¯¹è±¡

### æ—¶é—´æ ¼å¼çº¦å®š
- **APIè¿”å›æ ¼å¼**ï¼š`2024-01-15T10:30:00.000Z`ï¼ˆUTCæ—¶é—´ï¼‰
- **å‰ç«¯æ˜¾ç¤ºæ ¼å¼**ï¼š`2024-01-15 18:30:00`ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- **å‰ç«¯æäº¤æ ¼å¼**ï¼š`2024-01-15T10:30:00.000Z`ï¼ˆUTCæ—¶é—´ï¼‰

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
npm install dayjs
```

### 2. åˆ›å»ºæ—¶é—´å¤„ç†å·¥å…·ç±»

åˆ›å»ºæ–‡ä»¶ `src/utils/TimeUtils.js`ï¼š

```javascript
import dayjs from 'dayjs';
import relativeTime from 'dayjs/plugin/relativeTime';
import 'dayjs/locale/zh-cn';

// é…ç½®æ’ä»¶
dayjs.extend(relativeTime);
dayjs.locale('zh-cn');

/**
 * å‰ç«¯æ—¶é—´å¤„ç†å·¥å…·ç±»
 * ç»Ÿä¸€å¤„ç†ä»åç«¯æ¥æ”¶çš„UTCæ—¶é—´ï¼Œå¹¶è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´æ˜¾ç¤º
 */
export class TimeUtils {
  /**
   * è§£æåç«¯æ—¶é—´å­—ç¬¦ä¸²ä¸ºdayjså¯¹è±¡
   * @param {string} timeString - åç«¯UTCæ—¶é—´å­—ç¬¦ä¸²
   * @returns {dayjs|null} dayjså¯¹è±¡ï¼Œå¦‚æœè¾“å…¥æ— æ•ˆåˆ™è¿”å›null
   */
  static parseTime(timeString) {
    if (!timeString) return null;
    return dayjs(timeString);
  }

  /**
   * æ ¼å¼åŒ–UTCæ—¶é—´ä¸ºåŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
   * @param {string|Date} time - UTCæ—¶é—´å­—ç¬¦ä¸²æˆ–Dateå¯¹è±¡
   * @param {string} format - æ ¼å¼ç±»å‹
   * @returns {string} æ ¼å¼åŒ–åçš„åŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
   */
  static formatTime(time, format = 'YYYY-MM-DD HH:mm:ss') {
    if (!time) return '';
    // å°†UTCæ—¶é—´è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´æ˜¾ç¤º
    return dayjs(time).utcOffset(8).format(format);
  }

  /**
   * è·å–ç›¸å¯¹æ—¶é—´ï¼ˆå¦‚ï¼š3åˆ†é’Ÿå‰ã€2å°æ—¶å‰ï¼‰
   * @param {string|Date} time - UTCæ—¶é—´å­—ç¬¦ä¸²æˆ–Dateå¯¹è±¡
   * @returns {string} ç›¸å¯¹æ—¶é—´å­—ç¬¦ä¸²
   */
  static getRelativeTime(time) {
    if (!time) return '';
    return dayjs(time).fromNow();
  }

  /**
   * å°†åŒ—äº¬æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´ç”¨äºæäº¤ç»™åç«¯
   * @param {string|Date} beijingTime - åŒ—äº¬æ—¶é—´
   * @returns {string} ISO 8601æ ¼å¼çš„UTCæ—¶é—´å­—ç¬¦ä¸²
   */
  static toUTCForSubmit(beijingTime) {
    if (!beijingTime) return '';
    // åˆ¤æ–­è¾“å…¥æ˜¯å¦ä¸ºæ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²
    if (typeof beijingTime === 'string') {
      // å°è¯•è§£æä¸åŒæ ¼å¼çš„æ—¥æœŸæ—¶é—´
      let parsed;
      if (beijingTime.includes('T')) {
        // ISOæ ¼å¼å­—ç¬¦ä¸²
        parsed = dayjs(beijingTime);
      } else if (beijingTime.includes(' ')) {
        // YYYY-MM-DD HH:mm:ssæ ¼å¼
        parsed = dayjs(beijingTime, 'YYYY-MM-DD HH:mm:ss');
      } else if (beijingTime.length === 10) {
        // YYYY-MM-DDæ ¼å¼
        parsed = dayjs(beijingTime, 'YYYY-MM-DD');
      } else {
        // å…¶ä»–æ ¼å¼ï¼Œå°è¯•è‡ªåŠ¨è§£æ
        parsed = dayjs(beijingTime);
      }
      
      if (parsed.isValid()) {
        // è½¬æ¢ä¸ºUTCæ—¶é—´
        return parsed.utc().toISOString();
      }
      return '';
    }
    
    // å¦‚æœæ˜¯Dateå¯¹è±¡ï¼Œç›´æ¥è½¬æ¢
    return dayjs(beijingTime).utc().toISOString();
  }

  /**
   * è·å–å½“å‰æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰
   * @returns {string} å½“å‰æ—¥æœŸ
   */
  static getCurrentDate() {
    return dayjs().utcOffset(8).format('YYYY-MM-DD');
  }

  /**
   * è·å–å½“å‰æ—¶é—´å­—ç¬¦ä¸²ï¼ˆHH:mmæ ¼å¼ï¼‰
   * @returns {string} å½“å‰æ—¶é—´
   */
  static getCurrentTime() {
    return dayjs().utcOffset(8).format('HH:mm');
  }

  /**
   * éªŒè¯æ—¶é—´æ ¼å¼æ˜¯å¦æœ‰æ•ˆ
   * @param {string} timeString - æ—¶é—´å­—ç¬¦ä¸²
   * @returns {boolean} æ˜¯å¦æœ‰æ•ˆ
   */
  static isValidTime(timeString) {
    if (!timeString) return false;
    return dayjs(timeString).isValid();
  }

  /**
   * è®¡ç®—ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„å·®å€¼ï¼ˆåˆ†é’Ÿï¼‰
   * @param {string|Date} startTime - å¼€å§‹æ—¶é—´
   * @param {string|Date} endTime - ç»“æŸæ—¶é—´
   * @returns {number} æ—¶é—´å·®ï¼ˆåˆ†é’Ÿï¼‰
   */
  static getTimeDiff(startTime, endTime) {
    const start = this.parseTime(startTime);
    const end = this.parseTime(endTime);
    
    if (!start || !end) return 0;
    
    return end.diff(start, 'minute');
  }

  /**
   * æ£€æŸ¥æ—¥æœŸæ˜¯å¦ä¸ºä»Šå¤©
   * @param {string|Date} date - æ—¥æœŸ
   * @returns {boolean} æ˜¯å¦ä¸ºä»Šå¤©
   */
  static isToday(date) {
    if (!date) return false;
    const targetDate = this.parseTime(date);
    const today = dayjs().utcOffset(8);
    
    return targetDate && targetDate.isSame(today, 'day');
  }

  /**
   * æ£€æŸ¥æ—¥æœŸæ˜¯å¦ä¸ºè¿‡å»
   * @param {string|Date} date - æ—¥æœŸ
   * @returns {boolean} æ˜¯å¦ä¸ºè¿‡å»
   */
  static isPastDate(date) {
    if (!date) return false;
    const targetDate = this.parseTime(date);
    const today = dayjs().utcOffset(8).startOf('day');
    
    return targetDate && targetDate.isBefore(today);
  }

  /**
   * æ£€æŸ¥æ—¥æœŸæ˜¯å¦ä¸ºæœªæ¥
   * @param {string|Date} date - æ—¥æœŸ
   * @returns {boolean} æ˜¯å¦ä¸ºæœªæ¥
   */
  static isFutureDate(date) {
    if (!date) return false;
    const targetDate = this.parseTime(date);
    const today = dayjs().utcOffset(8).endOf('day');
    
    return targetDate && targetDate.isAfter(today);
  }

  /**
   * å®‰å…¨çš„æ—¶é—´æ ¼å¼åŒ–ï¼ŒåŒ…å«é”™è¯¯å¤„ç†
   * @param {string|Date} time - æ—¶é—´
   * @param {string} format - æ ¼å¼
   * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²æˆ–å ä½ç¬¦
   */
  static safeFormatTime(time, format = 'YYYY-MM-DD HH:mm:ss') {
    try {
      if (!time) return '--';
      if (!this.isValidTime(time)) return 'æ— æ•ˆæ—¶é—´';
      return this.formatTime(time, format);
    } catch (error) {
      console.error('æ—¶é—´æ ¼å¼åŒ–é”™è¯¯:', error);
      return '--';
    }
  }

  /**
   * å¤„ç†ä¸åŒæ—¶åŒºçš„æ—¶é—´æ˜¾ç¤º
   * @param {string|Date} time - æ—¶é—´
   * @param {string} timezone - æ—¶åŒºï¼Œé»˜è®¤Asia/Shanghai
   * @param {string} format - æ ¼å¼
   * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²
   */
  static formatTimeWithTimezone(time, timezone = 'Asia/Shanghai', format = 'YYYY-MM-DD HH:mm:ss') {
    try {
      if (!time) return '--';
      
      // ä½¿ç”¨Intl.DateTimeFormatå¤„ç†æ—¶åŒºè½¬æ¢
      const date = new Date(time);
      const options = {
        timeZone: timezone,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      };
      
      const formatter = new Intl.DateTimeFormat('zh-CN', options);
      const parts = formatter.formatToParts(date);
      
      // æ„å»ºè‡ªå®šä¹‰æ ¼å¼
      const formatted = format
        .replace('YYYY', parts.find(p => p.type === 'year').value)
        .replace('MM', parts.find(p => p.type === 'month').value)
        .replace('DD', parts.find(p => p.type === 'day').value)
        .replace('HH', parts.find(p => p.type === 'hour').value)
        .replace('mm', parts.find(p => p.type === 'minute').value)
        .replace('ss', parts.find(p => p.type === 'second').value);
      
      return formatted;
    } catch (error) {
      console.error('æ—¶åŒºè½¬æ¢é”™è¯¯:', error);
      return this.safeFormatTime(time, format);
    }
  }

  /**
   * è·å–æŒ‡å®šæ—¥æœŸçš„å¼€å§‹æ—¶é—´ï¼ˆ00:00:00ï¼‰
   * @param {string|Date} date - æ—¥æœŸ
   * @returns {string} è¯¥æ—¥æœŸå¼€å§‹æ—¶é—´çš„UTCå­—ç¬¦ä¸²
   */
  static getDayStartTime(date) {
    if (!date) return '';
    const targetDate = dayjs(date);
    if (!targetDate.isValid()) return '';
    
    return targetDate.startOf('day').utc().toISOString();
  }

  /**
   * è·å–æŒ‡å®šæ—¥æœŸçš„ç»“æŸæ—¶é—´ï¼ˆ23:59:59ï¼‰
   * @param {string|Date} date - æ—¥æœŸ
   * @returns {string} è¯¥æ—¥æœŸç»“æŸæ—¶é—´çš„UTCå­—ç¬¦ä¸²
   */
  static getDayEndTime(date) {
    if (!date) return '';
    const targetDate = dayjs(date);
    if (!targetDate.isValid()) return '';
    
    return targetDate.endOf('day').utc().toISOString();
  }

  /**
   * è·å–æŒ‡å®šæ—¥æœŸçš„å‰ä¸€å¤©
   * @param {string|Date} date - æ—¥æœŸ
   * @param {string} format - è¿”å›æ ¼å¼
   * @returns {string} å‰ä¸€å¤©çš„æ—¥æœŸå­—ç¬¦ä¸²
   */
  static getPreviousDay(date, format = 'YYYY-MM-DD') {
    if (!date) return '';
    const targetDate = this.parseTime(date);
    
    return targetDate ? targetDate.subtract(1, 'day').format(format) : '';
  }

  /**
   * è·å–æŒ‡å®šæ—¥æœŸçš„åä¸€å¤©
   * @param {string|Date} date - æ—¥æœŸ
   * @param {string} format - è¿”å›æ ¼å¼
   * @returns {string} åä¸€å¤©çš„æ—¥æœŸå­—ç¬¦ä¸²
   */
  static getNextDay(date, format = 'YYYY-MM-DD') {
    if (!date) return '';
    const targetDate = this.parseTime(date);
    
    return targetDate ? targetDate.add(1, 'day').format(format) : '';
  }

  /**
   * è·å–æ—¥æœŸèŒƒå›´æ•°ç»„
   * @param {string|Date} startDate - å¼€å§‹æ—¥æœŸ
   * @param {string|Date} endDate - ç»“æŸæ—¥æœŸ
   * @param {string} format - è¿”å›æ ¼å¼
   * @returns {string[]} æ—¥æœŸæ•°ç»„
   */
  static getDateRange(startDate, endDate, format = 'YYYY-MM-DD') {
    const start = this.parseTime(startDate);
    const end = this.parseTime(endDate);
    
    if (!start || !end || start.isAfter(end)) return [];
    
    const dates = [];
    let current = start;
    
    while (current.isBefore(end) || current.isSame(end, 'day')) {
      dates.push(current.format(format));
      current = current.add(1, 'day');
    }
    
    return dates;
  }

  /**
   * è·å–æ—¶é—´çŠ¶æ€ä¿¡æ¯
   * @param {string|Date} time - æ—¶é—´
   * @returns {Object} æ—¶é—´çŠ¶æ€å¯¹è±¡ {status, text, color}
   */
  static getTimeStatus(time) {
    if (!time) return { status: 'invalid', text: '--', color: 'gray' };
    
    const targetTime = this.parseTime(time);
    const now = dayjs();
    const diff = now.diff(targetTime, 'minute');
    
    if (diff < 5) return { status: 'new', text: 'åˆšåˆš', color: 'green' };
    if (diff < 30) return { status: 'recent', text: `${diff}åˆ†é’Ÿå‰`, color: 'blue' };
    if (diff < 60) return { status: 'old', text: `${Math.floor(diff / 60)}å°æ—¶å‰`, color: 'orange' };
    if (diff < 1440) return { status: 'very-old', text: `${Math.floor(diff / 1440)}å¤©å‰`, color: 'red' };
    
    return { status: 'past', text: this.formatTime(time, 'YYYY-MM-DD'), color: 'gray' };
  }
}

/**
 * æ—¶é—´æ ¼å¼åŒ–ç¼“å­˜å·¥å…·ç±»
 * ç”¨äºä¼˜åŒ–å¤§é‡æ•°æ®çš„æ—¶é—´æ ¼å¼åŒ–æ€§èƒ½
 */
export class TimeCache {
  static cache = new Map();
  static maxSize = 1000; // ç¼“å­˜æœ€å¤§æ¡ç›®æ•°
  
  /**
   * æ ¼å¼åŒ–æ—¶é—´å¹¶ç¼“å­˜ç»“æœ
   * @param {string|Date} time - æ—¶é—´
   * @param {string} format - æ ¼å¼
   * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´
   */
  static format(time, format) {
    if (!time) return '';
    
    const key = `${time}_${format}`;
    if (this.cache.has(key)) {
      return this.cache.get(key);
    }
    
    // ç¼“å­˜å¤§å°æ§åˆ¶
    if (this.cache.size >= this.maxSize) {
      // åˆ é™¤æœ€æ—©æ·»åŠ çš„ç¼“å­˜é¡¹
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    
    const formatted = TimeUtils.formatTime(time, format);
    this.cache.set(key, formatted);
    return formatted;
  }
  
  /**
   * æ¸…é™¤ç¼“å­˜
   */
  static clear() {
    this.cache.clear();
  }
  
  /**
   * è·å–ç¼“å­˜å¤§å°
   * @returns {number} ç¼“å­˜æ¡ç›®æ•°
   */
  static getSize() {
    return this.cache.size;
  }
}

export default TimeUtils;
```

## ğŸ¨ Vueç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

### 1. Vue 2 å…¨å±€è¿‡æ»¤å™¨

åœ¨ `main.js` ä¸­é…ç½®ï¼š

```javascript
import Vue from 'vue';
import { TimeUtils } from '@/utils/TimeUtils';

// æ³¨å†Œå…¨å±€è¿‡æ»¤å™¨
Vue.filter('formatTime', function(time, format = 'YYYY-MM-DD HH:mm') {
  return TimeUtils.formatTime(time, format);
});

Vue.filter('relativeTime', function(time) {
  return TimeUtils.getRelativeTime(time);
});

Vue.filter('safeFormatTime', function(time, format = 'YYYY-MM-DD HH:mm:ss') {
  return TimeUtils.safeFormatTime(time, format);
});
```

åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼š

```vue
<template>
  <div class="order-item">
    <h3>{{ order.title }}</h3>
    <p>åˆ›å»ºæ—¶é—´: {{ order.createTime | formatTime('YYYY-MM-DD HH:mm') }}</p>
    <p>æ›´æ–°æ—¶é—´: {{ order.updateTime | relativeTime }}</p>
    <p>çŠ¶æ€: {{ order.status | safeFormatTime }}</p>
  </div>
</template>
```

### 2. Vue 3 Composition API

```vue
<template>
  <div class="order-item">
    <h3>{{ order.title }}</h3>
    <p>åˆ›å»ºæ—¶é—´: {{ formatTime(order.createTime, 'YYYY-MM-DD HH:mm') }}</p>
    <p>æ›´æ–°æ—¶é—´: {{ getRelativeTime(order.updateTime) }}</p>
    <p>çŠ¶æ€: {{ safeFormatTime(order.status) }}</p>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import { TimeUtils } from '@/utils/TimeUtils';

const props = defineProps(['order']);

const formatTime = (time, format) => {
  return TimeUtils.formatTime(time, format);
};

const getRelativeTime = (time) => {
  return TimeUtils.getRelativeTime(time);
};

const safeFormatTime = (time, format) => {
  return TimeUtils.safeFormatTime(time, format);
};
</script>
```

### 3. è¡¨æ ¼ç»„ä»¶ç¤ºä¾‹

```vue
<template>
  <el-table :data="tableData" style="width: 100%">
    <el-table-column prop="orderId" label="è®¢å•ID" width="180" />
    
    <el-table-column prop="createTime" label="åˆ›å»ºæ—¶é—´" width="180">
      <template #default="{ row }">
        {{ formatTime(row.createTime, 'YYYY-MM-DD HH:mm') }}
      </template>
    </el-table-column>
    
    <el-table-column prop="updateTime" label="æ›´æ–°æ—¶é—´" width="180">
      <template #default="{ row }">
        <span :title="formatTime(row.updateTime, 'YYYY-MM-DD HH:mm:ss')">
          {{ getRelativeTime(row.updateTime) }}
        </span>
      </template>
    </el-table-column>
    
    <el-table-column prop="status" label="çŠ¶æ€" width="120">
      <template #default="{ row }">
        <el-tag :type="getTimeStatus(row.updateTime).color">
          {{ getTimeStatus(row.updateTime).text }}
        </el-tag>
      </template>
    </el-table-column>
  </el-table>
</template>

<script setup>
import { TimeUtils } from '@/utils/TimeUtils';

const formatTime = (time, format) => TimeUtils.formatTime(time, format);
const getRelativeTime = (time) => TimeUtils.getRelativeTime(time);
const getTimeStatus = (time) => TimeUtils.getTimeStatus(time);
</script>
```

### 4. è¡¨å•ç»„ä»¶ç¤ºä¾‹

```vue
<template>
  <el-form @submit="handleSubmit">
    <el-form-item label="æ—¥æœŸ">
      <el-date-picker
        v-model="form.date"
        type="date"
        placeholder="é€‰æ‹©æ—¥æœŸ"
        format="YYYY-MM-DD"
        value-format="YYYY-MM-DD"
      />
    </el-form-item>
    
    <el-form-item label="æ—¶é—´">
      <el-time-picker
        v-model="form.time"
        placeholder="é€‰æ‹©æ—¶é—´"
        format="HH:mm"
        value-format="HH:mm"
      />
    </el-form-item>
    
    <el-form-item label="æ—¶é—´èŒƒå›´">
      <el-date-picker
        v-model="form.dateRange"
        type="datetimerange"
        range-separator="è‡³"
        start-placeholder="å¼€å§‹æ—¶é—´"
        end-placeholder="ç»“æŸæ—¶é—´"
        format="YYYY-MM-DD HH:mm"
        value-format="YYYY-MM-DDTHH:mm:ss.sssZ"
      />
    </el-form-item>
    
    <el-button type="primary" @click="handleSubmit">æäº¤</el-button>
  </el-form>
</template>

<script setup>
import { ref } from 'vue';
import { TimeUtils } from '@/utils/TimeUtils';

const form = ref({
  date: TimeUtils.getCurrentDate(),
  time: TimeUtils.getCurrentTime(),
  dateRange: []
});

const handleSubmit = () => {
  // ç»„åˆæ—¥æœŸå’Œæ—¶é—´
  const localDateTime = `${form.value.date} ${form.value.time}`;
  
  // è½¬æ¢ä¸ºUTCæ—¶é—´æäº¤ç»™åç«¯
  const utcDateTime = TimeUtils.toUTCForSubmit(localDateTime);
  
  // å¤„ç†æ—¶é—´èŒƒå›´
  const startTime = TimeUtils.toUTCForSubmit(form.value.dateRange[0]);
  const endTime = TimeUtils.toUTCForSubmit(form.value.dateRange[1]);
  
  // æäº¤æ•°æ®
  const submitData = {
    eventTime: utcDateTime,
    startTime: startTime,
    endTime: endTime
  };
  
  console.log('æäº¤æ•°æ®:', submitData);
  // è°ƒç”¨APIæäº¤æ•°æ®
};
</script>
```

## âš›ï¸ Reactç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

### 1. è‡ªå®šä¹‰Hook

åˆ›å»º `src/hooks/useTime.js`ï¼š

```javascript
import { useMemo } from 'react';
import { TimeUtils } from '@/utils/TimeUtils';

export const useTime = () => {
  const formatTime = useMemo(() => {
    return (time, format) => TimeUtils.formatTime(time, format);
  }, []);

  const getRelativeTime = useMemo(() => {
    return (time) => TimeUtils.getRelativeTime(time);
  }, []);

  const safeFormatTime = useMemo(() => {
    return (time, format) => TimeUtils.safeFormatTime(time, format);
  }, []);

  const getTimeStatus = useMemo(() => {
    return (time) => TimeUtils.getTimeStatus(time);
  }, []);

  return {
    formatTime,
    getRelativeTime,
    safeFormatTime,
    getTimeStatus,
    getCurrentDate: TimeUtils.getCurrentDate,
    getCurrentTime: TimeUtils.getCurrentTime,
    toUTCForSubmit: TimeUtils.toUTCForSubmit
  };
};
```

### 2. æ—¶é—´æ˜¾ç¤ºç»„ä»¶

```jsx
import React from 'react';
import { useTime } from '@/hooks/useTime';

const TimeDisplay = ({ item }) => {
  const { formatTime, getRelativeTime, getTimeStatus } = useTime();

  return (
    <div className="time-display">
      <p>åˆ›å»ºæ—¶é—´: {formatTime(item.createTime, 'YYYY-MM-DD HH:mm')}</p>
      <p>æ›´æ–°æ—¶é—´: {getRelativeTime(item.updateTime)}</p>
      <span className={`status ${getTimeStatus(item.updateTime).color}`}>
        {getTimeStatus(item.updateTime).text}
      </span>
    </div>
  );
};

export default TimeDisplay;
```

### 3. è¡¨æ ¼ç»„ä»¶

```jsx
import React from 'react';
import { useTime } from '@/hooks/useTime';

const OrderTable = ({ data }) => {
  const { formatTime, getRelativeTime, getTimeStatus } = useTime();

  return (
    <table className="order-table">
      <thead>
        <tr>
          <th>è®¢å•ID</th>
          <th>åˆ›å»ºæ—¶é—´</th>
          <th>æ›´æ–°æ—¶é—´</th>
          <th>çŠ¶æ€</th>
        </tr>
      </thead>
      <tbody>
        {data.map((row) => (
          <tr key={row.id}>
            <td>{row.orderId}</td>
            <td>{formatTime(row.createTime, 'YYYY-MM-DD HH:mm')}</td>
            <td title={formatTime(row.updateTime, 'YYYY-MM-DD HH:mm:ss')}>
              {getRelativeTime(row.updateTime)}
            </td>
            <td>
              <span className={`status-tag ${getTimeStatus(row.updateTime).color}`}>
                {getTimeStatus(row.updateTime).text}
              </span>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  );
};

export default OrderTable;
```

### 4. è¡¨å•ç»„ä»¶

```jsx
import React, { useState } from 'react';
import { useTime } from '@/hooks/useTime';

const TimeForm = () => {
  const { getCurrentDate, getCurrentTime, toUTCForSubmit } = useTime();
  const [form, setForm] = useState({
    date: getCurrentDate(),
    time: getCurrentTime(),
    dateRange: []
  });

  const handleSubmit = () => {
    // ç»„åˆæ—¥æœŸå’Œæ—¶é—´
    const localDateTime = `${form.date} ${form.time}`;
    
    // è½¬æ¢ä¸ºUTCæ—¶é—´æäº¤ç»™åç«¯
    const utcDateTime = toUTCForSubmit(localDateTime);
    
    // å¤„ç†æ—¶é—´èŒƒå›´
    const startTime = toUTCForSubmit(form.dateRange[0]);
    const endTime = toUTCForSubmit(form.dateRange[1]);
    
    const submitData = {
      eventTime: utcDateTime,
      startTime: startTime,
      endTime: endTime
    };
    
    console.log('æäº¤æ•°æ®:', submitData);
    // è°ƒç”¨APIæäº¤æ•°æ®
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label>æ—¥æœŸ:</label>
        <input
          type="date"
          value={form.date}
          onChange={(e) => setForm({...form, date: e.target.value})}
        />
      </div>
      
      <div>
        <label>æ—¶é—´:</label>
        <input
          type="time"
          value={form.time}
          onChange={(e) => setForm({...form, time: e.target.value})}
        />
      </div>
      
      <button type="submit">æäº¤</button>
    </form>
  );
};

export default TimeForm;
```

## ğŸ”§ APIæ¥å£å¯¹æ¥

### 1. è¯·æ±‚æ•°æ®æ ¼å¼

```javascript
// å‰ç«¯æäº¤ç»™åç«¯çš„æ—¶é—´æ ¼å¼
const submitData = {
  eventTime: '2024-01-15T10:30:00.000Z',  // UTCæ—¶é—´
  deadline: '2024-01-20T18:00:00.000Z',   // UTCæ—¶é—´
  date: '2024-01-15',                      // ä»…æ—¥æœŸ
  startTime: '14:00',                      // ä»…æ—¶é—´
  endTime: '16:00'                         // ä»…æ—¶é—´
};
```

### 2. å“åº”æ•°æ®æ ¼å¼

```javascript
// åç«¯è¿”å›çš„æ—¶é—´æ ¼å¼
const responseData = {
  orderId: 'order-123',
  createTime: '2024-01-15T10:30:00.000Z',  // UTCæ—¶é—´
  updateTime: '2024-01-15T14:25:30.500Z',  // UTCæ—¶é—´
  diningDate: '2024-01-15',                // ä»…æ—¥æœŸ
  mealType: 'dinner'
};
```

### 3. APIè°ƒç”¨ç¤ºä¾‹

```javascript
import { TimeUtils } from '@/utils/TimeUtils';

// è·å–æ•°æ®
const fetchOrders = async () => {
  try {
    const response = await fetch('/api/orders');
    const data = await response.json();
    
    // æ•°æ®å·²ç»åŒ…å«UTCæ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨TimeUtilsæ ¼å¼åŒ–æ˜¾ç¤º
    return data.map(order => ({
      ...order,
      createTimeDisplay: TimeUtils.formatTime(order.createTime, 'YYYY-MM-DD HH:mm'),
      updateTimeDisplay: TimeUtils.getRelativeTime(order.updateTime)
    }));
  } catch (error) {
    console.error('è·å–è®¢å•å¤±è´¥:', error);
  }
};

// æäº¤æ•°æ®
const submitOrder = async (formData) => {
  try {
    const submitData = {
      ...formData,
      eventTime: TimeUtils.toUTCForSubmit(formData.eventTime),
      deadline: TimeUtils.toUTCForSubmit(formData.deadline)
    };
    
    const response = await fetch('/api/orders', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(submitData)
    });
    
    return await response.json();
  } catch (error) {
    console.error('æäº¤è®¢å•å¤±è´¥:', error);
  }
};
```

## ğŸ¯ ä¸šåŠ¡åœºæ™¯å¤„ç†

### 1. æŠ¥é¤æ—¶é—´å¤„ç†

```javascript
// æ£€æŸ¥æ˜¯å¦å¯ä»¥æŠ¥é¤
const canOrderMeal = (mealType) => {
  const now = dayjs().utcOffset(8);
  const today = now.format('YYYY-MM-DD');
  
  // å®šä¹‰å„é¤æ¬¡çš„æˆªæ­¢æ—¶é—´
  const deadlines = {
    'breakfast': `${today}T08:00:00`, // æ—©é¤8ç‚¹å‰
    'lunch': `${today}T11:00:00`,     // åˆé¤11ç‚¹å‰
    'dinner': `${today}T17:00:00`     // æ™šé¤17ç‚¹å‰
  };
  
  const deadline = dayjs(deadlines[mealType]).utcOffset(8);
  return now.isBefore(deadline);
};

// ä½¿ç”¨ç¤ºä¾‹
if (canOrderMeal('dinner')) {
  console.log('å¯ä»¥æŠ¥æ™šé¤');
} else {
  console.log('æ™šé¤æŠ¥é¤æ—¶é—´å·²è¿‡');
}
```

### 2. é¢„çº¦æ—¶é—´å¤„ç†

```javascript
// é¢„çº¦æ—¶é—´éªŒè¯
const validateReservationTime = (date, startTime, endTime) => {
  const now = dayjs().utcOffset(8);
  const reservationDate = dayjs(`${date}T${startTime}:00`).utcOffset(8);
  
  // æ£€æŸ¥æ˜¯å¦åœ¨æœªæ¥
  if (reservationDate.isBefore(now)) {
    return { valid: false, message: 'é¢„çº¦æ—¶é—´å¿…é¡»æ˜¯æœªæ¥æ—¶é—´' };
  }
  
  // æ£€æŸ¥æ—¶é—´èŒƒå›´
  const start = dayjs(`2000-01-01T${startTime}:00`).utcOffset(8);
  const end = dayjs(`2000-01-01T${endTime}:00`).utcOffset(8);
  const duration = end.diff(start, 'minute');
  
  if (duration <= 0) {
    return { valid: false, message: 'ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´' };
  }
  
  return { valid: true };
};
```

### 3. æ—¶é—´èŒƒå›´æŸ¥è¯¢

```javascript
// è·å–æ—¥æœŸèŒƒå›´
const getDateRange = (startDate, endDate) => {
  return TimeUtils.getDateRange(startDate, endDate);
};

// è·å–æ—¶é—´èŒƒå›´æŸ¥è¯¢å‚æ•°
const getTimeRangeQuery = (date) => {
  return {
    startTime: TimeUtils.getDayStartTime(date),
    endTime: TimeUtils.getDayEndTime(date)
  };
};

// ä½¿ç”¨ç¤ºä¾‹
const queryParams = getTimeRangeQuery('2024-01-15');
// ç»“æœ: { startTime: '2024-01-15T00:00:00.000Z', endTime: '2024-01-15T23:59:59.999Z' }
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æ—¶é—´æ ¼å¼åŒ–ç¼“å­˜

```javascript
import { TimeCache } from '@/utils/TimeUtils';

// åœ¨å¤§é‡æ•°æ®æ¸²æŸ“æ—¶ä½¿ç”¨ç¼“å­˜
const formatTimeWithCache = (time, format) => {
  return TimeCache.format(time, format);
};

// æ¸…é™¤ç¼“å­˜ï¼ˆåœ¨æ•°æ®æ›´æ–°åï¼‰
const clearTimeCache = () => {
  TimeCache.clear();
};
```

### 2. å»¶è¿Ÿæ ¼å¼åŒ–

```jsx
// Reactç¤ºä¾‹ - å»¶è¿Ÿæ ¼å¼åŒ–é¿å…é˜»å¡æ¸²æŸ“
const TimeCell = ({ time, format }) => {
  const [formattedTime, setFormattedTime] = useState('');
  
  useEffect(() => {
    // å»¶è¿Ÿæ ¼å¼åŒ–ï¼Œé¿å…é˜»å¡æ¸²æŸ“
    const timer = setTimeout(() => {
      setFormattedTime(TimeUtils.formatTime(time, format));
    }, 0);
    
    return () => clearTimeout(timer);
  }, [time, format]);
  
  return <span>{formattedTime}</span>;
};
```

### 3. è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–

```jsx
// åœ¨è™šæ‹Ÿæ»šåŠ¨ä¸­ä½¿ç”¨å»¶è¿Ÿæ ¼å¼åŒ–
const VirtualizedTimeList = ({ items }) => {
  const [visibleItems, setVisibleItems] = useState([]);
  
  useEffect(() => {
    // åªæ ¼å¼åŒ–å¯è§é¡¹
    const formatted = visibleItems.map(item => ({
      ...item,
      formattedTime: TimeUtils.formatTime(item.time)
    }));
    setVisibleItems(formatted);
  }, [visibleItems]);
  
  return (
    <div>
      {visibleItems.map(item => (
        <div key={item.id}>
          {item.formattedTime}
        </div>
      ))}
    </div>
  );
};
```

## ğŸš¨ é”™è¯¯å¤„ç†

### 1. å®‰å…¨æ ¼å¼åŒ–

```javascript
// ä½¿ç”¨å®‰å…¨æ ¼å¼åŒ–é¿å…é”™è¯¯
const safeDisplay = TimeUtils.safeFormatTime(time, 'YYYY-MM-DD HH:mm');
// å¦‚æœæ—¶é—´æ— æ•ˆï¼Œè¿”å› '--' æˆ– 'æ— æ•ˆæ—¶é—´'
```

### 2. æ—¶é—´éªŒè¯

```javascript
// éªŒè¯æ—¶é—´æ ¼å¼
const validateTime = (timeString) => {
  if (!TimeUtils.isValidTime(timeString)) {
    throw new Error('æ— æ•ˆçš„æ—¶é—´æ ¼å¼');
  }
  return true;
};
```

### 3. é”™è¯¯è¾¹ç•Œ

```jsx
// Reacté”™è¯¯è¾¹ç•Œ
class TimeErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('æ—¶é—´å¤„ç†é”™è¯¯:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <div>æ—¶é—´æ˜¾ç¤ºé”™è¯¯</div>;
    }

    return this.props.children;
  }
}
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€ä½¿ç”¨å·¥å…·ç±»

```javascript
// âœ… æ­£ç¡® - ä½¿ç”¨å·¥å…·ç±»
const displayTime = TimeUtils.formatTime(time, 'YYYY-MM-DD HH:mm');

// âŒ é”™è¯¯ - ç›´æ¥ä½¿ç”¨åŸç”ŸDate
const displayTime = new Date(time).toLocaleString();
```

### 2. æ˜ç¡®æ—¶åŒºå¤„ç†

```javascript
// âœ… æ­£ç¡® - æ˜ç¡®æŒ‡å®šæ—¶åŒºè½¬æ¢
const beijingTime = dayjs(time).utcOffset(8).format('YYYY-MM-DD HH:mm');

// âŒ é”™è¯¯ - ä¾èµ–ç³»ç»Ÿæ—¶åŒº
const localTime = dayjs(time).format('YYYY-MM-DD HH:mm');
```

### 3. ç»Ÿä¸€æ—¶é—´æ ¼å¼

```javascript
// âœ… æ­£ç¡® - ä½¿ç”¨æ ‡å‡†æ ¼å¼
const utcTime = '2024-01-15T10:30:00.000Z';
const beijingTime = '2024-01-15 18:30:00';

// âŒ é”™è¯¯ - ä½¿ç”¨éæ ‡å‡†æ ¼å¼
const utcTime = '2024-01-15 10:30:00';
const beijingTime = '2024-01-15T18:30:00+08:00';
```

### 4. æ€§èƒ½è€ƒè™‘

```javascript
// âœ… æ­£ç¡® - ä½¿ç”¨ç¼“å­˜
const formattedTime = TimeCache.format(time, format);

// âœ… æ­£ç¡® - å»¶è¿Ÿæ ¼å¼åŒ–
setTimeout(() => {
  setFormattedTime(TimeUtils.formatTime(time, format));
}, 0);

// âŒ é”™è¯¯ - é‡å¤æ ¼å¼åŒ–
const formattedTime = TimeUtils.formatTime(time, format); // æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ—¶é—´è°ƒè¯•å·¥å…·

```javascript
// åˆ›å»ºæ—¶é—´è°ƒè¯•å·¥å…·
const debugTime = (time, label = '') => {
  console.log(`${label}:`, {
    original: time,
    parsed: TimeUtils.parseTime(time),
    beijing: TimeUtils.formatTime(time, 'YYYY-MM-DD HH:mm:ss'),
    utc: TimeUtils.toUTCForSubmit(time),
    isValid: TimeUtils.isValidTime(time)
  });
};

// ä½¿ç”¨ç¤ºä¾‹
debugTime('2024-01-15T10:30:00.000Z', 'APIè¿”å›æ—¶é—´');
debugTime('2024-01-15 18:30:00', 'ç”¨æˆ·è¾“å…¥æ—¶é—´');
```

### 2. æ—¶åŒºæ£€æŸ¥

```javascript
// æ£€æŸ¥å½“å‰æ—¶åŒºè®¾ç½®
const checkTimezone = () => {
  console.log('å½“å‰æ—¶åŒºä¿¡æ¯:', {
    systemTimezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    utcTime: dayjs().utc().format('YYYY-MM-DD HH:mm:ss'),
    beijingTime: dayjs().utcOffset(8).format('YYYY-MM-DD HH:mm:ss'),
    localTime: dayjs().format('YYYY-MM-DD HH:mm:ss')
  });
};
```

## ğŸ“š æ€»ç»“

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„è§„èŒƒå’Œå®è·µï¼Œå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥ï¼š

1. **ç»Ÿä¸€æ—¶é—´å¤„ç†**ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´å¤„ç†å·¥å…·ç±»
2. **æ­£ç¡®æ˜¾ç¤ºæ—¶é—´**ï¼šå°†UTCæ—¶é—´æ­£ç¡®è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´æ˜¾ç¤º
3. **æ­£ç¡®æäº¤æ—¶é—´**ï¼šå°†åŒ—äº¬æ—¶é—´æ­£ç¡®è½¬æ¢ä¸ºUTCæ—¶é—´æäº¤
4. **ä¼˜åŒ–æ€§èƒ½**ï¼šä½¿ç”¨ç¼“å­˜å’Œå»¶è¿Ÿæ ¼å¼åŒ–ä¼˜åŒ–æ€§èƒ½
5. **å¤„ç†é”™è¯¯**ï¼šä½¿ç”¨å®‰å…¨æ ¼å¼åŒ–é¿å…æ—¶é—´å¤„ç†é”™è¯¯

éµå¾ªè¿™äº›è§„èŒƒå¯ä»¥ç¡®ä¿æ—¶é—´æ•°æ®åœ¨æ•´ä¸ªç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ï¼Œé¿å…æ—¶åŒºç›¸å…³çš„é—®é¢˜ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [å‰ç«¯å¯¹æ¥å¿«é€ŸæŒ‡å—](./å‰ç«¯å¯¹æ¥å¿«é€ŸæŒ‡å—.md)
- [å‰ç«¯APIæ¥å£æ—¶é—´å¤„ç†æ–‡æ¡£](./å‰ç«¯APIæ¥å£æ—¶é—´å¤„ç†æ–‡æ¡£.md)
- [ç»Ÿä¸€æ—¶é—´å¤„ç†æ–¹æ¡ˆåŠå‰ç«¯å¯¹æ¥æ–‡æ¡£](./ç»Ÿä¸€æ—¶é—´å¤„ç†æ–¹æ¡ˆåŠå‰ç«¯å¯¹æ¥æ–‡æ¡£.md)

---

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£åŸºäºç»Ÿä¸€æ—¶é—´å¤„ç†æ–¹æ¡ˆï¼Œè¯·ç¡®ä¿åç«¯ä¹Ÿéµå¾ªç›¸åº”çš„æ—¶é—´å¤„ç†è§„èŒƒã€‚