# 智慧物业管理系统 - 开发指南

## 📋 文档概述

本文档是智慧物业管理系统的开发指南，包含开发环境配置、代码规范、开发流程、调试技巧等开发人员需要了解的所有内容。

**文档版本**：v2.0.0  
**最后更新**：2025年9月7日  
**适用对象**：前端开发人员、后端开发人员、测试人员

---

## 🛠️ 开发环境配置

### 环境要求

#### 必需软件
- **Node.js**：>= 16.0.0
- **npm**：>= 8.0.0
- **Git**：>= 2.0.0
- **VS Code**：推荐使用

#### 推荐插件
- **Vue Language Features (Volar)**：Vue 3 语法支持
- **TypeScript Vue Plugin (Volar)**：TypeScript 支持
- **ESLint**：代码检查
- **Prettier**：代码格式化
- **Auto Rename Tag**：自动重命名标签
- **Bracket Pair Colorizer**：括号配对着色

### 项目初始化

#### 1. 克隆项目
```bash
git clone <项目地址>
cd my-vue3-project
```

#### 2. 安装依赖
```bash
npm install
```

#### 3. 启动开发服务器
```bash
# H5开发
npm run dev:h5

# 微信小程序开发
npm run dev:mp-weixin

# APP开发
npm run dev:app-plus
```

### 环境配置

#### 后端服务配置
确保后端服务在 `http://localhost:3000` 运行：

```bash
# 在后端项目目录中
cd backend
npm install
npm start
```

#### 前端环境自动切换
系统会自动检测开发环境并切换到本地API：

```javascript
// src/utils/api.js
const isLocalhost = currentUrl.includes('localhost') ||
                   currentUrl.includes('127.0.0.1') ||
                   currentUrl.includes('192.168.') ||
                   currentUrl.includes('10.0.') ||
                   currentUrl.includes('172.')

if (isLocalhost) {
  return API_CONFIG.DEV_BASE_URL // http://localhost:3000
} else {
  return API_CONFIG.PROD_BASE_URL // https://jcdtnpaompjy.sealosbja.site
}
```

---

## 📝 代码规范

### Vue组件规范

#### 组件命名
```vue
<!-- 组件文件名：UserEditModal.vue -->
<template>
  <!-- 模板内容 -->
</template>

<script>
export default {
  name: 'UserEditModal', // 组件名使用PascalCase
  // 组件逻辑
}
</script>
```

#### 组件结构
```vue
<template>
  <!-- 1. 模板内容 -->
</template>

<script>
export default {
  name: 'ComponentName',
  
  // 2. 组件注册
  components: {
    // 子组件
  },
  
  // 3. Props定义
  props: {
    visible: {
      type: Boolean,
      default: false
    }
  },
  
  // 4. 数据定义
  data() {
    return {
      // 响应式数据
    }
  },
  
  // 5. 计算属性
  computed: {
    // 计算属性
  },
  
  // 6. 监听器
  watch: {
    // 监听器
  },
  
  // 7. 生命周期
  created() {
    // 创建时
  },
  
  mounted() {
    // 挂载后
  },
  
  // 8. 方法
  methods: {
    // 组件方法
  }
}
</script>

<style lang="scss" scoped>
/* 9. 样式定义 */
</style>
```

### JavaScript规范

#### 变量命名
```javascript
// 使用camelCase
const userName = '张三'
const userInfo = {}
const isLoggedIn = false

// 常量使用UPPER_SNAKE_CASE
const API_BASE_URL = 'https://api.example.com'
const MAX_RETRY_COUNT = 3
```

#### 函数定义
```javascript
// 使用函数声明
function getUserInfo(userId) {
  return api.user.getInfo(userId)
}

// 使用箭头函数（适合回调）
const handleClick = () => {
  console.log('按钮被点击')
}

// 异步函数
async function loadUserData() {
  try {
    const response = await api.user.getInfo()
    return response.data
  } catch (error) {
    console.error('加载用户数据失败:', error)
    throw error
  }
}
```

#### API调用规范
```javascript
// 使用封装的API方法
import api from '@/utils/api'

// 正确的API调用方式
async function loadUserInfo() {
  try {
    const response = await api.user.getInfo()
    if (response.success) {
      this.userInfo = response.data
    } else {
      throw new Error(response.message)
    }
  } catch (error) {
    console.error('获取用户信息失败:', error)
    uni.showToast({
      title: '获取用户信息失败',
      icon: 'none'
    })
  }
}
```

### CSS规范

#### 类名命名
```scss
// 使用BEM命名规范
.user-card {
  // 块（Block）
  
  &__header {
    // 元素（Element）
  }
  
  &__content {
    // 元素（Element）
  }
  
  &--active {
    // 修饰符（Modifier）
  }
}

// 或者使用语义化命名
.form-section {
  margin-bottom: 20rpx;
  
  .section-title {
    font-size: 26rpx;
    font-weight: 600;
  }
  
  .section-content {
    padding: 16rpx;
  }
}
```

#### 样式组织
```scss
// 1. 变量定义
$primary-color: #667eea;
$text-color: #333;
$border-color: #f0f0f0;

// 2. 混入定义
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

// 3. 组件样式
.user-avatar {
  @include flex-center;
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  background-color: $primary-color;
}
```

---

## 🏗️ 项目结构详解

### 目录结构
```
src/
├── components/         # 公共组件
│   ├── UserAvatar.vue  # 用户头像组件
│   ├── UserEditModal.vue # 用户编辑弹窗
│   ├── DishSelector.vue # 菜品选择器
│   ├── SystemNotice.vue # 系统公告组件
│   └── form/           # 表单组件集合
│       ├── FormField.vue # 表单字段组件
│       ├── FormSection.vue # 表单分组组件
│       └── DatePicker.vue # 日期选择器
├── pages/              # 页面文件
│   ├── index/          # 首页模块
│   │   └── index.vue   # 首页
│   ├── dining/         # 报餐模块
│   │   ├── dining.vue  # 报餐主页面
│   │   └── components/ # 报餐相关组件
│   ├── reservation/    # 预约模块
│   │   └── reservation.vue # 预约页面
│   ├── admin/          # 管理后台
│   │   ├── index.vue   # 管理首页
│   │   ├── users.vue   # 用户管理
│   │   └── menus.vue   # 菜单管理
│   ├── profile/        # 个人中心
│   │   └── profile.vue # 个人中心页面
│   └── login/          # 登录模块
│       └── login.vue   # 登录页面
├── utils/              # 工具函数
│   ├── api.js          # API接口封装
│   ├── auth.js         # 认证工具
│   ├── apiCache.js     # 接口缓存
│   └── imageUtils.js   # 图片处理工具
└── static/             # 静态资源
    ├── icon.png        # 应用图标
    ├── logo.png        # 应用Logo
    └── icons/          # 图标集合
```

### 核心文件说明

#### 1. 应用入口 (main.js)
```javascript
import { createSSRApp } from "vue"
import App from "./App.vue"

export function createApp() {
  const app = createSSRApp(App)
  return {
    app,
  }
}
```

#### 2. API接口封装 (utils/api.js)
```javascript
// API配置
const API_CONFIG = {
  PROD_BASE_URL: 'https://jcdtnpaompjy.sealosbja.site',
  DEV_BASE_URL: 'http://localhost:3000',
  TIMEOUT: 10000
}

// 环境检测
function getBaseUrl() {
  const currentUrl = window.location?.href || ''
  const isLocalhost = currentUrl.includes('localhost')
  
  if (isLocalhost) {
    return API_CONFIG.DEV_BASE_URL
  }
  return API_CONFIG.PROD_BASE_URL
}

// API服务对象
const api = {
  // 用户相关
  user: {
    getInfo: () => request.get('/api/user/info'),
    updateInfo: (data) => request.put('/api/user/info', data),
    updateAvatar: (data) => request.put('/api/user/avatar', data)
  },
  
  // 报餐相关
  dining: {
    getMenu: (params) => request.get('/api/dining/menu', params),
    submitOrder: (data) => request.post('/api/dining/order', data),
    getRecords: (params) => request.get('/api/dining/records', params)
  }
}

export default api
```

#### 3. 认证工具 (utils/auth.js)
```javascript
// 认证状态管理
const auth = {
  // 检查登录状态
  isLoggedIn() {
    const token = uni.getStorageSync('userToken')
    return !!token
  },
  
  // 获取用户信息
  getUserInfo() {
    return uni.getStorageSync('userInfo') || {}
  },
  
  // 保存认证信息
  saveAuth(token, userInfo) {
    uni.setStorageSync('userToken', token)
    uni.setStorageSync('userInfo', userInfo)
  },
  
  // 清除认证信息
  clearAuth() {
    uni.removeStorageSync('userToken')
    uni.removeStorageSync('userInfo')
  }
}

export default auth
```

---

## 🔄 开发流程

### 新功能开发流程

#### 1. 需求分析
- 阅读产品文档了解需求
- 分析技术实现方案
- 评估开发工作量
- 确定开发计划

#### 2. 创建分支
```bash
# 创建功能分支
git checkout -b feature/新功能名称

# 例如：feature/user-avatar-upload
git checkout -b feature/user-avatar-upload
```

#### 3. 开发实现
```bash
# 开发过程中定期提交
git add .
git commit -m "feat: 添加用户头像上传功能"

# 推送到远程分支
git push origin feature/user-avatar-upload
```

#### 4. 代码审查
- 提交Pull Request
- 团队成员代码审查
- 修改审查意见
- 合并到主分支

#### 5. 测试验证
- 功能测试
- 兼容性测试
- 性能测试
- 用户验收测试

### Bug修复流程

#### 1. 问题定位
- 复现问题
- 分析错误日志
- 定位问题根因
- 制定修复方案

#### 2. 创建修复分支
```bash
# 创建修复分支
git checkout -b fix/问题描述

# 例如：fix/login-error
git checkout -b fix/login-error
```

#### 3. 修复实现
```bash
# 修复代码
git add .
git commit -m "fix: 修复登录页面错误处理"

# 推送到远程分支
git push origin fix/login-error
```

#### 4. 测试验证
- 验证修复效果
- 确保没有引入新问题
- 回归测试相关功能

### 代码提交规范

#### 提交信息格式
```bash
# 格式：<类型>: <描述>
git commit -m "feat: 添加用户头像上传功能"
git commit -m "fix: 修复登录页面样式问题"
git commit -m "docs: 更新API接口文档"
git commit -m "style: 调整代码格式"
git commit -m "refactor: 重构用户管理模块"
git commit -m "test: 添加用户组件测试用例"
git commit -m "chore: 更新依赖包版本"
```

#### 提交类型说明
- **feat**: 新功能
- **fix**: 修复问题
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 代码重构
- **test**: 测试相关
- **chore**: 构建过程或辅助工具的变动

---

## 🐛 调试技巧

### 浏览器调试

#### 1. 开发者工具使用
```javascript
// 控制台调试
console.log('调试信息:', data)
console.error('错误信息:', error)
console.warn('警告信息:', warning)

// 断点调试
debugger // 在代码中设置断点

// 性能分析
console.time('操作名称')
// 执行操作
console.timeEnd('操作名称')
```

#### 2. 网络调试
```javascript
// 查看API请求
console.log('API请求:', {
  url: requestUrl,
  method: requestMethod,
  headers: requestHeaders,
  data: requestData
})

// 查看API响应
console.log('API响应:', responseData)
```

#### 3. 状态调试
```javascript
// 查看组件状态
console.log('组件状态:', {
  userInfo: this.userInfo,
  isLoggedIn: this.isLoggedIn,
  permissions: this.permissions
})

// 查看Vue实例
console.log('Vue实例:', this.$data)
```

### 移动端调试

#### 1. 真机调试
```javascript
// 使用vconsole进行移动端调试
// 在main.js中添加
import VConsole from 'vconsole'
const vConsole = new VConsole()
```

#### 2. 微信小程序调试
- 使用微信开发者工具
- 查看Console面板
- 使用Network面板查看网络请求
- 使用Storage面板查看本地存储

#### 3. APP调试
- 使用HBuilderX内置调试器
- 使用Chrome DevTools远程调试
- 查看控制台输出

### 常见问题调试

#### 1. API请求失败
```javascript
// 检查网络连接
fetch('http://localhost:3000/health')
  .then(response => {
    console.log('网络连接正常:', response.status)
  })
  .catch(error => {
    console.error('网络连接失败:', error)
  })

// 检查API地址
console.log('当前API地址:', getBaseUrl())

// 检查请求头
console.log('请求头:', requestHeaders)
```

#### 2. 组件不渲染
```javascript
// 检查组件数据
console.log('组件数据:', this.$data)

// 检查计算属性
console.log('计算属性:', this.computedValue)

// 检查条件渲染
console.log('渲染条件:', this.shouldRender)
```

#### 3. 样式问题
```scss
// 使用浏览器检查元素
// 查看CSS规则是否生效
// 检查选择器优先级
// 使用!important临时解决
.user-avatar {
  width: 80rpx !important;
}
```

---

## 🧪 测试指南

### 单元测试

#### 测试环境配置
```bash
# 安装测试依赖
npm install --save-dev @vue/test-utils jest

# 配置Jest
# jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  moduleFileExtensions: ['js', 'vue'],
  transform: {
    '^.+\\.vue$': '@vue/vue3-jest',
    '^.+\\.js$': 'babel-jest'
  }
}
```

#### 组件测试示例
```javascript
// tests/components/UserAvatar.test.js
import { mount } from '@vue/test-utils'
import UserAvatar from '@/components/UserAvatar.vue'

describe('UserAvatar', () => {
  it('renders user avatar correctly', () => {
    const wrapper = mount(UserAvatar, {
      props: {
        user: {
          name: 'Test User',
          avatarUrl: 'test.jpg'
        }
      }
    })
    
    expect(wrapper.find('.avatar').exists()).toBe(true)
    expect(wrapper.find('.avatar').attributes('src')).toBe('test.jpg')
  })
  
  it('shows placeholder when no avatar', () => {
    const wrapper = mount(UserAvatar, {
      props: {
        user: {
          name: 'Test User',
          avatarUrl: null
        }
      }
    })
    
    expect(wrapper.find('.placeholder').exists()).toBe(true)
  })
})
```

### 集成测试

#### API测试
```javascript
// tests/api/user.test.js
import api from '@/utils/api'

describe('User API', () => {
  it('should get user info', async () => {
    const response = await api.user.getInfo()
    expect(response.success).toBe(true)
    expect(response.data).toHaveProperty('id')
  })
  
  it('should handle API error', async () => {
    // 模拟API错误
    jest.spyOn(api, 'get').mockRejectedValue(new Error('Network error'))
    
    await expect(api.user.getInfo()).rejects.toThrow('Network error')
  })
})
```

### 端到端测试

#### 使用Cypress
```javascript
// cypress/integration/login.spec.js
describe('Login Flow', () => {
  it('should login successfully', () => {
    cy.visit('/login')
    cy.get('[data-cy=username]').type('testuser')
    cy.get('[data-cy=password]').type('password')
    cy.get('[data-cy=login-btn]').click()
    cy.url().should('include', '/dashboard')
  })
})
```

---

## 📚 学习资源

### 官方文档
- [Vue 3 官方文档](https://vuejs.org/)
- [Uni-app 官方文档](https://uniapp.dcloud.net.cn/)
- [Vite 官方文档](https://vitejs.dev/)

### 推荐教程
- [Vue 3 组合式API](https://vuejs.org/guide/composition-api/)
- [Uni-app 跨平台开发](https://uniapp.dcloud.net.cn/tutorial/)
- [微信小程序开发](https://developers.weixin.qq.com/miniprogram/dev/)

### 开发工具
- [VS Code](https://code.visualstudio.com/)
- [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- [HBuilderX](https://www.dcloud.io/hbuilderx.html)

---

## 📞 技术支持

### 联系方式
- **开发团队**：dev@example.com
- **技术支持**：support@example.com
- **紧急联系**：emergency@example.com

### 问题反馈
- **Bug报告**：使用项目Issue系统
- **功能建议**：使用项目Issue系统
- **文档问题**：联系开发团队

### 代码审查
- **提交前检查**：确保代码质量
- **功能测试**：验证功能正确性
- **代码规范**：遵循团队规范
- **文档更新**：更新相关文档

---

*最后更新：2025年9月7日*  
*文档版本：v2.0.0*  
*维护者：开发团队*
