# 确认就餐功能使用说明

## 📋 功能概述

根据核心功能文档，我们已经完善了确认就餐和二维码扫码就餐功能。这些功能包括：

1. **用户端功能**：查看就餐状态、手动确认就餐、扫码就餐、查看历史记录
2. **管理员功能**：代确认就餐、批量确认、二维码管理、统计信息

## 🎯 新增页面

### 用户端页面

#### 1. 就餐状态页面 (`/pages/dining/dining-status`)
- **功能**：显示用户各餐次的报餐和确认状态
- **入口**：个人中心 → 就餐管理 → 就餐状态
- **主要功能**：
  - 查看今日各餐次状态（早餐、午餐、晚餐）
  - 手动确认就餐
  - 查看统计信息
  - 快捷操作（查看历史、扫码就餐）

#### 2. 扫码就餐页面 (`/pages/dining/qr-scan`)
- **功能**：用户通过扫描二维码确认就餐
- **入口**：个人中心 → 就餐管理 → 扫码就餐
- **主要功能**：
  - 扫描二维码自动识别餐次
  - 手动输入二维码内容
  - 查看今日就餐概览
  - 查看最近扫码记录

#### 3. 就餐确认历史页面 (`/pages/dining/dining-confirmation-history`)
- **功能**：查看用户的就餐确认历史记录
- **入口**：个人中心 → 就餐管理 → 就餐历史
- **主要功能**：
  - 按日期范围筛选
  - 按餐次类型筛选
  - 按状态筛选
  - 分页加载历史记录

### 管理员端页面

#### 4. 确认就餐管理页面 (`/pages/admin/dining-confirmation`)
- **功能**：管理员代确认和批量确认就餐
- **入口**：管理员首页 → 就餐管理 → 确认就餐管理
- **主要功能**：
  - 查看待确认列表
  - 单个确认就餐
  - 批量确认就餐
  - 按条件筛选（日期、餐次、部门、状态）
  - 查看统计信息

#### 5. 二维码管理页面 (`/pages/admin/qr-management`)
- **功能**：管理扫码就餐的二维码
- **入口**：管理员首页 → 就餐管理 → 二维码管理
- **主要功能**：
  - 创建新二维码
  - 查看二维码列表
  - 查看二维码详情和使用统计
  - 启用/停用二维码
  - 删除二维码

## 🔧 API接口

### 确认就餐接口

```javascript
// 获取用户就餐确认状态
api.diningConfirmation.getStatus(date)

// 用户手动确认就餐
api.diningConfirmation.manualConfirm(orderId, confirmationType)

// 获取就餐确认历史记录
api.diningConfirmation.getHistory(params)

// 管理员代确认就餐
api.diningConfirmation.adminConfirm(orderId, remark)

// 批量确认就餐
api.diningConfirmation.batchConfirm(orderIds, remark)

// 获取待确认就餐列表
api.diningConfirmation.getPendingList(params)

// 获取就餐确认统计
api.diningConfirmation.getStats(date, departmentId)
```

### 二维码扫码接口

```javascript
// 扫码就餐登记
api.qrScan.scan(qrCode, scanTime)

// 获取用户就餐登记历史
api.qrScan.getHistory(params)

// 获取今日就餐概览
api.qrScan.getTodayOverview()

// 获取就餐统计信息（管理员）
api.qrScan.getStatistics(date)

// 创建二维码（管理员）
api.qrScan.createQrCode(qrData)

// 获取二维码列表（管理员）
api.qrScan.getQrCodes(params)

// 获取二维码详情（管理员）
api.qrScan.getQrCodeDetail(qrId)

// 更新二维码状态（管理员）
api.qrScan.updateQrCodeStatus(qrId, status)
```

## 📱 使用流程

### 用户使用流程

1. **查看就餐状态**
   - 进入个人中心 → 就餐管理 → 就餐状态
   - 查看各餐次的报餐和确认状态
   - 可以手动确认已就餐的餐次

2. **扫码就餐**
   - 进入个人中心 → 就餐管理 → 扫码就餐
   - 扫描餐厅张贴的二维码
   - 系统自动识别餐次并完成登记

3. **查看历史记录**
   - 进入个人中心 → 就餐管理 → 就餐历史
   - 可以按条件筛选查看历史记录

### 管理员使用流程

1. **确认就餐管理**
   - 进入管理员首页 → 就餐管理 → 确认就餐管理
   - 查看待确认的就餐记录
   - 可以单个或批量确认用户已就餐

2. **二维码管理**
   - 进入管理员首页 → 就餐管理 → 二维码管理
   - 创建新的二维码
   - 管理现有二维码的状态
   - 查看二维码的使用统计

## ⚠️ 注意事项

### 业务规则

1. **时间限制**：只有在就餐时间内才能确认就餐
   - 早餐：6:00-10:00
   - 午餐：11:00-14:00
   - 晚餐：17:00-20:00

2. **报餐验证**：用户必须先报餐才能进行就餐确认

3. **重复确认**：同一用户同一餐次只能确认一次

4. **权限控制**：
   - 用户只能确认自己的就餐
   - 管理员可以代确认任何用户的就餐
   - 只有管理员可以管理二维码

### 错误处理

- 所有接口都有完善的错误处理机制
- 网络错误会自动重试
- 业务错误会显示具体的错误信息
- 权限错误会自动跳转到登录页

## 🚀 部署说明

1. **前端部署**：
   - 所有新页面已添加到 `pages.json` 路由配置
   - API接口已集成到 `api.js` 中
   - 页面入口已添加到个人中心和管理员首页

2. **后端接口**：
   - 需要后端实现对应的API接口
   - 接口规范请参考 `接口文档v2/01-核心功能/` 目录下的文档

3. **数据库**：
   - 需要创建相应的数据表
   - 表结构请参考接口文档中的数据库设计部分

## 📊 功能特点

- **响应式设计**：支持移动端和桌面端
- **实时更新**：状态变化实时反映
- **批量操作**：支持批量确认提高效率
- **数据统计**：提供详细的统计信息
- **权限控制**：完善的权限管理
- **错误处理**：友好的错误提示和处理

## 🔄 后续优化

1. **性能优化**：添加数据缓存和懒加载
2. **功能增强**：添加更多筛选条件和导出功能
3. **用户体验**：优化界面交互和动画效果
4. **数据安全**：加强数据验证和权限控制

---

**开发完成时间**：2025年1月  
**开发人员**：Linus Torvalds (AI Assistant)  
**文档版本**：v1.0.0
