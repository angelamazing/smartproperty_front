# è§’è‰²ç®¡ç†æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

è§’è‰²ç®¡ç†æ¥å£æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ã€æƒé™åˆ†é…ã€ç”¨æˆ·è§’è‰²ç®¡ç†ç­‰åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/admin/roles`

**è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦æœ‰æ•ˆçš„JWT Tokenå’Œç³»ç»Ÿç®¡ç†å‘˜æƒé™

## ğŸ” æ¥å£åˆ—è¡¨

### 1. è·å–è§’è‰²åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /api/admin/roles`

**æ¥å£æè¿°**: è·å–è§’è‰²åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**æŸ¥è¯¢å‚æ•°**:
```
page: number          // é¡µç ï¼Œé»˜è®¤1
size: number          // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
status: string        // çŠ¶æ€ç­›é€‰ï¼šactive/disabledï¼ˆå¯é€‰ï¼‰
keyword: string       // å…³é”®è¯æœç´¢ï¼ˆè§’è‰²åç§°/æè¿°ï¼‰
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–è§’è‰²åˆ—è¡¨æˆåŠŸ",
  "data": {
    "list": [
      {
        "_id": "role_id_1",
        "name": "ç³»ç»Ÿç®¡ç†å‘˜",
        "code": "sys_admin",
        "description": "æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™",
        "level": 3,
        "permissions": [
          "user:read", "user:create", "user:update", "user:delete",
          "role:read", "role:create", "role:update", "role:delete",
          "system:read", "system:update", "system:admin"
        ],
        "status": "active",
        "userCount": 2,
        "createTime": "2024-01-01T00:00:00.000Z",
        "updateTime": "2024-01-15T10:30:00.000Z"
      },
      {
        "_id": "role_id_2",
        "name": "éƒ¨é—¨ç®¡ç†å‘˜",
        "code": "dept_admin",
        "description": "ç®¡ç†æœ¬éƒ¨é—¨ç”¨æˆ·å’ŒæŸ¥çœ‹ç»Ÿè®¡æ•°æ®",
        "level": 1,
        "permissions": [
          "user:read", "user:update",
          "dining:read", "dining:stats",
          "reservation:read", "reservation:stats"
        ],
        "status": "active",
        "userCount": 15,
        "createTime": "2024-01-01T00:00:00.000Z",
        "updateTime": "2024-01-15T10:30:00.000Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 8,
      "totalPages": 1
    }
  }
}
```

---

### 2. è·å–è§’è‰²è¯¦æƒ…

**æ¥å£åœ°å€**: `GET /api/admin/roles/:roleId`

**æ¥å£æè¿°**: è·å–æŒ‡å®šè§’è‰²çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**è·¯å¾„å‚æ•°**:
```
roleId: string  // è§’è‰²ID
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–è§’è‰²è¯¦æƒ…æˆåŠŸ",
  "data": {
    "_id": "role_id_1",
    "name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "code": "sys_admin",
    "description": "æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™",
    "level": 3,
    "permissions": [
      "user:read", "user:create", "user:update", "user:delete",
      "role:read", "role:create", "role:update", "role:delete",
      "system:read", "system:update", "system:admin"
    ],
    "status": "active",
    "userCount": 2,
    "assignedUsers": [
      {
        "_id": "user_id_1",
        "nickName": "å¼ ä¸‰",
        "realName": "å¼ ä¸‰",
        "phoneNumber": "13800138000"
      }
    ],
    "createTime": "2024-01-01T00:00:00.000Z",
    "updateTime": "2024-01-15T10:30:00.000Z"
  }
}
```

---

### 3. åˆ›å»ºè§’è‰²

**æ¥å£åœ°å€**: `POST /api/admin/roles`

**æ¥å£æè¿°**: åˆ›å»ºæ–°è§’è‰²

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "å†…å®¹ç¼–è¾‘å‘˜",
  "code": "content_editor",
  "description": "è´Ÿè´£å†…å®¹ç¼–è¾‘å’Œå®¡æ ¸",
  "level": 2,
  "permissions": [
    "menu:read", "menu:create", "menu:update",
    "dish:read", "dish:create", "dish:update",
    "content:read", "content:create", "content:update"
  ]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²åˆ›å»ºæˆåŠŸ",
  "data": {
    "roleId": "role_id_3",
    "name": "å†…å®¹ç¼–è¾‘å‘˜",
    "code": "content_editor",
    "createTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 4. æ›´æ–°è§’è‰²ä¿¡æ¯

**æ¥å£åœ°å€**: `PUT /api/admin/roles/:roleId`

**æ¥å£æè¿°**: æ›´æ–°è§’è‰²ä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:
```
roleId: string  // è§’è‰²ID
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "é«˜çº§å†…å®¹ç¼–è¾‘å‘˜",
  "description": "è´Ÿè´£é«˜çº§å†…å®¹ç¼–è¾‘å’Œå®¡æ ¸ï¼Œæ‹¥æœ‰æ›´å¤šæƒé™",
  "permissions": [
    "menu:read", "menu:create", "menu:update", "menu:delete",
    "dish:read", "dish:create", "dish:update", "dish:delete",
    "content:read", "content:create", "content:update", "content:delete"
  ]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "roleId": "role_id_3",
    "updateTime": "2024-01-15T16:30:00.000Z",
    "updatedFields": ["name", "description", "permissions"]
  }
}
```

---

### 5. åˆ é™¤è§’è‰²

**æ¥å£åœ°å€**: `DELETE /api/admin/roles/:roleId`

**æ¥å£æè¿°**: åˆ é™¤è§’è‰²ï¼ˆè½¯åˆ é™¤ï¼‰

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**è·¯å¾„å‚æ•°**:
```
roleId: string  // è§’è‰²ID
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²åˆ é™¤æˆåŠŸ",
  "data": {
    "roleId": "role_id_3",
    "deleteTime": "2024-01-15T16:30:00.000Z",
    "deletedBy": "admin_id"
  }
}
```

---

### 6. åˆ†é…è§’è‰²ç»™ç”¨æˆ·

**æ¥å£åœ°å€**: `POST /api/admin/roles/assign`

**æ¥å£æè¿°**: å°†è§’è‰²åˆ†é…ç»™æŒ‡å®šç”¨æˆ·

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "userId": "user_id_2",
  "roleId": "role_id_3"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²åˆ†é…æˆåŠŸ",
  "data": {
    "userId": "user_id_2",
    "roleId": "role_id_3",
    "roleName": "å†…å®¹ç¼–è¾‘å‘˜",
    "assignTime": "2024-01-15T16:30:00.000Z",
    "assignedBy": "admin_id"
  }
}
```

---

### 7. æ‰¹é‡åˆ†é…è§’è‰²

**æ¥å£åœ°å€**: `POST /api/admin/roles/batch-assign`

**æ¥å£æè¿°**: æ‰¹é‡åˆ†é…è§’è‰²ç»™å¤šä¸ªç”¨æˆ·

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "assignments": [
    {
      "userId": "user_id_2",
      "roleId": "role_id_3"
    },
    {
      "userId": "user_id_3",
      "roleId": "role_id_3"
    }
  ]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æ‰¹é‡è§’è‰²åˆ†é…æˆåŠŸ",
  "data": {
    "successCount": 2,
    "failedCount": 0,
    "assignments": [
      {
        "userId": "user_id_2",
        "roleId": "role_id_3",
        "status": "success"
      },
      {
        "userId": "user_id_3",
        "roleId": "role_id_3",
        "status": "success"
      }
    ],
    "assignTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 8. æ’¤é”€ç”¨æˆ·è§’è‰²

**æ¥å£åœ°å€**: `DELETE /api/admin/roles/assign`

**æ¥å£æè¿°**: æ’¤é”€ç”¨æˆ·çš„è§’è‰²åˆ†é…

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "userId": "user_id_2",
  "roleId": "role_id_3"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²æ’¤é”€æˆåŠŸ",
  "data": {
    "userId": "user_id_2",
    "roleId": "role_id_3",
    "roleName": "å†…å®¹ç¼–è¾‘å‘˜",
    "revokeTime": "2024-01-15T16:30:00.000Z",
    "revokedBy": "admin_id"
  }
}
```

---

### 9. è·å–æƒé™åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /api/admin/roles/permissions`

**æ¥å£æè¿°**: è·å–ç³»ç»Ÿæ‰€æœ‰å¯ç”¨æƒé™åˆ—è¡¨

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–æƒé™åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "module": "ç”¨æˆ·ç®¡ç†",
      "permissions": [
        {
          "code": "user:read",
          "name": "æŸ¥çœ‹ç”¨æˆ·",
          "description": "æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨å’Œè¯¦æƒ…"
        },
        {
          "code": "user:create",
          "name": "åˆ›å»ºç”¨æˆ·",
          "description": "åˆ›å»ºæ–°ç”¨æˆ·"
        },
        {
          "code": "user:update",
          "name": "æ›´æ–°ç”¨æˆ·",
          "description": "ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"
        },
        {
          "code": "user:delete",
          "name": "åˆ é™¤ç”¨æˆ·",
          "description": "åˆ é™¤ç”¨æˆ·"
        }
      ]
    },
    {
      "module": "è§’è‰²ç®¡ç†",
      "permissions": [
        {
          "code": "role:read",
          "name": "æŸ¥çœ‹è§’è‰²",
          "description": "æŸ¥çœ‹è§’è‰²åˆ—è¡¨å’Œè¯¦æƒ…"
        },
        {
          "code": "role:create",
          "name": "åˆ›å»ºè§’è‰²",
          "description": "åˆ›å»ºæ–°è§’è‰²"
        },
        {
          "code": "role:update",
          "name": "æ›´æ–°è§’è‰²",
          "description": "ä¿®æ”¹è§’è‰²ä¿¡æ¯"
        },
        {
          "code": "role:delete",
          "name": "åˆ é™¤è§’è‰²",
          "description": "åˆ é™¤è§’è‰²"
        }
      ]
    },
    {
      "module": "èœå•ç®¡ç†",
      "permissions": [
        {
          "code": "menu:read",
          "name": "æŸ¥çœ‹èœå•",
          "description": "æŸ¥çœ‹èœå•åˆ—è¡¨å’Œè¯¦æƒ…"
        },
        {
          "code": "menu:create",
          "name": "åˆ›å»ºèœå•",
          "description": "åˆ›å»ºæ–°èœå•"
        },
        {
          "code": "menu:update",
          "name": "æ›´æ–°èœå•",
          "description": "ä¿®æ”¹èœå•ä¿¡æ¯"
        },
        {
          "code": "menu:delete",
          "name": "åˆ é™¤èœå•",
          "description": "åˆ é™¤èœå•"
        }
      ]
    }
  ]
}
```

---

### 10. è·å–è§’è‰²æƒé™

**æ¥å£åœ°å€**: `GET /api/admin/roles/:roleId/permissions`

**æ¥å£æè¿°**: è·å–æŒ‡å®šè§’è‰²çš„æƒé™è¯¦æƒ…

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**è·¯å¾„å‚æ•°**:
```
roleId: string  // è§’è‰²ID
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–è§’è‰²æƒé™æˆåŠŸ",
  "data": {
    "roleId": "role_id_3",
    "roleName": "å†…å®¹ç¼–è¾‘å‘˜",
    "permissions": [
      {
        "code": "menu:read",
        "name": "æŸ¥çœ‹èœå•",
        "description": "æŸ¥çœ‹èœå•åˆ—è¡¨å’Œè¯¦æƒ…",
        "granted": true
      },
      {
        "code": "menu:create",
        "name": "åˆ›å»ºèœå•",
        "description": "åˆ›å»ºæ–°èœå•",
        "granted": true
      },
      {
        "code": "menu:update",
        "name": "æ›´æ–°èœå•",
        "description": "ä¿®æ”¹èœå•ä¿¡æ¯",
        "granted": true
      },
      {
        "code": "menu:delete",
        "name": "åˆ é™¤èœå•",
        "description": "åˆ é™¤èœå•",
        "granted": false
      }
    ]
  }
}
```

---

### 11. æ›´æ–°è§’è‰²æƒé™

**æ¥å£åœ°å€**: `PUT /api/admin/roles/:roleId/permissions`

**æ¥å£æè¿°**: æ›´æ–°æŒ‡å®šè§’è‰²çš„æƒé™

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:
```
roleId: string  // è§’è‰²ID
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "permissions": [
    "menu:read", "menu:create", "menu:update", "menu:delete",
    "dish:read", "dish:create", "dish:update", "dish:delete"
  ]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è§’è‰²æƒé™æ›´æ–°æˆåŠŸ",
  "data": {
    "roleId": "role_id_3",
    "updatedPermissions": [
      "menu:read", "menu:create", "menu:update", "menu:delete",
      "dish:read", "dish:create", "dish:update", "dish:delete"
    ],
    "updateTime": "2024-01-15T16:30:00.000Z",
    "updatedBy": "admin_id"
  }
}
```

---

## ğŸ“± å‰ç«¯é›†æˆç¤ºä¾‹

### JavaScriptç¤ºä¾‹

```javascript
// è·å–è§’è‰²åˆ—è¡¨
async function getRolesList(params = {}) {
  try {
    const token = localStorage.getItem('token');
    const queryString = new URLSearchParams(params).toString();
    
    const response = await fetch(`/api/admin/roles?${queryString}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–è§’è‰²åˆ—è¡¨å¤±è´¥:', error);
    throw error;
  }
}

// åˆ›å»ºè§’è‰²
async function createRole(roleData) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/admin/roles', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(roleData)
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('åˆ›å»ºè§’è‰²å¤±è´¥:', error);
    throw error;
  }
}

// åˆ†é…è§’è‰²
async function assignRole(userId, roleId) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/admin/roles/assign', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId, roleId })
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('åˆ†é…è§’è‰²å¤±è´¥:', error);
    throw error;
  }
}

// è·å–æƒé™åˆ—è¡¨
async function getPermissionsList() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/admin/roles/permissions', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–æƒé™åˆ—è¡¨å¤±è´¥:', error);
    throw error;
  }
}
```

## ğŸ”’ æƒé™è¯´æ˜

### è§’è‰²ç®¡ç†æƒé™

| æ“ä½œ | æ‰€éœ€æƒé™ | è¯´æ˜ |
|------|----------|------|
| æŸ¥çœ‹è§’è‰² | `role:read` | æŸ¥çœ‹è§’è‰²åˆ—è¡¨å’Œè¯¦æƒ… |
| åˆ›å»ºè§’è‰² | `role:create` | åˆ›å»ºæ–°è§’è‰² |
| ç¼–è¾‘è§’è‰² | `role:update` | ä¿®æ”¹è§’è‰²ä¿¡æ¯ |
| åˆ é™¤è§’è‰² | `role:delete` | åˆ é™¤è§’è‰² |
| åˆ†é…è§’è‰² | `role:assign` | ç»™ç”¨æˆ·åˆ†é…è§’è‰² |
| ç®¡ç†æƒé™ | `role:permission` | ç®¡ç†è§’è‰²æƒé™ |

### è§’è‰²ç­‰çº§è¯´æ˜

| ç­‰çº§ | è§’è‰²ç±»å‹ | æƒé™èŒƒå›´ | è¯´æ˜ |
|------|----------|----------|------|
| 1 | éƒ¨é—¨ç®¡ç†å‘˜ | æœ¬éƒ¨é—¨ | åªèƒ½ç®¡ç†æœ¬éƒ¨é—¨ç”¨æˆ·å’ŒæŸ¥çœ‹ç»Ÿè®¡æ•°æ® |
| 2 | åŠŸèƒ½ç®¡ç†å‘˜ | æŒ‡å®šåŠŸèƒ½ | å¯ä»¥ç®¡ç†æŒ‡å®šåŠŸèƒ½æ¨¡å— |
| 3 | ç³»ç»Ÿç®¡ç†å‘˜ | å…¨ç³»ç»Ÿ | æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™ç»§æ‰¿**: é«˜çº§åˆ«è§’è‰²è‡ªåŠ¨æ‹¥æœ‰ä½çº§åˆ«è§’è‰²çš„æƒé™
2. **è§’è‰²åˆ é™¤**: åˆ é™¤è§’è‰²å‰éœ€è¦ç¡®ä¿æ²¡æœ‰ç”¨æˆ·ä½¿ç”¨è¯¥è§’è‰²
3. **æƒé™å†²çª**: åŒä¸€ç”¨æˆ·ä¸èƒ½åŒæ—¶æ‹¥æœ‰å†²çªçš„è§’è‰²
4. **ç³»ç»Ÿè§’è‰²**: ç³»ç»Ÿå†…ç½®è§’è‰²ï¼ˆå¦‚ç³»ç»Ÿç®¡ç†å‘˜ï¼‰ä¸èƒ½åˆ é™¤
5. **æƒé™éªŒè¯**: æ‰€æœ‰æƒé™æ“ä½œéƒ½ä¼šè¿›è¡Œä¸¥æ ¼éªŒè¯
6. **æ“ä½œæ—¥å¿—**: æ‰€æœ‰è§’è‰²æ“ä½œéƒ½ä¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºå®¡è®¡
7. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡åˆ†é…è§’è‰²æ“ä½œæœ‰æ•°é‡é™åˆ¶ï¼Œé¿å…ä¸€æ¬¡æ€§å¤„ç†è¿‡å¤šæ•°æ®
8. **æƒé™ç¼“å­˜**: è§’è‰²æƒé™å˜æ›´åï¼Œç›¸å…³ç”¨æˆ·çš„æƒé™ç¼“å­˜ä¼šè‡ªåŠ¨æ›´æ–°
