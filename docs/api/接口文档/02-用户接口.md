# ç”¨æˆ·æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

ç”¨æˆ·æ¥å£æä¾›ç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€æƒé™æ§åˆ¶ã€ä¸ªäººèµ„æ–™æ›´æ–°ç­‰åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/user`

**è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦æœ‰æ•ˆçš„JWT Token

## ğŸ” æ¥å£åˆ—è¡¨

### 1. è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®

**æ¥å£åœ°å€**: `GET /api/user/stats`

**æ¥å£æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„ç»Ÿè®¡æ•°æ®

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "totalOrders": 25,        // æ€»æŠ¥é¤æ¬¡æ•°
    "thisMonthOrders": 8,     // æœ¬æœˆæŠ¥é¤æ¬¡æ•°
    "totalReservations": 12,  // æ€»é¢„çº¦æ¬¡æ•°
    "thisMonthReservations": 3, // æœ¬æœˆé¢„çº¦æ¬¡æ•°
    "lastOrderDate": "2024-01-15", // æœ€åæŠ¥é¤æ—¥æœŸ
    "lastReservationDate": "2024-01-10" // æœ€åé¢„çº¦æ—¥æœŸ
  }
}
```

---

### 2. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ¥å£åœ°å€**: `GET /api/user/info`

**æ¥å£æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "_id": "user_id",
    "nickName": "å¼ ä¸‰",
    "realName": "å¼ ä¸‰",
    "avatarUrl": "https://example.com/avatar.jpg",
    "phoneNumber": "13800138000",
    "email": "zhangsan@example.com",
    "gender": 1,
    "department": "æŠ€æœ¯éƒ¨",
    "departmentId": "dept_id",
    "position": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
    "employeeId": "EMP001",
    "joinDate": "2023-01-01",
    "role": "user",
    "status": "active",
    "createTime": "2023-01-01T00:00:00.000Z",
    "lastLoginTime": "2024-01-15T10:30:00.000Z",
    "loginCount": 156
  }
}
```

---

### 3. æ›´æ–°ç”¨æˆ·å¤´åƒ

**æ¥å£åœ°å€**: `PUT /api/user/avatar`

**æ¥å£æè¿°**: æ›´æ–°å½“å‰ç”¨æˆ·çš„å¤´åƒ

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°**:
```form-data
avatar: File  // å¤´åƒæ–‡ä»¶ï¼Œæ”¯æŒjpg/pngæ ¼å¼ï¼Œæœ€å¤§2MB
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "å¤´åƒæ›´æ–°æˆåŠŸ",
  "data": {
    "avatarUrl": "https://example.com/new-avatar.jpg",
    "updateTime": "2024-01-15T15:30:00.000Z"
  }
}
```

---

### 4. æ›´æ–°ç”¨æˆ·èµ„æ–™

**æ¥å£åœ°å€**: `PUT /api/user/profile`

**æ¥å£æè¿°**: æ›´æ–°å½“å‰ç”¨æˆ·çš„ä¸ªäººèµ„æ–™

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "nickName": "string",      // æ˜µç§°ï¼ˆå¯é€‰ï¼‰
  "realName": "string",      // çœŸå®å§“åï¼ˆå¯é€‰ï¼‰
  "email": "string",         // é‚®ç®±ï¼ˆå¯é€‰ï¼‰
  "gender": 1,               // æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ï¼ˆå¯é€‰ï¼‰
  "position": "string"       // èŒä½ï¼ˆå¯é€‰ï¼‰
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·èµ„æ–™æ›´æ–°æˆåŠŸ",
  "data": {
    "updateTime": "2024-01-15T15:30:00.000Z",
    "updatedFields": ["nickName", "email"]
  }
}
```

---

## ğŸ‘¥ ç®¡ç†å‘˜åŠŸèƒ½æ¥å£

### 5. è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Šæƒé™ï¼‰

**æ¥å£åœ°å€**: `GET /api/user/list`

**æ¥å£æè¿°**: è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**æŸ¥è¯¢å‚æ•°**:
```
page: number          // é¡µç ï¼Œé»˜è®¤1
size: number          // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
departmentId: string  // éƒ¨é—¨IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
role: string          // è§’è‰²ç­›é€‰ï¼ˆå¯é€‰ï¼‰
status: string        // çŠ¶æ€ç­›é€‰ï¼ˆå¯é€‰ï¼‰
keyword: string       // å…³é”®è¯æœç´¢ï¼ˆå§“å/æ‰‹æœºå·/é‚®ç®±ï¼‰
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "list": [
      {
        "_id": "user_id_1",
        "nickName": "å¼ ä¸‰",
        "realName": "å¼ ä¸‰",
        "phoneNumber": "13800138000",
        "email": "zhangsan@example.com",
        "department": "æŠ€æœ¯éƒ¨",
        "position": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
        "role": "user",
        "status": "active",
        "createTime": "2023-01-01T00:00:00.000Z",
        "lastLoginTime": "2024-01-15T10:30:00.000Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 45,
      "totalPages": 3
    }
  }
}
```

---

### 6. è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯ï¼ˆéƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Šæƒé™ï¼‰

**æ¥å£åœ°å€**: `GET /api/user/:userId`

**æ¥å£æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**è·¯å¾„å‚æ•°**:
```
userId: string  // ç”¨æˆ·ID
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "_id": "user_id",
    "nickName": "å¼ ä¸‰",
    "realName": "å¼ ä¸‰",
    "avatarUrl": "https://example.com/avatar.jpg",
    "phoneNumber": "13800138000",
    "email": "zhangsan@example.com",
    "gender": 1,
    "country": "ä¸­å›½",
    "province": "å¹¿ä¸œçœ",
    "city": "æ·±åœ³å¸‚",
    "department": "æŠ€æœ¯éƒ¨",
    "departmentId": "dept_id",
    "position": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
    "employeeId": "EMP001",
    "joinDate": "2023-01-01",
    "role": "user",
    "status": "active",
    "remark": "ä¼˜ç§€å‘˜å·¥",
    "createTime": "2023-01-01T00:00:00.000Z",
    "updateTime": "2024-01-15T15:30:00.000Z",
    "lastLoginTime": "2024-01-15T10:30:00.000Z",
    "loginCount": 156,
    "createBy": "admin_id",
    "updateBy": "admin_id"
  }
}
```

---

### 7. æ›´æ–°ç”¨æˆ·çŠ¶æ€ï¼ˆéƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Šæƒé™ï¼‰

**æ¥å£åœ°å€**: `PUT /api/user/:userId/status`

**æ¥å£æè¿°**: æ›´æ–°æŒ‡å®šç”¨æˆ·çš„çŠ¶æ€

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:
```
userId: string  // ç”¨æˆ·ID
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "status": "string"  // æ–°çŠ¶æ€ï¼šactive/inactive
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "userId": "user_id",
    "oldStatus": "active",
    "newStatus": "inactive",
    "updateTime": "2024-01-15T15:30:00.000Z",
    "updateBy": "admin_id"
  }
}
```

---

### 8. æ‰¹é‡æ›´æ–°ç”¨æˆ·çŠ¶æ€ï¼ˆéƒ¨é—¨ç®¡ç†å‘˜åŠä»¥ä¸Šæƒé™ï¼‰

**æ¥å£åœ°å€**: `PUT /api/user/batch/status`

**æ¥å£æè¿°**: æ‰¹é‡æ›´æ–°å¤šä¸ªç”¨æˆ·çš„çŠ¶æ€

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "userIds": ["user_id_1", "user_id_2", "user_id_3"],  // ç”¨æˆ·IDæ•°ç»„
  "status": "active"  // æ–°çŠ¶æ€ï¼šactive/inactive
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æ‰¹é‡æ›´æ–°ç”¨æˆ·çŠ¶æ€æˆåŠŸ",
  "data": {
    "updatedCount": 3,
    "failedCount": 0,
    "failedUserIds": [],
    "updateTime": "2024-01-15T15:30:00.000Z",
    "updateBy": "admin_id"
  }
}
```

---

## ğŸ” ç³»ç»Ÿç®¡ç†å‘˜åŠŸèƒ½æ¥å£

### 9. æ›´æ–°ç”¨æˆ·è§’è‰²ï¼ˆç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼‰

**æ¥å£åœ°å€**: `PUT /api/user/:userId/role`

**æ¥å£æè¿°**: æ›´æ–°æŒ‡å®šç”¨æˆ·çš„è§’è‰²

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:
```
userId: string  // ç”¨æˆ·ID
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "role": "string"  // æ–°è§’è‰²ï¼šuser/dept_admin/admin/sys_admin/verifier
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·è§’è‰²æ›´æ–°æˆåŠŸ",
  "data": {
    "userId": "user_id",
    "oldRole": "user",
    "newRole": "dept_admin",
    "updateTime": "2024-01-15T15:30:00.000Z",
    "updateBy": "sys_admin_id"
  }
}
```

---

### 10. é‡ç½®ç”¨æˆ·å¯†ç ï¼ˆç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼‰

**æ¥å£åœ°å€**: `PUT /api/user/:userId/reset-password`

**æ¥å£æè¿°**: é‡ç½®æŒ‡å®šç”¨æˆ·çš„å¯†ç 

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:
```
userId: string  // ç”¨æˆ·ID
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "newPassword": "string"  // æ–°å¯†ç ï¼Œé•¿åº¦6-20ä½
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·å¯†ç é‡ç½®æˆåŠŸ",
  "data": {
    "userId": "user_id",
    "resetTime": "2024-01-15T15:30:00.000Z",
    "resetBy": "sys_admin_id"
  }
}
```

---

### 11. åˆ é™¤ç”¨æˆ·ï¼ˆç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼‰

**æ¥å£åœ°å€**: `DELETE /api/user/:userId`

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**è·¯å¾„å‚æ•°**:
```
userId: string  // ç”¨æˆ·ID
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·åˆ é™¤æˆåŠŸ",
  "data": {
    "userId": "user_id",
    "deleteTime": "2024-01-15T15:30:00.000Z",
    "deleteBy": "sys_admin_id"
  }
}
```

---

## ğŸ“Š ç”¨æˆ·è§’è‰²è¯´æ˜

### è§’è‰²æƒé™ç­‰çº§

| è§’è‰² | æƒé™ç­‰çº§ | åŠŸèƒ½æè¿° |
|------|----------|----------|
| `user` | 1 | æ™®é€šç”¨æˆ·ï¼Œå¯è¿›è¡ŒæŠ¥é¤ã€é¢„çº¦ç­‰åŸºç¡€æ“ä½œ |
| `dept_admin` | 2 | éƒ¨é—¨ç®¡ç†å‘˜ï¼Œå¯ç®¡ç†æœ¬éƒ¨é—¨ç”¨æˆ·å’ŒæŸ¥çœ‹ç»Ÿè®¡æ•°æ® |
| `admin` | 3 | ç®¡ç†å‘˜ï¼Œå¯è¿›è¡Œç³»ç»Ÿç®¡ç†å’Œç”¨æˆ·ç®¡ç† |
| `sys_admin` | 4 | ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬è§’è‰²ç®¡ç† |
| `verifier` | 1 | éªŒè¯å‘˜ï¼Œä¸“é—¨ç”¨äºç”¨é¤éªŒè¯ç­‰æ“ä½œ |

### æƒé™éªŒè¯

```javascript
// æ£€æŸ¥ç”¨æˆ·æƒé™
function checkPermission(userRole, requiredRole) {
  const roleLevels = {
    'user': 1,
    'dept_admin': 2,
    'admin': 3,
    'sys_admin': 4,
    'verifier': 1
  };
  
  return roleLevels[userRole] >= roleLevels[requiredRole];
}
```

## ğŸ“± å‰ç«¯é›†æˆç¤ºä¾‹

### JavaScriptç¤ºä¾‹

```javascript
// è·å–ç”¨æˆ·ä¿¡æ¯
async function getUserInfo() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/user/info', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    throw error;
  }
}

// æ›´æ–°ç”¨æˆ·èµ„æ–™
async function updateUserProfile(profileData) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/user/profile', {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(profileData)
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:', error);
    throw error;
  }
}

// ä¸Šä¼ å¤´åƒ
async function uploadAvatar(file) {
  try {
    const token = localStorage.getItem('token');
    const formData = new FormData();
    formData.append('avatar', file);
    
    const response = await fetch('/api/user/avatar', {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${token}`
      },
      body: formData
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('ä¸Šä¼ å¤´åƒå¤±è´¥:', error);
    throw error;
  }
}

// è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
async function getUserList(params = {}) {
  try {
    const token = localStorage.getItem('token');
    const queryString = new URLSearchParams(params).toString();
    
    const response = await fetch(`/api/user/list?${queryString}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
    throw error;
  }
}
```

### å¾®ä¿¡å°ç¨‹åºç¤ºä¾‹

```javascript
// è·å–ç”¨æˆ·ä¿¡æ¯
async function getUserInfo() {
  try {
    const token = wx.getStorageSync('token');
    const response = await wx.request({
      url: 'https://api.example.com/api/user/info',
      method: 'GET',
      header: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = response.data;
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
    throw error;
  }
}

// æ›´æ–°ç”¨æˆ·èµ„æ–™
async function updateUserProfile(profileData) {
  try {
    const token = wx.getStorageSync('token');
    const response = await wx.request({
      url: 'https://api.example.com/api/user/profile',
      method: 'PUT',
      header: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      data: profileData
    });
    
    const result = response.data;
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:', error);
    throw error;
  }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: ç®¡ç†å‘˜åŠŸèƒ½éœ€è¦ç›¸åº”çš„æƒé™ç­‰çº§ï¼Œå‰ç«¯éœ€è¦æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
2. **æ–‡ä»¶ä¸Šä¼ **: å¤´åƒä¸Šä¼ æ”¯æŒjpg/pngæ ¼å¼ï¼Œæœ€å¤§2MB
3. **çŠ¶æ€ç®¡ç†**: ç”¨æˆ·çŠ¶æ€å˜æ›´ä¼šè®°å½•æ“ä½œæ—¥å¿—ï¼Œä¾¿äºå®¡è®¡
4. **è½¯åˆ é™¤**: åˆ é™¤ç”¨æˆ·é‡‡ç”¨è½¯åˆ é™¤æ–¹å¼ï¼Œæ•°æ®ä¸ä¼šçœŸæ­£ä¸¢å¤±
5. **è§’è‰²å˜æ›´**: è§’è‰²å˜æ›´éœ€è¦è°¨æ…æ“ä½œï¼Œå»ºè®®åœ¨å˜æ›´å‰ç¡®è®¤ç”¨æˆ·ç†è§£æƒé™å˜åŒ–
6. **æ•°æ®éªŒè¯**: æ‰€æœ‰è¾“å…¥æ•°æ®éƒ½ä¼šè¿›è¡ŒéªŒè¯ï¼Œå‰ç«¯ä¹Ÿéœ€è¦è¿›è¡Œç›¸åº”çš„éªŒè¯
7. **é”™è¯¯å¤„ç†**: æ¥å£è¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå‰ç«¯éœ€è¦å¦¥å–„å¤„ç†å„ç§é”™è¯¯æƒ…å†µ
