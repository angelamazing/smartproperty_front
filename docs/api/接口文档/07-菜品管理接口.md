# 菜品管理接口文档

## 📋 接口概述

菜品管理接口提供菜品的增删改查、分类管理、营养模板等功能。

**基础路径**: `/api/admin/dishes`

**认证要求**: 所有接口都需要有效的JWT Token和管理员权限

## 🔐 接口列表

### 1. 获取菜品列表

**接口地址**: `GET /api/admin/dishes`

**接口描述**: 获取菜品列表，支持分页和筛选

**请求头**:
```http
Authorization: Bearer {token}
```

**查询参数**:
```
page: number          // 页码，默认1
size: number          // 每页数量，默认20，最大100
categoryId: string    // 分类ID筛选（可选）
status: string        // 状态筛选：active/disabled（可选）
keyword: string       // 关键词搜索（菜品名称/描述）
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取菜品列表成功",
  "data": {
    "list": [
      {
        "_id": "dish_id_1",
        "name": "宫保鸡丁",
        "description": "经典川菜，口感麻辣鲜香",
        "price": 15.0,
        "categoryId": "cat_id_1",
        "categoryName": "荤菜",
        "image": "https://example.com/dish1.jpg",
        "status": "active",
        "nutritionInfo": {
          "calories": 280,
          "protein": 25.5,
          "fat": 12.3,
          "carbohydrate": 18.7
        },
        "createTime": "2024-01-01T00:00:00.000Z",
        "updateTime": "2024-01-15T10:30:00.000Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 45,
      "totalPages": 3
    }
  }
}
```

---

### 2. 获取菜品详情

**接口地址**: `GET /api/admin/dishes/:dishId`

**接口描述**: 获取指定菜品的详细信息

**请求头**:
```http
Authorization: Bearer {token}
```

**路径参数**:
```
dishId: string  // 菜品ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取菜品详情成功",
  "data": {
    "_id": "dish_id_1",
    "name": "宫保鸡丁",
    "description": "经典川菜，口感麻辣鲜香",
    "price": 15.0,
    "categoryId": "cat_id_1",
    "categoryName": "荤菜",
    "image": "https://example.com/dish1.jpg",
    "status": "active",
    "nutritionInfo": {
      "calories": 280,
      "protein": 25.5,
      "fat": 12.3,
      "carbohydrate": 18.7
    },
    "ingredients": ["鸡肉", "花生", "黄瓜", "辣椒"],
    "cookingMethod": "炒制",
    "spiceLevel": "medium",
    "preparationTime": "15分钟",
    "createTime": "2024-01-01T00:00:00.000Z",
    "updateTime": "2024-01-15T10:30:00.000Z"
  }
}
```

---

### 3. 创建菜品

**接口地址**: `POST /api/admin/dishes`

**接口描述**: 创建新菜品

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**:
```json
{
  "name": "麻婆豆腐",
  "description": "经典川菜，麻辣鲜香",
  "price": 12.0,
  "categoryId": "cat_id_2",
  "image": "https://example.com/dish2.jpg",
  "nutritionInfo": {
    "calories": 180,
    "protein": 15.2,
    "fat": 8.5,
    "carbohydrate": 12.8
  },
  "ingredients": ["豆腐", "肉末", "辣椒", "花椒"],
  "cookingMethod": "烧制",
  "spiceLevel": "high",
  "preparationTime": "20分钟"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "菜品创建成功",
  "data": {
    "dishId": "dish_id_2",
    "name": "麻婆豆腐",
    "createTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 4. 更新菜品信息

**接口地址**: `PUT /api/admin/dishes/:dishId`

**接口描述**: 更新菜品信息

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**路径参数**:
```
dishId: string  // 菜品ID
```

**请求参数**:
```json
{
  "name": "麻婆豆腐（升级版）",
  "description": "经典川菜，麻辣鲜香，口感更佳",
  "price": 13.0,
  "categoryId": "cat_id_2",
  "nutritionInfo": {
    "calories": 190,
    "protein": 16.0,
    "fat": 9.0,
    "carbohydrate": 13.5
  }
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "菜品信息更新成功",
  "data": {
    "dishId": "dish_id_2",
    "updateTime": "2024-01-15T16:30:00.000Z",
    "updatedFields": ["name", "description", "price", "nutritionInfo"]
  }
}
```

---

### 5. 更新菜品状态

**接口地址**: `PUT /api/admin/dishes/:dishId/status`

**接口描述**: 启用或禁用菜品

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**路径参数**:
```
dishId: string  // 菜品ID
```

**请求参数**:
```json
{
  "status": "disabled"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "菜品状态更新成功",
  "data": {
    "dishId": "dish_id_2",
    "oldStatus": "active",
    "newStatus": "disabled",
    "updateTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 6. 删除菜品

**接口地址**: `DELETE /api/admin/dishes/:dishId`

**接口描述**: 删除菜品（软删除）

**请求头**:
```http
Authorization: Bearer {token}
```

**路径参数**:
```
dishId: string  // 菜品ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "菜品删除成功",
  "data": {
    "dishId": "dish_id_2",
    "deleteTime": "2024-01-15T16:30:00.000Z",
    "deletedBy": "admin_id"
  }
}
```

---

### 7. 批量删除菜品

**接口地址**: `POST /api/admin/dishes/batch-delete`

**接口描述**: 批量删除菜品

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**:
```json
{
  "dishIds": ["dish_id_1", "dish_id_2", "dish_id_3"]
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "批量删除成功",
  "data": {
    "deletedCount": 3,
    "deletedDishes": ["dish_id_1", "dish_id_2", "dish_id_3"],
    "deleteTime": "2024-01-15T16:30:00.000Z",
    "deletedBy": "admin_id"
  }
}
```

---

### 8. 上传菜品图片

**接口地址**: `POST /api/admin/dishes/upload-image`

**接口描述**: 上传菜品图片

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**请求参数**:
```
imageFile: File  // 图片文件
dishId: string   // 菜品ID（可选，用于更新现有菜品图片）
```

**响应示例**:
```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "imageUrl": "https://example.com/uploads/dish_image_123.jpg",
    "imageId": "img_id_123",
    "uploadTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

## 🏷️ 菜品分类管理

### 9. 获取菜品分类

**接口地址**: `GET /api/admin/dishes/categories`

**接口描述**: 获取菜品分类列表

**请求头**:
```http
Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取分类列表成功",
  "data": [
    {
      "_id": "cat_id_1",
      "name": "荤菜",
      "code": "MEAT",
      "description": "肉类菜品",
      "sort": 1,
      "status": "active",
      "dishCount": 25,
      "createTime": "2024-01-01T00:00:00.000Z"
    },
    {
      "_id": "cat_id_2",
      "name": "素菜",
      "code": "VEGETABLE",
      "description": "蔬菜菜品",
      "sort": 2,
      "status": "active",
      "dishCount": 18,
      "createTime": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

---

### 10. 创建菜品分类

**接口地址**: `POST /api/admin/dishes/categories`

**接口描述**: 创建新菜品分类

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**:
```json
{
  "name": "汤类",
  "code": "SOUP",
  "description": "各种汤品",
  "sort": 3
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "分类创建成功",
  "data": {
    "categoryId": "cat_id_3",
    "name": "汤类",
    "createTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 11. 更新菜品分类

**接口地址**: `PUT /api/admin/dishes/categories/:categoryId`

**接口描述**: 更新菜品分类信息

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**路径参数**:
```
categoryId: string  // 分类ID
```

**请求参数**:
```json
{
  "name": "汤品",
  "description": "各种营养汤品"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "分类更新成功",
  "data": {
    "categoryId": "cat_id_3",
    "updateTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 12. 更新分类状态

**接口地址**: `PUT /api/admin/dishes/categories/:categoryId/status`

**接口描述**: 启用或禁用菜品分类

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**路径参数**:
```
categoryId: string  // 分类ID
```

**请求参数**:
```json
{
  "status": "disabled"
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "分类状态更新成功",
  "data": {
    "categoryId": "cat_id_3",
    "oldStatus": "active",
    "newStatus": "disabled",
    "updateTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 13. 删除菜品分类

**接口地址**: `DELETE /api/admin/dishes/categories/:categoryId`

**接口描述**: 删除菜品分类（软删除）

**请求头**:
```http
Authorization: Bearer {token}
```

**路径参数**:
```
categoryId: string  // 分类ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "分类删除成功",
  "data": {
    "categoryId": "cat_id_3",
    "deleteTime": "2024-01-15T16:30:00.000Z",
    "deletedBy": "admin_id"
  }
}
```

---

## 🥗 营养模板管理

### 14. 获取营养模板

**接口地址**: `GET /api/admin/dishes/nutrition-templates`

**接口描述**: 获取营养模板列表

**请求头**:
```http
Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取营养模板成功",
  "data": [
    {
      "_id": "template_id_1",
      "name": "标准营养餐",
      "description": "符合成年人日常营养需求的餐食",
      "nutritionTargets": {
        "calories": 800,
        "protein": 45,
        "fat": 25,
        "carbohydrate": 80
      },
      "usageCount": 156,
      "createTime": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

---

### 15. 创建营养模板

**接口地址**: `POST /api/admin/dishes/nutrition-templates`

**接口描述**: 创建新营养模板

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**:
```json
{
  "name": "低脂健康餐",
  "description": "适合减脂人群的营养餐食",
  "nutritionTargets": {
    "calories": 600,
    "protein": 50,
    "fat": 15,
    "carbohydrate": 60
  }
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "营养模板创建成功",
  "data": {
    "templateId": "template_id_2",
    "name": "低脂健康餐",
    "createTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 16. 更新营养模板

**接口地址**: `PUT /api/admin/dishes/nutrition-templates/:templateId`

**接口描述**: 更新营养模板信息

**请求头**:
```http
Authorization: Bearer {token}
Content-Type: application/json
```

**路径参数**:
```
templateId: string  // 模板ID
```

**请求参数**:
```json
{
  "name": "低脂健康餐（升级版）",
  "description": "适合减脂人群的营养餐食，营养更均衡",
  "nutritionTargets": {
    "calories": 650,
    "protein": 55,
    "fat": 18,
    "carbohydrate": 65
  }
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "营养模板更新成功",
  "data": {
    "templateId": "template_id_2",
    "updateTime": "2024-01-15T16:30:00.000Z"
  }
}
```

---

### 17. 删除营养模板

**接口地址**: `DELETE /api/admin/dishes/nutrition-templates/:templateId`

**接口描述**: 删除营养模板

**请求头**:
```http
Authorization: Bearer {token}
```

**路径参数**:
```
templateId: string  // 模板ID
```

**响应示例**:
```json
{
  "success": true,
  "message": "营养模板删除成功",
  "data": {
    "templateId": "template_id_2",
    "deleteTime": "2024-01-15T16:30:00.000Z",
    "deletedBy": "admin_id"
  }
}
```

---

## 📱 前端集成示例

### JavaScript示例

```javascript
// 获取菜品列表
async function getDishesList(params = {}) {
  try {
    const token = localStorage.getItem('token');
    const queryString = new URLSearchParams(params).toString();
    
    const response = await fetch(`/api/admin/dishes?${queryString}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('获取菜品列表失败:', error);
    throw error;
  }
}

// 创建菜品
async function createDish(dishData) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/admin/dishes', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(dishData)
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('创建菜品失败:', error);
    throw error;
  }
}

// 更新菜品
async function updateDish(dishId, dishData) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/admin/dishes/${dishId}`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(dishData)
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('更新菜品失败:', error);
    throw error;
  }
}

// 删除菜品
async function deleteDish(dishId) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/admin/dishes/${dishId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('删除菜品失败:', error);
    throw error;
  }
}
```

## 🔒 权限说明

### 菜品管理权限

| 操作 | 所需权限 | 说明 |
|------|----------|------|
| 查看菜品 | `dish:read` | 查看菜品列表和详情 |
| 创建菜品 | `dish:create` | 创建新菜品 |
| 编辑菜品 | `dish:update` | 修改菜品信息 |
| 删除菜品 | `dish:delete` | 删除菜品 |
| 管理分类 | `dish:category` | 管理菜品分类 |
| 管理模板 | `dish:template` | 管理营养模板 |

## ⚠️ 注意事项

1. **图片上传**: 菜品图片上传支持JPG、PNG格式，文件大小不超过5MB
2. **分类管理**: 删除分类前需要确保该分类下没有菜品
3. **营养信息**: 营养信息为每100g的含量，前端需要根据实际份量计算
4. **状态管理**: 禁用的菜品不会在用户端显示，但仍保留在系统中
5. **批量操作**: 批量删除操作不可恢复，需要二次确认
6. **数据验证**: 所有输入数据都会进行严格验证，包括价格、营养值等
7. **权限控制**: 不同权限等级的管理员可以操作不同范围的菜品
8. **操作日志**: 所有菜品操作都会记录详细日志，便于审计
