# 部门报餐概览接口说明

## 接口地址
```
GET /api/dining/enhanced/department-overview
```

## 功能描述
获取部门今日报餐概览，包括所有成员的报餐状态和详细报餐信息。

## 请求头
```http
Authorization: Bearer <your-token>
Content-Type: application/json
```

## 响应数据结构

### 成功响应示例
```json
{
    "success": true,
    "message": "获取部门报餐概览成功",
    "code": "200",
    "timestamp": "2025-09-03T01:43:33.769Z",
    "data": {
        "date": "2025-09-03",
        "departmentName": "地质数据中心",
        "totalMembers": 6,
        "todayStats": {
            "totalOrders": 4,
            "uniqueUsers": 3,
            "participationRate": 50,
            "mealTypeStats": {
                "breakfast": "0",
                "lunch": "4",
                "dinner": "2"
            }
        },
        "members": [
            {
                "_id": "c8b1cbc0-49aa-432a-bfed-b7792db4e4d0",
                "nickName": "地质数据中心管理员",
                "name": "地质数据中心管理员",
                "role": "部门管理员",
                "avatarUrl": "",
                "phoneNumber": "13800001001",
                "email": "zhangdata@example.com",
                "status": "active",
                "isDepartmentAdmin": true,
                "hasOrdered": true,
                "orderInfo": [
                    {
                        "mealType": "dinner",
                        "orderTime": "2025-09-02T17:39:33.000Z",
                        "status": "confirmed"
                    },
                    {
                        "mealType": "lunch",
                        "orderTime": "2025-09-02T16:40:13.000Z",
                        "status": "confirmed"
                    }
                ],
                "singleOrderInfo": {
                    "mealType": "dinner",
                    "orderTime": "2025-09-02T17:39:33.000Z",
                    "status": "confirmed"
                }
            }
        ]
    }
}
```

## 字段说明

### 基础信息
- `date`: 查询日期 (YYYY-MM-DD)
- `departmentName`: 部门名称
- `totalMembers`: 部门总成员数

### 今日报餐统计 (todayStats)
- `totalOrders`: 总报餐记录数
- `uniqueUsers`: 唯一报餐用户数
- `participationRate`: 参与率 (百分比)
- `mealTypeStats`: 各餐次统计
  - `breakfast`: 早餐报餐数
  - `lunch`: 中餐报餐数
  - `dinner`: 晚餐报餐数

### 成员报餐状态 (members)
每个成员对象包含以下字段：

#### 基本信息
- `_id`: 成员ID
- `nickName`: 成员姓名 (主要字段)
- `name`: 成员姓名 (兼容字段)
- `role`: 角色显示名称
- `avatarUrl`: 头像URL
- `phoneNumber`: 手机号
- `email`: 邮箱
- `status`: 用户状态
- `isDepartmentAdmin`: 是否为部门管理员

#### 报餐信息
- `hasOrdered`: 是否已报餐 (boolean)
- `orderInfo`: 所有报餐信息数组 (新增)
  - 如果未报餐: `null`
  - 如果已报餐: 包含所有报餐记录的数组
    - `mealType`: 餐次类型 (breakfast/lunch/dinner)
    - `orderTime`: 报餐时间
    - `status`: 报餐状态
- `singleOrderInfo`: 单个报餐信息 (向后兼容)
  - 如果未报餐: `null`
  - 如果已报餐: 包含最后一次报餐的信息

## 重要更新

### v2.0 更新内容
1. **多餐次支持**: `orderInfo` 字段现在返回数组，包含成员当天的所有报餐记录
2. **向后兼容**: 保留 `singleOrderInfo` 字段，包含最后一次报餐信息
3. **数据一致性**: 修复了统计数据计算错误，确保数据完全一致

### 前端集成建议

#### 新版本 (推荐)
```javascript
// 显示所有报餐信息
member.orderInfo.forEach((order, index) => {
    console.log(`报餐 ${index + 1}: ${order.mealType} - ${order.status}`);
});
```

#### 兼容版本
```javascript
// 显示最后一次报餐信息
if (member.singleOrderInfo) {
    console.log(`报餐: ${member.singleOrderInfo.mealType} - ${member.singleOrderInfo.status}`);
}
```

## 错误响应
```json
{
    "success": false,
    "message": "错误信息",
    "code": "400",
    "timestamp": "2025-09-03T01:43:33.769Z"
}
```

## 注意事项
1. 所有时间字段使用 ISO 8601 格式
2. 餐次类型: breakfast(早餐), lunch(中餐), dinner(晚餐)
3. 报餐状态: confirmed(已确认), pending(待确认), cancelled(已取消)
4. 数据完全一致，无需频繁刷新
