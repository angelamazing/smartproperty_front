# ç³»ç»Ÿæ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

ç³»ç»Ÿæ¥å£æä¾›ç»Ÿè®¡æ•°æ®ã€èœå•ä¿¡æ¯ã€ç³»ç»Ÿå…¬å‘Šã€æœ€è¿‘æ´»åŠ¨ç­‰ç³»ç»Ÿçº§åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/system`

**è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦æœ‰æ•ˆçš„JWT Token

## ğŸ” æ¥å£åˆ—è¡¨

### 1. è·å–ä»Šæ—¥ç»Ÿè®¡

**æ¥å£åœ°å€**: `GET /api/system/today-stats`

**æ¥å£æè¿°**: è·å–ä»Šæ—¥ç³»ç»Ÿçš„ç»Ÿè®¡æ•°æ®

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ä»Šæ—¥ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "diningCount": 156,        // ä»Šæ—¥æŠ¥é¤æ¬¡æ•°
    "reservationCount": 23,    // ä»Šæ—¥é¢„çº¦æ¬¡æ•°
    "verificationCount": 89,   // ä»Šæ—¥éªŒè¯æ¬¡æ•°
    "menuCount": 3,            // ä»Šæ—¥èœå•æ•°é‡
    "date": "2024-01-15"      // ç»Ÿè®¡æ—¥æœŸ
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "message": "è·å–ä»Šæ—¥ç»Ÿè®¡å¤±è´¥",
  "error": "æ•°æ®åº“è¿æ¥å¤±è´¥"
}
```

---

### 2. è·å–ä»Šæ—¥èœå•

**æ¥å£åœ°å€**: `GET /api/system/today-menu`

**æ¥å£æè¿°**: è·å–ä»Šæ—¥å‘å¸ƒçš„èœå•ä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ä»Šæ—¥èœå•æˆåŠŸ",
  "data": {
    "message": "ä»Šæ—¥èœå•",
    "menus": [
      {
        "_id": "menu_id_1",
        "mealType": "breakfast",
        "mealTime": "07:00-09:00",
        "publishDate": "2024-01-15",
        "dishes": [
          {
            "name": "åŒ…å­",
            "price": 2.5
          },
          {
            "name": "è±†æµ†",
            "price": 3.0
          },
          {
            "name": "æ²¹æ¡",
            "price": 1.5
          }
        ],
        "capacity": 200,
        "currentOrders": 156,
        "publishStatus": "published"
      },
      {
        "_id": "menu_id_2",
        "mealType": "lunch",
        "mealTime": "11:30-13:00",
        "publishDate": "2024-01-15",
        "dishes": [
          {
            "name": "å®«ä¿é¸¡ä¸",
            "price": 15.0
          },
          {
            "name": "éº»å©†è±†è…",
            "price": 12.0
          },
          {
            "name": "é’èœæ±¤",
            "price": 8.0
          }
        ],
        "capacity": 300,
        "currentOrders": 245,
        "publishStatus": "published"
      },
      {
        "_id": "menu_id_3",
        "mealType": "dinner",
        "mealTime": "17:30-19:00",
        "publishDate": "2024-01-15",
        "dishes": [
          {
            "name": "çº¢çƒ§è‚‰",
            "price": 18.0
          },
          {
            "name": "æ¸…è’¸é±¼",
            "price": 22.0
          },
          {
            "name": "è’œè“‰é’èœ",
            "price": 10.0
          }
        ],
        "capacity": 250,
        "currentOrders": 189,
        "publishStatus": "published"
      }
    ]
  }
}
```

**æ— èœå•æ—¶çš„å“åº”**:
```json
{
  "success": true,
  "message": "è·å–ä»Šæ—¥èœå•æˆåŠŸ",
  "data": {
    "message": "ä»Šæ—¥æš‚æ— èœå•",
    "menus": []
  }
}
```

---

### 3. è·å–æœ€è¿‘æ´»åŠ¨

**æ¥å£åœ°å€**: `GET /api/system/recent-activities`

**æ¥å£æè¿°**: è·å–ç³»ç»Ÿæœ€è¿‘çš„æŠ¥é¤å’Œé¢„çº¦æ´»åŠ¨ï¼ˆéœ€è¦éƒ¨é—¨ç®¡ç†å‘˜æƒé™ï¼‰

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**æŸ¥è¯¢å‚æ•°**:
```
limit: number  // è¿”å›æ´»åŠ¨æ•°é‡ï¼Œé»˜è®¤10ï¼Œæœ€å¤§50
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–æœ€è¿‘æ´»åŠ¨æˆåŠŸ",
  "data": [
    {
      "type": "dining",
      "date": "2024-01-15",
      "mealType": "lunch",
      "userName": "å¼ ä¸‰",
      "status": "confirmed",
      "action": "æŠ¥é¤"
    },
    {
      "type": "reservation",
      "date": "2024-01-15",
      "venueName": "ä¼šè®®å®¤A",
      "userName": "æå››",
      "status": "approved",
      "action": "åœºåœ°é¢„çº¦"
    },
    {
      "type": "dining",
      "date": "2024-01-14",
      "mealType": "dinner",
      "userName": "ç‹äº”",
      "status": "completed",
      "action": "æŠ¥é¤"
    }
  ]
}
```

**æƒé™ä¸è¶³æ—¶çš„å“åº”**:
```json
{
  "success": false,
  "message": "æƒé™ä¸è¶³",
  "error": "éœ€è¦éƒ¨é—¨ç®¡ç†å‘˜æƒé™"
}
```

---

### 4. è·å–ç³»ç»Ÿå…¬å‘Š

**æ¥å£åœ°å€**: `GET /api/system/notice`

**æ¥å£æè¿°**: è·å–æœ€æ–°çš„ç³»ç»Ÿå…¬å‘Šä¿¡æ¯

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–ç³»ç»Ÿå…¬å‘ŠæˆåŠŸ",
  "data": {
    "content": "ç³»ç»Ÿå°†äºä»Šæ™š22:00-24:00è¿›è¡Œç»´æŠ¤å‡çº§ï¼ŒæœŸé—´å¯èƒ½å½±å“éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ï¼Œè¯·æå‰åšå¥½å‡†å¤‡ã€‚",
    "time": "2024-01-15T10:00:00.000Z",
    "type": "warning",
    "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥"
  }
}
```

**æ— å…¬å‘Šæ—¶çš„å“åº”**:
```json
{
  "success": true,
  "message": "è·å–ç³»ç»Ÿå…¬å‘ŠæˆåŠŸ",
  "data": {
    "content": "ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œæš‚æ— é‡è¦å…¬å‘Š",
    "time": "2024-01-15T15:30:00.000Z",
    "type": "info",
    "title": "ç³»ç»Ÿå…¬å‘Š"
  }
}
```

---

## ğŸ“Š æ•°æ®ç»“æ„è¯´æ˜

### é¤æ¬¡ç±»å‹ (mealType)

| å€¼ | è¯´æ˜ | æ—¶é—´èŒƒå›´ |
|----|------|----------|
| `breakfast` | æ—©é¤ | 07:00-09:00 |
| `lunch` | åˆé¤ | 11:30-13:00 |
| `dinner` | æ™šé¤ | 17:30-19:00 |

### æ´»åŠ¨ç±»å‹ (type)

| å€¼ | è¯´æ˜ | æè¿° |
|----|------|------|
| `dining` | æŠ¥é¤æ´»åŠ¨ | ç”¨æˆ·çš„æŠ¥é¤è®°å½• |
| `reservation` | é¢„çº¦æ´»åŠ¨ | ç”¨æˆ·çš„åœºåœ°é¢„çº¦è®°å½• |

### æŠ¥é¤çŠ¶æ€ (status)

| å€¼ | è¯´æ˜ | æè¿° |
|----|------|------|
| `pending` | å¾…ç¡®è®¤ | æŠ¥é¤è®¢å•å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜ç¡®è®¤ |
| `confirmed` | å·²ç¡®è®¤ | æŠ¥é¤è®¢å•å·²ç¡®è®¤ï¼Œå¯ä»¥æ­£å¸¸ç”¨é¤ |
| `completed` | å·²å®Œæˆ | ç”¨é¤å®Œæˆï¼Œè®¢å•ç»“æŸ |
| `cancelled` | å·²å–æ¶ˆ | æŠ¥é¤è®¢å•å·²å–æ¶ˆ |

### é¢„çº¦çŠ¶æ€ (status)

| å€¼ | è¯´æ˜ | æè¿° |
|----|------|------|
| `pending` | å¾…å®¡æ ¸ | é¢„çº¦ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…å®¡æ ¸ |
| `approved` | å·²æ‰¹å‡† | é¢„çº¦ç”³è¯·å·²æ‰¹å‡† |
| `rejected` | å·²æ‹’ç» | é¢„çº¦ç”³è¯·è¢«æ‹’ç» |
| `completed` | å·²å®Œæˆ | é¢„çº¦æ—¶é—´å·²è¿‡ï¼Œé¢„çº¦å®Œæˆ |
| `cancelled` | å·²å–æ¶ˆ | é¢„çº¦è¢«å–æ¶ˆ |

### å…¬å‘Šç±»å‹ (type)

| å€¼ | è¯´æ˜ | æ ·å¼å»ºè®® |
|----|------|----------|
| `info` | ä¿¡æ¯ | è“è‰²ï¼Œæ™®é€šä¿¡æ¯ |
| `warning` | è­¦å‘Š | æ©™è‰²ï¼Œé‡è¦æé†’ |
| `error` | é”™è¯¯ | çº¢è‰²ï¼Œç´§æ€¥é€šçŸ¥ |
| `success` | æˆåŠŸ | ç»¿è‰²ï¼ŒæˆåŠŸæ¶ˆæ¯ |

## ğŸ“± å‰ç«¯é›†æˆç¤ºä¾‹

### JavaScriptç¤ºä¾‹

```javascript
// è·å–ä»Šæ—¥ç»Ÿè®¡
async function getTodayStats() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/system/today-stats', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ä»Šæ—¥ç»Ÿè®¡å¤±è´¥:', error);
    throw error;
  }
}

// è·å–ä»Šæ—¥èœå•
async function getTodayMenu() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/system/today-menu', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ä»Šæ—¥èœå•å¤±è´¥:', error);
    throw error;
  }
}

// è·å–æœ€è¿‘æ´»åŠ¨
async function getRecentActivities(limit = 10) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/system/recent-activities?limit=${limit}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–æœ€è¿‘æ´»åŠ¨å¤±è´¥:', error);
    throw error;
  }
}

// è·å–ç³»ç»Ÿå…¬å‘Š
async function getSystemNotice() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/system/notice', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ç³»ç»Ÿå…¬å‘Šå¤±è´¥:', error);
    throw error;
  }
}
```

### å¾®ä¿¡å°ç¨‹åºç¤ºä¾‹

```javascript
// è·å–ä»Šæ—¥ç»Ÿè®¡
async function getTodayStats() {
  try {
    const token = wx.getStorageSync('token');
    const response = await wx.request({
      url: 'https://api.example.com/api/system/today-stats',
      method: 'GET',
      header: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = response.data;
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ä»Šæ—¥ç»Ÿè®¡å¤±è´¥:', error);
    throw error;
  }
}

// è·å–ä»Šæ—¥èœå•
async function getTodayMenu() {
  try {
    const token = wx.getStorageSync('token');
    const response = await wx.request({
      url: 'https://api.example.com/api/system/today-menu',
      method: 'GET',
      header: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = response.data;
    
    if (result.success) {
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('è·å–ä»Šæ—¥èœå•å¤±è´¥:', error);
    throw error;
  }
}
```

### Reactç»„ä»¶ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';

// ä»Šæ—¥ç»Ÿè®¡ç»„ä»¶
function TodayStats() {
  const [stats, setStats] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchTodayStats();
  }, []);

  const fetchTodayStats = async () => {
    try {
      setLoading(true);
      const data = await getTodayStats();
      setStats(data);
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  if (!stats) return <div>æš‚æ— æ•°æ®</div>;

  return (
    <div className="today-stats">
      <h3>ä»Šæ—¥ç»Ÿè®¡</h3>
      <div className="stats-grid">
        <div className="stat-item">
          <span className="stat-number">{stats.diningCount}</span>
          <span className="stat-label">æŠ¥é¤æ¬¡æ•°</span>
        </div>
        <div className="stat-item">
          <span className="stat-number">{stats.reservationCount}</span>
          <span className="stat-label">é¢„çº¦æ¬¡æ•°</span>
        </div>
        <div className="stat-item">
          <span className="stat-number">{stats.verificationCount}</span>
          <span className="stat-label">éªŒè¯æ¬¡æ•°</span>
        </div>
        <div className="stat-item">
          <span className="stat-number">{stats.menuCount}</span>
          <span className="stat-label">èœå•æ•°é‡</span>
        </div>
      </div>
    </div>
  );
}

// ä»Šæ—¥èœå•ç»„ä»¶
function TodayMenu() {
  const [menu, setMenu] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchTodayMenu();
  }, []);

  const fetchTodayMenu = async () => {
    try {
      setLoading(true);
      const data = await getTodayMenu();
      setMenu(data);
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  if (!menu || menu.menus.length === 0) return <div>ä»Šæ—¥æš‚æ— èœå•</div>;

  return (
    <div className="today-menu">
      <h3>ä»Šæ—¥èœå•</h3>
      {menu.menus.map((meal) => (
        <div key={meal._id} className="meal-section">
          <h4>{getMealTypeName(meal.mealType)} - {meal.mealTime}</h4>
          <div className="dishes-list">
            {meal.dishes.map((dish, index) => (
              <div key={index} className="dish-item">
                <span className="dish-name">{dish.name}</span>
                <span className="dish-price">Â¥{dish.price}</span>
              </div>
            ))}
          </div>
          <div className="meal-info">
            <span>å®¹é‡: {meal.capacity}äºº</span>
            <span>å·²æŠ¥é¤: {meal.currentOrders}äºº</span>
          </div>
        </div>
      ))}
    </div>
  );
}

// è·å–é¤æ¬¡åç§°
function getMealTypeName(mealType) {
  const mealTypeNames = {
    'breakfast': 'æ—©é¤',
    'lunch': 'åˆé¤',
    'dinner': 'æ™šé¤'
  };
  return mealTypeNames[mealType] || mealType;
}
```

## ğŸ”„ æ•°æ®æ›´æ–°ç­–ç•¥

### å®æ—¶æ€§è¦æ±‚

| æ•°æ®ç±»å‹ | æ›´æ–°é¢‘ç‡ | å»ºè®® |
|----------|----------|------|
| ä»Šæ—¥ç»Ÿè®¡ | å®æ—¶ | æ¯æ¬¡æ“ä½œåç«‹å³æ›´æ–° |
| ä»Šæ—¥èœå• | å®æ—¶ | èœå•å‘å¸ƒ/ä¿®æ”¹åç«‹å³æ›´æ–° |
| æœ€è¿‘æ´»åŠ¨ | å®æ—¶ | æ–°æ´»åŠ¨äº§ç”Ÿåç«‹å³æ›´æ–° |
| ç³»ç»Ÿå…¬å‘Š | å®æ—¶ | å…¬å‘Šå‘å¸ƒåç«‹å³æ›´æ–° |

### ç¼“å­˜ç­–ç•¥

```javascript
// ç¼“å­˜é…ç½®
const cacheConfig = {
  todayStats: { ttl: 60000 },      // 1åˆ†é’Ÿ
  todayMenu: { ttl: 300000 },      // 5åˆ†é’Ÿ
  recentActivities: { ttl: 120000 }, // 2åˆ†é’Ÿ
  systemNotice: { ttl: 300000 }    // 5åˆ†é’Ÿ
};

// å¸¦ç¼“å­˜çš„è·å–å‡½æ•°
async function getTodayStatsWithCache() {
  const cacheKey = 'today_stats';
  let cachedData = cache.get(cacheKey);
  
  if (cachedData) {
    return cachedData;
  }
  
  const data = await getTodayStats();
  cache.set(cacheKey, data, cacheConfig.todayStats.ttl);
  return data;
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: æœ€è¿‘æ´»åŠ¨æ¥å£éœ€è¦éƒ¨é—¨ç®¡ç†å‘˜æƒé™ï¼Œå‰ç«¯éœ€è¦æ ¹æ®ç”¨æˆ·è§’è‰²æ§åˆ¶æ˜¾ç¤º
2. **æ•°æ®å®æ—¶æ€§**: ç»Ÿè®¡æ•°æ®ä¼šå®æ—¶æ›´æ–°ï¼Œå»ºè®®åœ¨å…³é”®æ“ä½œååˆ·æ–°æ•°æ®
3. **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¥å£éƒ½æœ‰ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ï¼Œå‰ç«¯éœ€è¦å¦¥å–„å¤„ç†å„ç§é”™è¯¯æƒ…å†µ
4. **ç¼“å­˜ç­–ç•¥**: å»ºè®®å¯¹ä¸å¸¸å˜åŒ–çš„æ•°æ®è¿›è¡Œé€‚å½“ç¼“å­˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
5. **æ•°æ®æ ¼å¼**: æ‰€æœ‰æ—¶é—´å­—æ®µéƒ½ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œå‰ç«¯éœ€è¦æ ¼å¼åŒ–æ˜¾ç¤º
6. **å®¹é‡æ§åˆ¶**: èœå•å®¹é‡ä¿¡æ¯ç”¨äºå‰ç«¯æ˜¾ç¤ºå‰©ä½™å¯æŠ¥é¤äººæ•°
7. **çŠ¶æ€ç®¡ç†**: æ´»åŠ¨çŠ¶æ€ç”¨äºå‰ç«¯æ˜¾ç¤ºä¸åŒçš„çŠ¶æ€æ ‡è¯†å’Œæ“ä½œæŒ‰é’®
