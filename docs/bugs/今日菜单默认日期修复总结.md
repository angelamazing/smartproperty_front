# 今日菜单默认日期修复总结

## 问题描述
用户反馈：第一次进入今日菜单，默认请求没有日期，请默认设置为请求的今日时间。

## 问题分析
经过代码分析，发现以下页面在 `data()` 初始化时存在同样的问题：

1. **用户用餐页面** (`src/pages/dining/dining.vue`)
2. **管理员菜单页面** (`src/pages/admin/menu.vue`) 
3. **菜单编辑页面** (`src/pages/admin/menu-edit.vue`)

这些页面在 `data()` 中尝试调用 `this.formatDate()` 或 `this.formatDateForPicker()` 方法来设置默认日期，但在Vue组件初始化阶段，`this` 上下文还没有完全建立，导致方法调用失败。

## 修复方案
将 `data()` 中的方法调用替换为立即执行函数表达式(IIFE)，直接在初始化时计算今天的日期：

### 修复前
```javascript
data() {
  return {
    selectedDate: this.formatDate(new Date()), // ❌ 错误：this未初始化
    // 或
    selectedDate: this.formatDateForPicker(new Date()), // ❌ 错误：this未初始化
  }
}
```

### 修复后
```javascript
data() {
  return {
    selectedDate: (() => {
      const today = new Date()
      const year = today.getFullYear()
      const month = String(today.getMonth() + 1).padStart(2, '0')
      const day = String(today.getDate()).padStart(2, '0')
      return `${year}-${month}-${day}`
    })(), // ✅ 正确：立即执行函数
  }
}
```

## 修复的文件

### 1. 用户用餐页面 (`src/pages/dining/dining.vue`)
- **修复位置**: `selectedDate` 字段初始化
- **影响**: 确保用户进入用餐页面时，今日菜单标签页默认显示今天的日期

### 2. 管理员菜单页面 (`src/pages/admin/menu.vue`)
- **修复位置**: 
  - `selectedDate` 字段初始化
  - `menuForm.date` 字段初始化
- **影响**: 确保管理员进入菜单管理页面时，默认显示今天的日期

### 3. 菜单编辑页面 (`src/pages/admin/menu-edit.vue`)
- **修复位置**: `menuForm.date` 字段初始化
- **影响**: 确保创建新菜单时，默认选择今天的日期

## 首页今日菜单
首页的今日菜单功能使用 `api.system.getTodayMenu()` 方法，该方法内部已经正确处理了日期逻辑，无需修改。

## 修复效果
修复后，所有包含今日菜单功能的页面在第一次进入时都会：
1. 自动设置默认日期为今天
2. 正确请求今日的菜单数据
3. 避免因日期为空导致的请求失败

## 技术说明
使用立即执行函数表达式(IIFE)的优势：
- 在 `data()` 初始化时立即执行
- 不依赖 `this` 上下文
- 代码简洁且易于理解
- 性能良好，只在组件初始化时执行一次

## 测试建议
1. 清除浏览器缓存后重新进入各个菜单页面
2. 验证默认日期是否正确显示为今天
3. 确认菜单数据能正常加载
4. 测试日期切换功能是否正常工作
