# 生产模式启动指南

## 🎯 概述

本指南将帮助您了解如何在生产模式下启动和部署uni-app项目。

## 📋 项目信息

### 项目类型
- **框架**: uni-app (Vue 3)
- **构建工具**: Vite
- **包管理器**: npm/yarn

### 支持平台
- H5 (Web)
- 微信小程序
- 支付宝小程序
- APP (Android/iOS)

## 🚀 生产模式启动方法

### 1. **H5生产模式**

#### 构建生产版本
```bash
# 构建H5生产版本
npm run build:h5

# 或者使用yarn
yarn build:h5
```

#### 启动生产服务器
```bash
# 安装serve全局包（如果未安装）
npm install -g serve

# 启动生产服务器
serve -s dist/build/h5

# 指定端口启动
serve -s dist/build/h5 -l 3000

# 指定主机和端口
serve -s dist/build/h5 -l 0.0.0.0:3000
```

#### 使用其他静态服务器
```bash
# 使用http-server
npx http-server dist/build/h5 -p 3000

# 使用live-server
npx live-server dist/build/h5 --port=3000

# 使用nginx (需要配置nginx.conf)
# 将dist/build/h5目录部署到nginx的html目录
```

### 2. **微信小程序生产模式**

#### 构建小程序
```bash
# 构建微信小程序
npm run build:mp-weixin

# 或者使用yarn
yarn build:mp-weixin
```

#### 上传到微信开发者工具
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `dist/build/mp-weixin` 目录
4. 填写AppID和项目名称
5. 点击"导入"
6. 在开发者工具中点击"上传"按钮
7. 填写版本号和项目备注
8. 点击"上传"

### 3. **APP生产模式**

#### 构建APP
```bash
# 构建APP (需要HBuilderX)
# 在HBuilderX中打开项目
# 选择"发行" -> "原生App-云打包"
```

#### 云打包步骤
1. 在HBuilderX中打开项目
2. 选择"发行" -> "原生App-云打包"
3. 选择平台（Android/iOS）
4. 配置证书和签名
5. 点击"打包"
6. 等待打包完成
7. 下载安装包

## 🔧 环境配置

### 1. **API地址配置**

当前API配置在 `src/utils/api.js` 中：

```javascript
const API_CONFIG = {
  // 生产环境地址
  PROD_BASE_URL: 'https://uauotggfeiao.sealosbja.site',
  // 开发环境地址
  DEV_BASE_URL: 'http://localhost:3000',
  // 请求超时时间
  TIMEOUT: 10000
}
```

### 2. **环境判断逻辑**

```javascript
function getBaseUrl() {
  // 方法1：通过 uni-app 的条件编译判断
  // #ifdef APP-PLUS || H5
  //   return API_CONFIG.DEV_BASE_URL // 开发时使用本地服务器
  // #endif
  // #ifdef MP-WEIXIN || MP-ALIPAY
  //   return API_CONFIG.PROD_BASE_URL // 小程序使用生产环境
  // #endif

  // 方法2：通过环境变量判断（推荐）
  if (process.env.NODE_ENV === 'development') {
    return API_CONFIG.DEV_BASE_URL
  } else {
    return API_CONFIG.PROD_BASE_URL
  }
}
```

## 📱 平台特定配置

### 1. **H5平台**

#### 部署到服务器
```bash
# 1. 构建生产版本
npm run build:h5

# 2. 将dist/build/h5目录上传到服务器
# 3. 配置nginx或apache服务器
# 4. 确保HTTPS配置正确
```

#### Nginx配置示例
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/dist/build/h5;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # API代理（如果需要）
    location /api/ {
        proxy_pass https://uauotggfeiao.sealosbja.site/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 2. **微信小程序平台**

#### 小程序配置
```json
// manifest.json
{
  "mp-weixin": {
    "appid": "your-appid",
    "setting": {
      "urlCheck": false,
      "es6": true,
      "enhance": true,
      "postcss": true,
      "minified": true
    },
    "usingComponents": true
  }
}
```

#### 域名配置
- 在微信公众平台配置服务器域名
- 添加 `https://uauotggfeiao.sealosbja.site` 到request合法域名

### 3. **APP平台**

#### APP配置
```json
// manifest.json
{
  "app-plus": {
    "usingComponents": true,
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    }
  }
}
```

## 🛠️ 构建优化

### 1. **代码压缩**

生产模式会自动启用：
- JavaScript代码压缩
- CSS代码压缩
- 图片压缩
- 资源合并

### 2. **性能优化**

```javascript
// vite.config.js
export default defineConfig({
  plugins: [uni()],
  build: {
    // 生产环境优化
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // 移除console.log
        drop_debugger: true, // 移除debugger
      },
    },
    // 资源分块
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-i18n'],
          utils: ['axios', 'qrcode'],
        },
      },
    },
  },
})
```

### 3. **环境变量**

创建环境变量文件：

```bash
# .env.production
NODE_ENV=production
VITE_API_BASE_URL=https://uauotggfeiao.sealosbja.site
```

```bash
# .env.development
NODE_ENV=development
VITE_API_BASE_URL=http://localhost:3000
```

## 📊 部署检查清单

### 1. **构建前检查**
- [ ] 确认API地址正确
- [ ] 检查环境变量配置
- [ ] 验证所有功能正常
- [ ] 清理开发环境代码

### 2. **构建后检查**
- [ ] 检查构建产物完整性
- [ ] 验证静态资源加载
- [ ] 测试API接口调用
- [ ] 检查控制台错误

### 3. **部署后检查**
- [ ] 测试所有页面功能
- [ ] 验证用户登录
- [ ] 检查数据加载
- [ ] 测试支付功能（如有）

## 🚨 常见问题

### 1. **构建失败**
```bash
# 清理缓存
rm -rf node_modules
rm -rf dist
npm install
npm run build:h5
```

### 2. **API调用失败**
- 检查域名配置
- 验证HTTPS证书
- 确认CORS设置

### 3. **静态资源404**
- 检查资源路径
- 验证服务器配置
- 确认文件上传完整

### 4. **小程序审核失败**
- 检查域名白名单
- 验证功能完整性
- 确认隐私政策

## 📈 性能监控

### 1. **H5性能监控**
```javascript
// 添加性能监控
window.addEventListener('load', () => {
  const perfData = performance.getEntriesByType('navigation')[0]
  console.log('页面加载时间:', perfData.loadEventEnd - perfData.loadEventStart)
})
```

### 2. **错误监控**
```javascript
// 全局错误捕获
window.addEventListener('error', (event) => {
  console.error('全局错误:', event.error)
  // 发送错误报告到服务器
})
```

## 🎉 总结

生产模式启动步骤：

1. **H5**: `npm run build:h5` → 部署到服务器
2. **小程序**: `npm run build:mp-weixin` → 上传到微信开发者工具
3. **APP**: 在HBuilderX中进行云打包

### 关键配置
- API地址: `https://uauotggfeiao.sealosbja.site`
- 构建命令: `npm run build:[platform]`
- 部署目录: `dist/build/[platform]`

现在您可以根据需要选择相应的平台进行生产模式启动和部署！
