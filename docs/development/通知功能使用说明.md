# 通知功能使用说明

## 📋 概述

本文档详细说明如何使用已实现的通知功能，包括系统公告、通知设置、公告管理等。

## ✅ 已实现的功能

### 1. 系统公告组件 (SystemNotice.vue)

#### 基本使用
```vue
<template>
  <SystemNotice 
    :notice="systemNotice" 
    :show-notice="showSystemNotice"
    :closable="true"
    :refreshable="true"
    @close="closeSystemNotice"
    @refresh="refreshSystemNotice"
  />
</template>

<script>
import SystemNotice from '@/components/SystemNotice.vue'

export default {
  components: {
    SystemNotice
  },
  data() {
    return {
      systemNotice: {
        title: '系统公告',
        content: '这是一条系统公告内容',
        type: 'info', // info, warning, error, success
        time: '2025-01-27T10:30:00.000Z',
        priority: 1 // 1-4, 4为紧急
      },
      showSystemNotice: true
    }
  },
  methods: {
    closeSystemNotice() {
      this.showSystemNotice = false
    },
    refreshSystemNotice() {
      // 刷新公告逻辑
    }
  }
}
</script>
```

#### 公告类型
- `info`: 信息类公告（蓝色）
- `warning`: 警告类公告（橙色）
- `error`: 错误类公告（红色）
- `success`: 成功类公告（绿色）

### 2. 通知管理器组件 (NotificationManager.vue)

#### 基本使用
```vue
<template>
  <NotificationManager 
    @notification-added="onNotificationAdded"
    @notification-removed="onNotificationRemoved"
  />
</template>

<script>
import NotificationManager from '@/components/NotificationManager.vue'

export default {
  components: {
    NotificationManager
  },
  methods: {
    onNotificationAdded(notification) {
      console.log('新通知:', notification)
    },
    onNotificationRemoved(notification) {
      console.log('通知已移除:', notification)
    }
  }
}
</script>
```

### 3. 全局通知管理器 (notificationManager.js)

#### 基本使用
```javascript
import notificationManager from '@/utils/notificationManager.js'

// 显示成功通知
notificationManager.showSuccess('操作成功', '数据已保存')

// 显示错误通知
notificationManager.showError('操作失败', '请检查网络连接')

// 显示警告通知
notificationManager.showWarning('注意', '数据即将过期')

// 显示信息通知
notificationManager.showInfo('提示', '新功能已上线')

// 显示系统公告
notificationManager.showSystemNotice({
  title: '系统维护通知',
  content: '系统将于今晚22:00-24:00进行维护',
  type: 'warning',
  priority: 3
})
```

#### 高级功能
```javascript
// 添加自定义通知
notificationManager.addNotification({
  type: 'meal',
  title: '用餐提醒',
  content: '午餐时间到了，记得报餐哦！',
  priority: 2,
  actions: [
    {
      id: 'go-to-dining',
      text: '去报餐',
      type: 'primary'
    },
    {
      id: 'dismiss',
      text: '稍后提醒',
      type: 'default'
    }
  ]
})

// 获取通知统计
const stats = notificationManager.getStats()
console.log('总通知数:', stats.total)
console.log('未读通知:', stats.unread)
console.log('今日通知:', stats.today)

// 监听通知事件
notificationManager.on('notification-added', (notification) => {
  console.log('新通知添加:', notification)
})

// 标记通知为已读
notificationManager.markAsRead(notificationId)

// 清除所有通知
notificationManager.clearAll()
```

### 4. 通知设置页面

#### 功能特性
- 系统公告开关控制
- 开发环境功能测试
- 通知历史统计
- 通知测试功能

#### 访问路径
```
/pages/notification-settings/notification-settings
```

### 5. 公告管理页面

#### 功能特性
- 公告的增删改查
- 批量操作（选择、删除）
- 搜索和筛选
- 状态管理（草稿、已发布、已归档）
- 优先级设置

#### 访问路径
```
/pages/admin/notices
```

#### 管理员功能
```javascript
// 创建公告
const noticeData = {
  title: '新功能上线',
  content: '系统新增了通知功能',
  type: 'success',
  priority: 2,
  status: 'published',
  isSticky: false
}
await api.admin.createNotice(noticeData)

// 批量删除公告
await api.admin.batchDeleteNotices(['id1', 'id2', 'id3'])

// 发布公告
await api.admin.publishNotice(noticeId)

// 取消发布
await api.admin.unpublishNotice(noticeId)
```

## 🔧 API 接口

### 系统公告接口
```javascript
// 获取系统公告
api.system.getNotice()

// 获取公告列表
api.admin.getNotices({ page: 1, pageSize: 20 })

// 创建公告
api.admin.createNotice(noticeData)

// 更新公告
api.admin.updateNotice(noticeId, noticeData)

// 删除公告
api.admin.deleteNotice(noticeId)
```

### 用户通知设置接口
```javascript
// 获取用户通知设置
api.user.getNotificationSettings()

// 更新用户通知设置
api.user.updateNotificationSettings(settings)

// 重置用户通知设置
api.user.resetUserNotificationSettings()
```

### 通知历史接口
```javascript
// 获取通知历史
api.user.getNotificationHistory({ page: 1, pageSize: 20 })

// 标记通知为已读
api.user.markNotificationAsRead(notificationId)

// 标记所有通知为已读
api.user.markAllNotificationsAsRead()

// 删除通知
api.user.deleteNotification(notificationId)

// 清空通知历史
api.user.clearNotificationHistory()
```

## 🎨 样式定制

### 公告类型样式
```css
.notice-card.info {
  border-left-color: #007aff;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
}

.notice-card.warning {
  border-left-color: #f59e0b;
  background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
}

.notice-card.error {
  border-left-color: #ef4444;
  background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
}

.notice-card.success {
  border-left-color: #10b981;
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
}
```

### 通知管理器样式
```css
.notification-item {
  background: white;
  border-radius: 12rpx;
  box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);
  border-left: 6rpx solid #007aff;
  animation: slideInRight 0.3s ease-out;
}
```

## 📱 响应式设计

所有通知组件都支持响应式设计，在不同屏幕尺寸下都能正常显示：

- 桌面端：通知显示在右上角
- 移动端：通知全宽显示，适配小屏幕
- 平板端：中等尺寸显示

## 🔄 数据持久化

通知数据会自动保存到本地存储：

```javascript
// 自动保存
notificationManager.saveNotifications()

// 自动加载
notificationManager.loadNotifications()
```

## 🚀 最佳实践

### 1. 通知优先级
- 1: 低优先级（信息通知）
- 2: 中优先级（警告通知）
- 3: 高优先级（错误通知）
- 4: 紧急优先级（系统公告）

### 2. 通知类型
- `info`: 一般信息
- `success`: 成功操作
- `warning`: 警告信息
- `error`: 错误信息
- `system`: 系统通知
- `meal`: 用餐相关
- `reservation`: 预约相关
- `verification`: 验证相关
- `court`: 球馆相关

### 3. 自动清理
- 通知超过7天自动清理
- 最多保留10条通知
- 自动隐藏延迟5秒

## 🐛 故障排除

### 常见问题

1. **通知不显示**
   - 检查通知设置是否开启
   - 确认组件是否正确导入
   - 查看控制台错误信息

2. **通知样式异常**
   - 检查CSS是否正确加载
   - 确认响应式样式是否生效

3. **数据不保存**
   - 检查本地存储权限
   - 确认数据格式是否正确

### 调试方法

```javascript
// 开启调试模式
notificationManager.on('notification-added', (notification) => {
  console.log('通知添加:', notification)
})

// 查看通知统计
console.log('通知统计:', notificationManager.getStats())

// 导出通知数据
console.log('通知数据:', notificationManager.exportNotifications())
```

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查看控制台错误信息
2. 检查网络连接状态
3. 确认API接口是否正常
4. 查看本地存储数据

---

**注意**: 本文档基于当前实现的功能编写，随着功能更新会持续维护。
