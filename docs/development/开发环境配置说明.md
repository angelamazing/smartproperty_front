# 开发环境配置说明

## 概述

本文档详细说明如何配置前端项目的开发环境，使其能够正确连接到后端开发服务器。

## 环境地址配置

### 后端服务地址

- **生产环境**: `https://jcdtnpaompjy.sealosbja.site`
- **开发环境**: `http://localhost:3000`

### 前端配置

前端项目已配置自动环境切换：

1. **自动检测机制**：
   - 当页面URL包含 `localhost`、`127.0.0.1`、`192.168.*`、`10.0.*`、`172.*` 时，自动使用开发环境地址
   - 其他情况默认使用生产环境地址

2. **配置文件位置**：
   ```
   src/utils/api.js
   ```

3. **配置内容**：
   ```javascript
   const API_CONFIG = {
     PROD_BASE_URL: 'https://jcdtnpaompjy.sealosbja.site',  // 生产环境地址
     DEV_BASE_URL: 'http://localhost:3000',                   // 开发环境地址
     TIMEOUT: 10000                                           // 请求超时时间
   }
   ```

## 开发环境设置步骤

### 步骤1：启动后端开发服务器

确保后端服务在 `http://localhost:3000` 上运行：

```bash
# 在后端项目目录中
npm start
# 或
node server.js
```

### 步骤2：启动前端开发服务器

在前端项目目录中启动开发服务器：

```bash
# 安装依赖（如果还没有安装）
npm install

# 启动开发服务器
npm run dev:h5
# 或
npm run dev:mp-weixin  # 微信小程序开发
```

### 步骤3：验证环境切换

1. **检查控制台日志**：
   - 打开浏览器开发者工具
   - 查看控制台输出，应该显示：
     ```
     当前为开发环境，使用本地开发服务器: http://localhost:3000
     ```

2. **测试API调用**：
   - 尝试登录或获取数据
   - 检查网络请求是否发送到 `http://localhost:3000`

## 环境切换逻辑

### 自动切换规则

系统使用以下优先级进行环境判断：

1. **URL检测（最高优先级）**：
   - 如果当前页面URL包含本地地址特征，自动切换到开发环境
   - 支持的本地地址模式：
     - `localhost`
     - `127.0.0.1`
     - `192.168.*`
     - `10.0.*`
     - `172.*`

2. **环境变量检测**：
   - 检查 `NODE_ENV === 'development'`
   - 检查 `UNI_PLATFORM === 'h5'` 或 `'app-plus'`

3. **默认规则**：
   - 所有其他情况默认使用生产环境

### 手动切换方法

如果需要手动控制环境，可以修改 `getBaseUrl()` 函数：

```javascript
// 强制使用开发环境
function getBaseUrl() {
  return API_CONFIG.DEV_BASE_URL
}

// 强制使用生产环境
function getBaseUrl() {
  return API_CONFIG.PROD_BASE_URL
}
```

## 测试环境配置

### 快速测试登录

开发环境支持测试登录功能，无需真实微信授权：

```javascript
// 普通用户测试登录
POST /api/auth/test-login

// 部门管理员测试登录
POST /api/auth/test-login-admin

// 系统管理员测试登录
POST /api/auth/test-login-sys-admin
```

### 健康检查

可以通过以下接口验证后端服务状态：

```javascript
GET /health
```

## 常见问题解决

### 问题1：无法连接到开发服务器

**症状**：API请求失败，提示网络错误

**解决步骤**：
1. 检查后端服务是否在 `http://localhost:3000` 运行
2. 检查防火墙设置是否阻止了端口3000
3. 尝试使用 `curl http://localhost:3000/health` 测试连接

### 问题2：环境没有正确切换

**症状**：仍然请求生产环境地址

**解决步骤**：
1. 检查浏览器地址栏，确认包含本地地址特征
2. 查看浏览器控制台的日志输出
3. 尝试刷新页面或重启开发服务器

### 问题3：跨域请求失败

**症状**：出现CORS错误

**解决步骤**：
1. 检查后端服务器的CORS配置
2. 确认前端运行在正确的端口（通常是8080或类似的开发端口）
3. 在后端添加相应的CORS允许规则

## 开发建议

### 1. 环境隔离

- 开发环境和生产环境使用不同的数据库
- 开发环境的测试数据不会影响生产数据

### 2. 调试技巧

- 使用浏览器开发者工具查看网络请求
- 启用API请求的日志输出
- 使用测试登录功能快速测试功能

### 3. 版本控制

- 提交代码前确保配置正确
- 不要提交敏感的生产环境配置到版本控制

## 技术支持

如果遇到配置问题，请：

1. 检查本文档中的常见问题解决部分
2. 查看后端接口文档中的环境配置说明
3. 联系开发团队获取技术支持

---

*最后更新：2025年9月7日*
