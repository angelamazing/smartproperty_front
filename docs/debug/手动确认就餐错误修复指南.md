# æ‰‹åŠ¨ç¡®è®¤å°±é¤é”™è¯¯ä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·åœ¨ç‚¹å‡»"ç¡®è®¤å°±é¤"æŒ‰é’®æ—¶ï¼Œå‡ºç°"è®¢å•ä¸å­˜åœ¨æˆ–æ— æƒæ“ä½œ"é”™è¯¯ï¼Œé”™è¯¯ç ä¸º"Not Found"ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```json
{
  "success": false,
  "message": "è®¢å•ä¸å­˜åœ¨æˆ–æ— æƒæ“ä½œ",
  "error": "Not Found"
}
```

### å¯èƒ½åŸå› 
1. **orderId ä¸ºç©ºæˆ–æ— æ•ˆ**
2. **ç”¨æˆ·æƒé™ä¸è¶³**
3. **è®¢å•çŠ¶æ€ä¸æ­£ç¡®**
4. **APIè°ƒç”¨å‚æ•°é”™è¯¯**
5. **åç«¯æ¥å£é—®é¢˜**

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å‰ç«¯é”™è¯¯å¤„ç†ä¼˜åŒ–

#### å·²ä¿®å¤çš„é—®é¢˜
- âœ… **APIé”™è¯¯å¤„ç†**: ä¿®å¤äº†404é”™è¯¯æ—¶è¿”å›åç«¯å…·ä½“é”™è¯¯ä¿¡æ¯
- âœ… **å‚æ•°éªŒè¯**: æ·»åŠ äº†orderIdéªŒè¯
- âœ… **é”™è¯¯æç¤º**: æä¾›äº†æ›´å‹å¥½çš„é”™è¯¯æç¤º
- âœ… **è°ƒè¯•ä¿¡æ¯**: æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

#### ä¿®å¤çš„ä»£ç 
```javascript
// 1. APIé”™è¯¯å¤„ç†ä¿®å¤ (src/utils/api.js)
if (res.statusCode === 404) {
  // 404é”™è¯¯ï¼šè¿”å›åç«¯çš„å…·ä½“é”™è¯¯ä¿¡æ¯
  const errorData = res.data || {}
  const error = new Error(errorData.message || 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
  error.response = { data: errorData, status: res.statusCode }
  reject(error)
}

// 2. ç¡®è®¤å°±é¤æ–¹æ³•ä¼˜åŒ– (src/pages/dining/dining-status.vue)
async confirmDining(orderId) {
  try {
    // éªŒè¯orderId
    if (!orderId) {
      uni.showToast({
        title: 'è®¢å•IDä¸èƒ½ä¸ºç©º',
        icon: 'error'
      })
      return
    }

    console.log('å¼€å§‹ç¡®è®¤å°±é¤ï¼Œè®¢å•ID:', orderId)
    
    // ... å…¶ä»–é€»è¾‘
  } catch (error) {
    // å¤„ç†ç½‘ç»œé”™è¯¯å’Œä¸šåŠ¡é”™è¯¯
    const errorMessage = this.getConfirmationErrorMessage(
      error.response?.data?.message || error.message,
      error.response?.data?.error
    )
    
    uni.showToast({
      title: errorMessage,
      icon: 'none',
      duration: 3000
    })
  }
}

// 3. é”™è¯¯ä¿¡æ¯æ˜ å°„
getConfirmationErrorMessage(message, errorCode) {
  switch (errorCode) {
    case 'Not Found':
      return 'è®¢å•ä¸å­˜åœ¨æˆ–æ‚¨æ— æƒæ“ä½œæ­¤è®¢å•'
    case 'Bad Request':
      if (message.includes('å·²ç¡®è®¤å°±é¤')) {
        return 'è¯¥è®¢å•å·²ç¡®è®¤å°±é¤ï¼Œä¸èƒ½é‡å¤ç¡®è®¤'
      } else if (message.includes('å·²å–æ¶ˆ')) {
        return 'è®¢å•å·²å–æ¶ˆï¼Œæ— æ³•ç¡®è®¤å°±é¤'
      } else if (message.includes('ä¸åœ¨å°±é¤æ—¶é—´å†…')) {
        return 'å½“å‰æ—¶é—´ä¸åœ¨å°±é¤æ—¶é—´èŒƒå›´å†…'
      }
      return message
    default:
      return message
  }
}
```

### 2. è°ƒè¯•æ­¥éª¤

#### æ­¥éª¤1: æ£€æŸ¥orderId
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹
console.log('è®¢å•ID:', meal.status.orderId)
console.log('é¤æ¬¡çŠ¶æ€:', meal.status)
```

#### æ­¥éª¤2: æ£€æŸ¥APIè°ƒç”¨
```javascript
// æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
// 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
// 2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
// 3. ç‚¹å‡»"ç¡®è®¤å°±é¤"æŒ‰é’®
// 4. æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
```

#### æ­¥éª¤3: æ£€æŸ¥ç”¨æˆ·æƒé™
```javascript
// æ£€æŸ¥ç”¨æˆ·Token
const token = uni.getStorageSync('userToken')
console.log('ç”¨æˆ·Token:', token)

// æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
const userInfo = uni.getStorageSync('userInfo')
console.log('ç”¨æˆ·ä¿¡æ¯:', userInfo)
```

### 3. åç«¯æ¥å£è¦æ±‚

#### æ¥å£åœ°å€
```
POST /api/dining-confirmation/manual/:orderId
```

#### è¯·æ±‚å¤´
```http
Authorization: Bearer {token}
Content-Type: application/json
```

#### è¯·æ±‚å‚æ•°
```json
{
  "confirmationType": "manual"
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "ç¡®è®¤å°±é¤æˆåŠŸ",
  "data": {
    "orderId": "917a80ca-bc11-4458-a72f-04122a4b37a7",
    "confirmationType": "manual",
    "actualDiningTime": "2025-09-11 12:30:00",
    "message": "ç¡®è®¤å°±é¤æˆåŠŸ"
  }
}
```

#### é”™è¯¯å“åº”
```json
{
  "success": false,
  "message": "è®¢å•ä¸å­˜åœ¨æˆ–æ— æƒæ“ä½œ",
  "error": "Not Found"
}
```

## ğŸ”§ æ’æŸ¥æ¸…å•

### å‰ç«¯æ£€æŸ¥é¡¹
- [ ] orderId æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
- [ ] ç”¨æˆ·Token æ˜¯å¦æœ‰æ•ˆ
- [ ] APIè°ƒç”¨å‚æ•°æ˜¯å¦æ­£ç¡®
- [ ] ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦æ­£ç¡®

### åç«¯æ£€æŸ¥é¡¹
- [ ] è®¢å•æ˜¯å¦å­˜åœ¨
- [ ] ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ“ä½œè¯¥è®¢å•
- [ ] è®¢å•çŠ¶æ€æ˜¯å¦å…è®¸ç¡®è®¤å°±é¤
- [ ] æ—¶é—´é™åˆ¶æ˜¯å¦æ»¡è¶³
- [ ] æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### æ­£å¸¸æµç¨‹æµ‹è¯•
```javascript
// æµ‹è¯•æ•°æ®
const testOrderId = '917a80ca-bc11-4458-a72f-04122a4b37a7'
const testToken = 'valid-jwt-token'

// æµ‹è¯•ç¡®è®¤å°±é¤
try {
  const result = await api.diningConfirmation.manualConfirm(testOrderId)
  console.log('ç¡®è®¤ç»“æœ:', result)
} catch (error) {
  console.log('é”™è¯¯ä¿¡æ¯:', error.message)
}
```

### å¼‚å¸¸æƒ…å†µæµ‹è¯•
```javascript
// æµ‹è¯•æ— æ•ˆè®¢å•ID
try {
  await api.diningConfirmation.manualConfirm('invalid-order-id')
} catch (error) {
  console.log('é¢„æœŸé”™è¯¯:', error.message)
}

// æµ‹è¯•æ— æ•ˆToken
try {
  await api.diningConfirmation.manualConfirm(testOrderId)
} catch (error) {
  console.log('é¢„æœŸé”™è¯¯:', error.message)
}
```

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### ç«‹å³è§£å†³æ–¹æ¡ˆ
1. **æ£€æŸ¥orderId**: ç¡®ä¿ä¼ é€’ç»™APIçš„orderIdä¸ä¸ºç©º
2. **æ£€æŸ¥æƒé™**: ç¡®ä¿ç”¨æˆ·æœ‰æƒé™æ“ä½œè¯¥è®¢å•
3. **æ£€æŸ¥çŠ¶æ€**: ç¡®ä¿è®¢å•çŠ¶æ€å…è®¸ç¡®è®¤å°±é¤

### é•¿æœŸè§£å†³æ–¹æ¡ˆ
1. **å®Œå–„é”™è¯¯å¤„ç†**: æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
2. **æ·»åŠ æ—¥å¿—**: è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—
3. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**: æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Tokenç®¡ç†**: ç¡®ä¿å‰ç«¯æ­£ç¡®ç®¡ç†JWT Token
2. **é”™è¯¯å¤„ç†**: æ ¹æ®ä¸åŒçš„é”™è¯¯çŠ¶æ€ç æä¾›ç›¸åº”çš„ç”¨æˆ·æç¤º
3. **åŠ è½½çŠ¶æ€**: åœ¨ç¡®è®¤è¿‡ç¨‹ä¸­æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œé¿å…é‡å¤æäº¤
4. **æ•°æ®åŒæ­¥**: ç¡®è®¤æˆåŠŸååŠæ—¶æ›´æ–°æœ¬åœ°çŠ¶æ€å’ŒUIæ˜¾ç¤º
5. **æƒé™éªŒè¯**: ç¡®ä¿åªæœ‰è®¢å•æ‰€æœ‰è€…æ‰èƒ½ç¡®è®¤å°±é¤

## ğŸ”® é¢„é˜²æªæ–½

1. **å‚æ•°éªŒè¯**: åœ¨è°ƒç”¨APIå‰éªŒè¯æ‰€æœ‰å¿…éœ€å‚æ•°
2. **é”™è¯¯å¤„ç†**: å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
3. **ç”¨æˆ·åé¦ˆ**: æä¾›æ¸…æ™°çš„ç”¨æˆ·åé¦ˆä¿¡æ¯
4. **æ—¥å¿—è®°å½•**: è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—ä¾¿äºè°ƒè¯•
5. **æµ‹è¯•è¦†ç›–**: ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹

é€šè¿‡ä»¥ä¸Šä¿®å¤ï¼Œæ‰‹åŠ¨ç¡®è®¤å°±é¤çš„é”™è¯¯å¤„ç†å·²ç»å¾—åˆ°å®Œå–„ï¼Œç”¨æˆ·å°†çœ‹åˆ°æ›´å‹å¥½çš„é”™è¯¯æç¤ºï¼Œå¼€å‘è€…ä¹Ÿèƒ½æ›´å®¹æ˜“åœ°å®šä½å’Œè§£å†³é—®é¢˜ã€‚
