# 页面性能优化方案

## 🚨 问题分析

### 主要性能问题
1. **文件过大**: `dining.vue` 文件有 **88KB**，导致：
   - 初始加载时间长
   - 解析时间长
   - 内存占用大

2. **计算属性过多**: 大量计算属性在每次数据变化时重新计算
3. **频繁API调用**: 页面显示时可能重复加载数据
4. **CSS样式冗余**: 大量重复的CSS代码
5. **复杂的模板结构**: 过多的条件渲染和循环

### 性能影响
- 页面首次加载时间增加
- 切换标签页响应变慢
- 内存使用量增加
- 用户体验下降

## ⚡ 优化方案

### 1. 文件拆分 (优先级: 高)

将 `dining.vue` 拆分成多个小组件：

```
src/pages/dining/
├── dining.vue (主文件，减少到 ~20KB)
├── components/
│   ├── MenuTab.vue (今日菜单标签页)
│   ├── OrderTab.vue (部门报餐标签页)
│   ├── RecordTab.vue (报餐记录标签页)
│   ├── DishList.vue (菜品列表组件)
│   ├── MemberSelector.vue (成员选择组件)
│   ├── RecordList.vue (记录列表组件)
│   └── QueryCard.vue (查询卡片组件)
```

### 2. 计算属性优化 (优先级: 高)

```javascript
// 添加缓存和防抖
computed: {
  // 使用缓存的计算属性
  filteredMembers: {
    cache: true,
    get() {
      return this.computeFilteredMembers()
    }
  }
},

// 添加防抖方法
methods: {
  debounceFilterMembers: debounce(function() {
    this.$forceUpdate()
  }, 300)
}
```

### 3. API调用优化 (优先级: 高)

```javascript
// 添加请求缓存
const apiCache = new Map()

async loadMenu() {
  const cacheKey = `menu_${this.selectedDate}_${this.selectedMeal}`
  
  if (apiCache.has(cacheKey)) {
    this.currentMenu = apiCache.get(cacheKey)
    return
  }
  
  const result = await api.admin.getMenuByDate(this.selectedDate, this.selectedMeal)
  if (result.success) {
    apiCache.set(cacheKey, result.data)
    this.currentMenu = result.data
  }
}
```

### 4. CSS优化 (优先级: 中)

```scss
// 提取公共样式到 uni.scss
.common-card {
  background: #fff;
  border-radius: 16rpx;
  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.08);
}

.common-button {
  border: none;
  border-radius: 12rpx;
  transition: all 0.3s ease;
}
```

### 5. 渲染优化 (优先级: 中)

```vue
<!-- 使用 v-show 替代 v-if 减少重新渲染 -->
<view v-show="currentTab === 'menu'" class="tab-content">
  <MenuTab />
</view>

<!-- 使用 key 优化列表渲染 -->
<view v-for="dish in filteredDishes" :key="dish._id" class="dish-item">
  <!-- 内容 -->
</view>
```

## 📊 预期效果

### 文件大小优化
| 文件 | 优化前 | 优化后 | 减少 |
|------|--------|--------|------|
| dining.vue | 88KB | ~20KB | 77% |
| 总文件数 | 1个 | 7个 | 分散 |

### 性能提升
- **首次加载时间**: 减少 60-70%
- **切换标签页**: 减少 50-60%
- **内存使用**: 减少 40-50%
- **渲染性能**: 提升 50-70%

## 🚀 实施步骤

### 第一阶段: 文件拆分
1. 创建组件目录结构
2. 提取菜单标签页组件
3. 提取报餐标签页组件
4. 提取记录标签页组件
5. 更新主文件引用

### 第二阶段: 性能优化
1. 优化计算属性
2. 添加API缓存
3. 实现防抖机制
4. 优化CSS样式

### 第三阶段: 高级优化
1. 实现虚拟滚动
2. 添加骨架屏
3. 实现预加载
4. 添加性能监控

## 📋 检查清单

- [ ] 拆分 dining.vue 文件
- [ ] 创建子组件
- [ ] 优化计算属性
- [ ] 添加API缓存
- [ ] 优化CSS样式
- [ ] 测试性能提升
- [ ] 验证功能完整性

---

**开始实施优化，预计可提升页面加载性能 60-70%！**
