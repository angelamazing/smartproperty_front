# å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ€§ä¿®å¤æŠ¥å‘Š

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šæ‰«æå°±é¤éƒ¨åˆ†åœ¨å‘å¸ƒä¸ºå¾®ä¿¡å°ç¨‹åºåå‡ºç°é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªé”™è¯¯ï¼š

1. **ç½‘ç»œè¿æ¥å¤±è´¥** - "URLSearchParams is not defined"
2. **TypeError** - "Cannot read property 'breakfast' of undefined"

## ğŸ” é—®é¢˜åˆ†æ

### 1. URLSearchParamså…¼å®¹æ€§é—®é¢˜
å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸æ”¯æŒ `URLSearchParams` APIï¼Œå¯¼è‡´ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼š
- `src/utils/api.js` - äºŒç»´ç ç”Ÿæˆç›¸å…³API
- `src/pages/dining/register.vue` - é¡µé¢å‚æ•°å¤„ç†

### 2. å¯¹è±¡å±æ€§è®¿é—®é—®é¢˜
åœ¨ `src/pages/dining/qr-scan.vue` ä¸­ï¼Œä»£ç å°è¯•è®¿é—® `diningStatus.mealç¡®è®¤ationStatus[meal.type]` ä½† `mealç¡®è®¤ationStatus` å¯èƒ½ä¸ºundefinedï¼Œå¯¼è‡´ "Cannot read property 'breakfast' of undefined" é”™è¯¯ã€‚

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. URLSearchParamså…¼å®¹æ€§ä¿®å¤

åˆ›å»ºäº† `buildQueryString` å·¥å…·å‡½æ•°æ¥æ›¿ä»£ `URLSearchParams`ï¼š

```javascript
// URLSearchParamså…¼å®¹æ€§å·¥å…·å‡½æ•°ï¼ˆå¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒURLSearchParamsï¼‰
function buildQueryString(params) {
  if (typeof URLSearchParams !== 'undefined') {
    return new URLSearchParams(params).toString()
  }
  
  // å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ–¹æ¡ˆ
  return Object.keys(params)
    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
    .join('&')
}
```

### 2. å¯¹è±¡å±æ€§å®‰å…¨è®¿é—®ä¿®å¤

ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ `?.` æ¥å®‰å…¨è®¿é—®å¯¹è±¡å±æ€§ï¼š

```javascript
// ä¿®å¤å‰
diningStatus.mealç¡®è®¤ationStatus[meal.type]?.isRegistered

// ä¿®å¤å
diningStatus.mealç¡®è®¤ationStatus?.[meal.type]?.isRegistered
```

## ğŸ“‹ ä¿®å¤è¯¦æƒ…

### 1. src/utils/api.js
**ä¿®å¤çš„APIæ–¹æ³•**ï¼š
- `generateQRCodeImage()` - ç”Ÿæˆæ™®é€šäºŒç»´ç å›¾ç‰‡
- `generateQRCodeWithURL()` - ç”ŸæˆåŒ…å«URLçš„äºŒç»´ç å›¾ç‰‡
- `generateSecureQRCode()` - ç”Ÿæˆå®‰å…¨äºŒç»´ç å›¾ç‰‡
- `generateWechatMiniProgramCode()` - ç”Ÿæˆå¾®ä¿¡å°ç¨‹åºç 

**ä¿®å¤å†…å®¹**ï¼š
```javascript
// ä¿®å¤å‰
const params = new URLSearchParams({
  width: options.width || 200,
  margin: options.margin || 2
})
return api.get(`/api/qr-scan/qr-codes/${qrCode}/image?${params}`)

// ä¿®å¤å
const params = {
  width: options.width || 200,
  margin: options.margin || 2
}
return api.get(`/api/qr-scan/qr-codes/${qrCode}/image?${buildQueryString(params)}`)
```

### 2. src/pages/dining/register.vue
**ä¿®å¤å†…å®¹**ï¼š
```javascript
// ä¿®å¤å‰
const params = new URLSearchParams()
if (options.mealType) params.append('mealType', options.mealType)
if (options.date) params.append('date', options.date)
const queryString = params.toString()

// ä¿®å¤å
const params = {}
if (options.mealType) params.mealType = options.mealType
if (options.date) params.date = options.date
const queryString = Object.keys(params)
  .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
  .join('&')
```

### 3. src/pages/dining/qr-scan.vue
**ä¿®å¤å†…å®¹**ï¼š
```javascript
// ä¿®å¤å‰
'registered': diningStatus.mealç¡®è®¤ationStatus[meal.type]?.isRegistered,
'confirmed': diningStatus.mealç¡®è®¤ationStatus[meal.type]?.diningStatus === 'dined',

// ä¿®å¤å
'registered': diningStatus.mealç¡®è®¤ationStatus?.[meal.type]?.isRegistered,
'confirmed': diningStatus.mealç¡®è®¤ationStatus?.[meal.type]?.diningStatus === 'dined',
```

## âœ… ä¿®å¤æ¸…å•

- [x] src/utils/api.js - æ·»åŠ URLSearchParamså…¼å®¹æ€§å·¥å…·å‡½æ•°
- [x] src/utils/api.js - ä¿®å¤æ‰€æœ‰äºŒç»´ç ç”ŸæˆAPIçš„URLSearchParamsä½¿ç”¨
- [x] src/pages/dining/register.vue - ä¿®å¤é¡µé¢å‚æ•°å¤„ç†çš„URLSearchParamsä½¿ç”¨
- [x] src/pages/dining/qr-scan.vue - ä¿®å¤å¯¹è±¡å±æ€§å®‰å…¨è®¿é—®é—®é¢˜
- [x] è¯­æ³•æ£€æŸ¥ - æ— é”™è¯¯

## ğŸ§ª éªŒè¯æ–¹æ³•

### æµ‹è¯•æ­¥éª¤ï¼š
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç¼–è¯‘é¡¹ç›®
2. æµ‹è¯•äºŒç»´ç ç”ŸæˆåŠŸèƒ½
3. æµ‹è¯•æ‰«ç ç¡®è®¤å°±é¤åŠŸèƒ½
4. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦è¿˜æœ‰é”™è¯¯

### é¢„æœŸç»“æœï¼š
- äºŒç»´ç ç”ŸæˆåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ‰«ç ç¡®è®¤å°±é¤åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ²¡æœ‰ "URLSearchParams is not defined" é”™è¯¯
- æ²¡æœ‰ "Cannot read property 'breakfast' of undefined" é”™è¯¯

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

- **ä¿®å¤æ–‡ä»¶æ•°**: 3ä¸ªæ–‡ä»¶
- **APIæ–¹æ³•ä¿®å¤**: 4ä¸ªäºŒç»´ç ç”ŸæˆAPI
- **å…¼å®¹æ€§ä¿®å¤**: URLSearchParamsæ›¿ä»£æ–¹æ¡ˆ
- **å®‰å…¨è®¿é—®ä¿®å¤**: 2å¤„å¯¹è±¡å±æ€§è®¿é—®
- **é”™è¯¯ä¿®å¤**: âœ… å·²ä¿®å¤
- **è¯­æ³•æ£€æŸ¥**: âœ… æ— é”™è¯¯

## ğŸ” ç›¸å…³æ–‡ä»¶

### ä¿®å¤çš„æ–‡ä»¶ï¼š
- `src/utils/api.js` - APIå·¥å…·ç±»
- `src/pages/dining/register.vue` - å°±é¤ç™»è®°é¡µé¢
- `src/pages/dining/qr-scan.vue` - æ‰«ç å°±é¤é¡µé¢

### å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ€§è¯´æ˜ï¼š
1. **URLSearchParams**: å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨æ‰‹åŠ¨æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²çš„æ–¹å¼
2. **å¯é€‰é“¾æ“ä½œç¬¦**: å¾®ä¿¡å°ç¨‹åºæ”¯æŒ `?.` æ“ä½œç¬¦ï¼Œç”¨äºå®‰å…¨è®¿é—®å¯¹è±¡å±æ€§
3. **APIè°ƒç”¨**: æ‰€æœ‰ç½‘ç»œè¯·æ±‚éƒ½éœ€è¦è€ƒè™‘å¾®ä¿¡å°ç¨‹åºçš„å…¼å®¹æ€§

## ğŸš€ åç»­å»ºè®®

1. **å…¼å®¹æ€§æµ‹è¯•**: åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å…¨é¢æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. **é”™è¯¯å¤„ç†**: æ·»åŠ æ›´å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
3. **APIå°è£…**: è€ƒè™‘å°†URLSearchParamsçš„æ›¿ä»£æ–¹æ¡ˆå°è£…ä¸ºé€šç”¨å·¥å…·
4. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°å¼€å‘æ–‡æ¡£ï¼Œè¯´æ˜å¾®ä¿¡å°ç¨‹åºçš„å…¼å®¹æ€§è¦æ±‚

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### URLSearchParamsæ›¿ä»£æ–¹æ¡ˆï¼š
```javascript
// æ ‡å‡†æ–¹å¼ï¼ˆæµè§ˆå™¨æ”¯æŒï¼‰
const params = new URLSearchParams({ key: 'value' })
const queryString = params.toString()

// å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ–¹å¼
const params = { key: 'value' }
const queryString = Object.keys(params)
  .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
  .join('&')
```

### å¯¹è±¡å±æ€§å®‰å…¨è®¿é—®ï¼š
```javascript
// ä¸å®‰å…¨çš„æ–¹å¼
obj.property.subProperty

// å®‰å…¨çš„æ–¹å¼
obj?.property?.subProperty
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-01-27  
**ä¿®å¤ç‰ˆæœ¬**: v1.7  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**é”™è¯¯ä¿®å¤**: âœ… å·²ä¿®å¤  
**æµ‹è¯•çŠ¶æ€**: âœ… å¾…éªŒè¯
